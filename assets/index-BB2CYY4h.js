(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ut=globalThis,we=Ut.trustedTypes,Cn=we?we.createPolicy("lit-html",{createHTML:e=>e}):void 0,di="$lit$",wt=`lit$${Math.random().toFixed(9).slice(2)}$`,fi="?"+wt,dr=`<${fi}>`,$t=document,Kt=()=>$t.createComment(""),Jt=e=>e===null||typeof e!="object"&&typeof e!="function",ln=Array.isArray,fr=e=>ln(e)||typeof(e==null?void 0:e[Symbol.iterator])=="function",Te=`[ 	
\f\r]`,Ft=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,$n=/-->/g,An=/>/g,xt=RegExp(`>|${Te}(?:([^\\s"'>=/]+)(${Te}*=${Te}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Pn=/'/g,Ln=/"/g,pi=/^(?:script|style|textarea|title)$/i,gi=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),F=gi(1),pr=gi(2),Zt=Symbol.for("lit-noChange"),G=Symbol.for("lit-nothing"),Mn=new WeakMap,St=$t.createTreeWalker($t,129);function vi(e,t){if(!ln(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return Cn!==void 0?Cn.createHTML(t):t}const gr=(e,t)=>{const i=e.length-1,n=[];let r,a=t===2?"<svg>":t===3?"<math>":"",s=Ft;for(let o=0;o<i;o++){const l=e[o];let c,h,u=-1,p=0;for(;p<l.length&&(s.lastIndex=p,h=s.exec(l),h!==null);)p=s.lastIndex,s===Ft?h[1]==="!--"?s=$n:h[1]!==void 0?s=An:h[2]!==void 0?(pi.test(h[2])&&(r=RegExp("</"+h[2],"g")),s=xt):h[3]!==void 0&&(s=xt):s===xt?h[0]===">"?(s=r??Ft,u=-1):h[1]===void 0?u=-2:(u=s.lastIndex-h[2].length,c=h[1],s=h[3]===void 0?xt:h[3]==='"'?Ln:Pn):s===Ln||s===Pn?s=xt:s===$n||s===An?s=Ft:(s=xt,r=void 0);const g=s===xt&&e[o+1].startsWith("/>")?" ":"";a+=s===Ft?l+dr:u>=0?(n.push(c),l.slice(0,u)+di+l.slice(u)+wt+g):l+wt+(u===-2?o:g)}return[vi(e,a+(e[i]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),n]};class Qt{constructor({strings:t,_$litType$:i},n){let r;this.parts=[];let a=0,s=0;const o=t.length-1,l=this.parts,[c,h]=gr(t,i);if(this.el=Qt.createElement(c,n),St.currentNode=this.el.content,i===2||i===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=St.nextNode())!==null&&l.length<o;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(di)){const p=h[s++],g=r.getAttribute(u).split(wt),y=/([.?@])?(.*)/.exec(p);l.push({type:1,index:a,name:y[2],strings:g,ctor:y[1]==="."?mr:y[1]==="?"?yr:y[1]==="@"?wr:Le}),r.removeAttribute(u)}else u.startsWith(wt)&&(l.push({type:6,index:a}),r.removeAttribute(u));if(pi.test(r.tagName)){const u=r.textContent.split(wt),p=u.length-1;if(p>0){r.textContent=we?we.emptyScript:"";for(let g=0;g<p;g++)r.append(u[g],Kt()),St.nextNode(),l.push({type:2,index:++a});r.append(u[p],Kt())}}}else if(r.nodeType===8)if(r.data===fi)l.push({type:2,index:a});else{let u=-1;for(;(u=r.data.indexOf(wt,u+1))!==-1;)l.push({type:7,index:a}),u+=wt.length-1}a++}}static createElement(t,i){const n=$t.createElement("template");return n.innerHTML=t,n}}function Tt(e,t,i=e,n){var s,o;if(t===Zt)return t;let r=n!==void 0?(s=i._$Co)==null?void 0:s[n]:i._$Cl;const a=Jt(t)?void 0:t._$litDirective$;return(r==null?void 0:r.constructor)!==a&&((o=r==null?void 0:r._$AO)==null||o.call(r,!1),a===void 0?r=void 0:(r=new a(e),r._$AT(e,i,n)),n!==void 0?(i._$Co??(i._$Co=[]))[n]=r:i._$Cl=r),r!==void 0&&(t=Tt(e,r._$AS(e,t.values),r,n)),t}class vr{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:i},parts:n}=this._$AD,r=((t==null?void 0:t.creationScope)??$t).importNode(i,!0);St.currentNode=r;let a=St.nextNode(),s=0,o=0,l=n[0];for(;l!==void 0;){if(s===l.index){let c;l.type===2?c=new se(a,a.nextSibling,this,t):l.type===1?c=new l.ctor(a,l.name,l.strings,this,t):l.type===6&&(c=new br(a,this,t)),this._$AV.push(c),l=n[++o]}s!==(l==null?void 0:l.index)&&(a=St.nextNode(),s++)}return St.currentNode=$t,r}p(t){let i=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,i),i+=n.strings.length-2):n._$AI(t[i])),i++}}class se{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,i,n,r){this.type=2,this._$AH=G,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=n,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=Tt(this,t,i),Jt(t)?t===G||t==null||t===""?(this._$AH!==G&&this._$AR(),this._$AH=G):t!==this._$AH&&t!==Zt&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):fr(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==G&&Jt(this._$AH)?this._$AA.nextSibling.data=t:this.T($t.createTextNode(t)),this._$AH=t}$(t){var a;const{values:i,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=Qt.createElement(vi(n.h,n.h[0]),this.options)),n);if(((a=this._$AH)==null?void 0:a._$AD)===r)this._$AH.p(i);else{const s=new vr(r,this),o=s.u(this.options);s.p(i),this.T(o),this._$AH=s}}_$AC(t){let i=Mn.get(t.strings);return i===void 0&&Mn.set(t.strings,i=new Qt(t)),i}k(t){ln(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let n,r=0;for(const a of t)r===i.length?i.push(n=new se(this.O(Kt()),this.O(Kt()),this,this.options)):n=i[r],n._$AI(a),r++;r<i.length&&(this._$AR(n&&n._$AB.nextSibling,r),i.length=r)}_$AR(t=this._$AA.nextSibling,i){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,i);t&&t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){var i;this._$AM===void 0&&(this._$Cv=t,(i=this._$AP)==null||i.call(this,t))}}class Le{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,i,n,r,a){this.type=1,this._$AH=G,this._$AN=void 0,this.element=t,this.name=i,this._$AM=r,this.options=a,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=G}_$AI(t,i=this,n,r){const a=this.strings;let s=!1;if(a===void 0)t=Tt(this,t,i,0),s=!Jt(t)||t!==this._$AH&&t!==Zt,s&&(this._$AH=t);else{const o=t;let l,c;for(t=a[0],l=0;l<a.length-1;l++)c=Tt(this,o[n+l],i,l),c===Zt&&(c=this._$AH[l]),s||(s=!Jt(c)||c!==this._$AH[l]),c===G?t=G:t!==G&&(t+=(c??"")+a[l+1]),this._$AH[l]=c}s&&!r&&this.j(t)}j(t){t===G?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class mr extends Le{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===G?void 0:t}}class yr extends Le{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==G)}}class wr extends Le{constructor(t,i,n,r,a){super(t,i,n,r,a),this.type=5}_$AI(t,i=this){if((t=Tt(this,t,i,0)??G)===Zt)return;const n=this._$AH,r=t===G&&n!==G||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,a=t!==G&&(n===G||r);r&&this.element.removeEventListener(this.name,this,n),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var i;typeof this._$AH=="function"?this._$AH.call(((i=this.options)==null?void 0:i.host)??this.element,t):this._$AH.handleEvent(t)}}class br{constructor(t,i,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Tt(this,t)}}const ze=Ut.litHtmlPolyfillSupport;ze==null||ze(Qt,se),(Ut.litHtmlVersions??(Ut.litHtmlVersions=[])).push("3.2.1");const xr=(e,t,i)=>{const n=t;let r=n._$litPart$;return r===void 0&&(n._$litPart$=r=new se(t.insertBefore(Kt(),null),null,void 0,{})),r._$AI(e),r};var tt=typeof window<"u"?window:null,cn=tt===null,jt=cn?void 0:tt.document,nt="addEventListener",it="removeEventListener",Ie="getBoundingClientRect",Vt="_a",rt="_b",dt="_c",he="horizontal",st=function(){return!1},_r=cn?"calc":["","-webkit-","-moz-","-o-"].filter(function(e){var t=jt.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length}).shift()+"calc",mi=function(e){return typeof e=="string"||e instanceof String},Rn=function(e){if(mi(e)){var t=jt.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},K=function(e,t,i){var n=e[t];return n!==void 0?n:i},ue=function(e,t,i,n){if(t){if(n==="end")return 0;if(n==="center")return e/2}else if(i){if(n==="start")return 0;if(n==="center")return e/2}return e},Er=function(e,t){var i=jt.createElement("div");return i.className="gutter gutter-"+t,i},Sr=function(e,t,i){var n={};return mi(t)?n[e]=t:n[e]=_r+"("+t+"% - "+i+"px)",n},kr=function(e,t){var i;return i={},i[e]=t+"px",i},Cr=function(e,t){if(t===void 0&&(t={}),cn)return{};var i=e,n,r,a,s,o,l;Array.from&&(i=Array.from(i));var c=Rn(i[0]),h=c.parentNode,u=getComputedStyle?getComputedStyle(h):null,p=u?u.flexDirection:null,g=K(t,"sizes")||i.map(function(){return 100/i.length}),y=K(t,"minSize",100),v=Array.isArray(y)?y:i.map(function(){return y}),x=K(t,"maxSize",1/0),A=Array.isArray(x)?x:i.map(function(){return x}),L=K(t,"expandToMin",!1),T=K(t,"gutterSize",10),B=K(t,"gutterAlign","center"),N=K(t,"snapOffset",30),V=Array.isArray(N)?N:i.map(function(){return N}),W=K(t,"dragInterval",1),D=K(t,"direction",he),H=K(t,"cursor",D===he?"col-resize":"row-resize"),X=K(t,"gutter",Er),Lt=K(t,"elementStyle",Sr),Ht=K(t,"gutterStyle",kr);D===he?(n="width",r="clientX",a="left",s="right",o="clientWidth"):D==="vertical"&&(n="height",r="clientY",a="top",s="bottom",o="clientHeight");function ct(k,m,E,$){var z=Lt(n,m,E,$);Object.keys(z).forEach(function(q){k.style[q]=z[q]})}function vt(k,m,E){var $=Ht(n,m,E);Object.keys($).forEach(function(z){k.style[z]=$[z]})}function j(){return l.map(function(k){return k.size})}function mt(k){return"touches"in k?k.touches[0][r]:k[r]}function f(k){var m=l[this.a],E=l[this.b],$=m.size+E.size;m.size=k/this.size*$,E.size=$-k/this.size*$,ct(m.element,m.size,this[rt],m.i),ct(E.element,E.size,this[dt],E.i)}function b(k){var m,E=l[this.a],$=l[this.b];this.dragging&&(m=mt(k)-this.start+(this[rt]-this.dragOffset),W>1&&(m=Math.round(m/W)*W),m<=E.minSize+E.snapOffset+this[rt]?m=E.minSize+this[rt]:m>=this.size-($.minSize+$.snapOffset+this[dt])&&(m=this.size-($.minSize+this[dt])),m>=E.maxSize-E.snapOffset+this[rt]?m=E.maxSize+this[rt]:m<=this.size-($.maxSize-$.snapOffset+this[dt])&&(m=this.size-($.maxSize+this[dt])),f.call(this,m),K(t,"onDrag",st)(j()))}function C(){var k=l[this.a].element,m=l[this.b].element,E=k[Ie](),$=m[Ie]();this.size=E[n]+$[n]+this[rt]+this[dt],this.start=E[a],this.end=E[s]}function S(k){if(!getComputedStyle)return null;var m=getComputedStyle(k);if(!m)return null;var E=k[o];return E===0?null:(D===he?E-=parseFloat(m.paddingLeft)+parseFloat(m.paddingRight):E-=parseFloat(m.paddingTop)+parseFloat(m.paddingBottom),E)}function M(k){var m=S(h);if(m===null||v.reduce(function(q,U){return q+U},0)>m)return k;var E=0,$=[],z=k.map(function(q,U){var Z=m*q/100,Mt=ue(T,U===0,U===k.length-1,B),ce=v[U]+Mt;return Z<ce?(E+=ce-Z,$.push(0),ce):($.push(Z-ce),Z)});return E===0?k:z.map(function(q,U){var Z=q;if(E>0&&$[U]-E>0){var Mt=Math.min(E,$[U]-E);E-=Mt,Z=q-Mt}return Z/m*100})}function R(){var k=this,m=l[k.a].element,E=l[k.b].element;k.dragging&&K(t,"onDragEnd",st)(j()),k.dragging=!1,tt[it]("mouseup",k.stop),tt[it]("touchend",k.stop),tt[it]("touchcancel",k.stop),tt[it]("mousemove",k.move),tt[it]("touchmove",k.move),k.stop=null,k.move=null,m[it]("selectstart",st),m[it]("dragstart",st),E[it]("selectstart",st),E[it]("dragstart",st),m.style.userSelect="",m.style.webkitUserSelect="",m.style.MozUserSelect="",m.style.pointerEvents="",E.style.userSelect="",E.style.webkitUserSelect="",E.style.MozUserSelect="",E.style.pointerEvents="",k.gutter.style.cursor="",k.parent.style.cursor="",jt.body.style.cursor=""}function _(k){if(!("button"in k&&k.button!==0)){var m=this,E=l[m.a].element,$=l[m.b].element;m.dragging||K(t,"onDragStart",st)(j()),k.preventDefault(),m.dragging=!0,m.move=b.bind(m),m.stop=R.bind(m),tt[nt]("mouseup",m.stop),tt[nt]("touchend",m.stop),tt[nt]("touchcancel",m.stop),tt[nt]("mousemove",m.move),tt[nt]("touchmove",m.move),E[nt]("selectstart",st),E[nt]("dragstart",st),$[nt]("selectstart",st),$[nt]("dragstart",st),E.style.userSelect="none",E.style.webkitUserSelect="none",E.style.MozUserSelect="none",E.style.pointerEvents="none",$.style.userSelect="none",$.style.webkitUserSelect="none",$.style.MozUserSelect="none",$.style.pointerEvents="none",m.gutter.style.cursor=H,m.parent.style.cursor=H,jt.body.style.cursor=H,C.call(m),m.dragOffset=mt(k)-m.end}}g=M(g);var P=[];l=i.map(function(k,m){var E={element:Rn(k),size:g[m],minSize:v[m],maxSize:A[m],snapOffset:V[m],i:m},$;if(m>0&&($={a:m-1,b:m,dragging:!1,direction:D,parent:h},$[rt]=ue(T,m-1===0,!1,B),$[dt]=ue(T,!1,m===i.length-1,B),p==="row-reverse"||p==="column-reverse")){var z=$.a;$.a=$.b,$.b=z}if(m>0){var q=X(m,D,E.element);vt(q,T,m),$[Vt]=_.bind($),q[nt]("mousedown",$[Vt]),q[nt]("touchstart",$[Vt]),h.insertBefore(q,E.element),$.gutter=q}return ct(E.element,E.size,ue(T,m===0,m===i.length-1,B),m),m>0&&P.push($),E});function I(k){var m=k.i===P.length,E=m?P[k.i-1]:P[k.i];C.call(E);var $=m?E.size-k.minSize-E[dt]:k.minSize+E[rt];f.call(E,$)}l.forEach(function(k){var m=k.element[Ie]()[n];m<k.minSize&&(L?I(k):k.minSize=m)});function Y(k){var m=M(k);m.forEach(function(E,$){if($>0){var z=P[$-1],q=l[z.a],U=l[z.b];q.size=m[$-1],U.size=E,ct(q.element,q.size,z[rt],q.i),ct(U.element,U.size,z[dt],U.i)}})}function et(k,m){P.forEach(function(E){if(m!==!0?E.parent.removeChild(E.gutter):(E.gutter[it]("mousedown",E[Vt]),E.gutter[it]("touchstart",E[Vt])),k!==!0){var $=Lt(n,E.a.size,E[rt]);Object.keys($).forEach(function(z){l[E.a].element.style[z]="",l[E.b].element.style[z]=""})}})}return{setSizes:Y,getSizes:j,collapse:function(m){I(l[m])},destroy:et,parent:h,pairs:P}};class O{constructor(t,i,n){this.width=t,this.height=i,this.pixels=new Uint8ClampedArray(n)}static fromJSON(t){return new O(t.width,t.height,t.pixels)}static empty(t,i,n){let r=new Array(t*i).fill(n);return new O(t,i,r)}static fromTile(t,i,n){let r=[];for(let a=0;a<i;a++)for(let s=0;s<t;s++)r.push(n.pixel(s%n.width,a%n.height));return new O(t,i,r)}overlay(t,i){const n=[];for(let r=0;r<t.height;r++)for(let a=0;a<t.width;a++)n.push({x:i[0]+a,y:i[1]+t.height-r-1,color:t.pixel(a,r)});return this.draw(n)}toJSON(){return{pixels:Array.from(this.pixels),width:this.width,height:this.height}}pad(t,i,n){const r=Array(i*(this.width+2*t)).fill(n),a=Array(t).fill(n);let s=this.make2d();return new O(this.width+2*t,this.height+2*i,[...s.reduce((o,l)=>[...o,...a,...l,...a],[...r]),...r])}resize(t,i,n=0){let r=[];for(let a=0;a<i;a++)for(let s=0;s<t;s++)a>=this.height||s>=this.width?r.push(n):r.push(this.pixel(s,a));return new O(t,i,r)}make2d(){let t=Array.from(this.pixels).slice(),i=[];for(;t.length>0;)i.push(t.splice(0,this.width));return i}vMirror(){return new O(this.width,this.height,this.make2d().toReversed().flat())}vFlip(){return new O(this.width,this.height,this.make2d().toReversed().flat())}pixel(t,i){return t>this.width-1||t<0||i>this.height-1||i<0?-1:this.pixels.at(t+i*this.width)}draw(t){let i=this.pixels.slice();for(let{x:n,y:r,color:a}of t)n<0||r<0||n>=this.width||r>=this.height||(i[n+r*this.width]=a);return new O(this.width,this.height,i)}brush({x:t,y:i},n){let r={x:t,y:i,color:n};return this.draw([r])}flood({x:t,y:i},n){const r=this.pixel(t,i);if(r===n)return this.draw([]);const a=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];let s=[{x:t,y:i,color:n}];for(let o=0;o<s.length;o++)for(let{dx:l,dy:c}of a){let h=s[o].x+l,u=s[o].y+c;h>=0&&h<this.width&&u>=0&&u<this.height&&this.pixel(h,u)==r&&!s.some(p=>p.x==h&&p.y==u)&&s.push({x:h,y:u,color:n})}return this.draw(s)}shift(t,i){let n=[];for(let r=0;r<this.height;r++)for(let a=0;a<this.width;a++)n.push({x:(a-t%this.width+this.width)%this.width,y:(r-i%this.height+this.height)%this.height,color:this.pixel(a,r)});return this.draw(n)}rect(t,i,n){let r=Math.min(t.x,i.x),a=Math.min(t.y,i.y),s=Math.max(t.x,i.x),o=Math.max(t.y,i.y),l=[];for(let c=a;c<=o;c++)for(let h=r;h<=s;h++)l.push({x:h,y:c,color:n});return this.draw(l)}line(t,i,n){let r=[];if(Math.abs(t.x-i.x)>Math.abs(t.y-i.y)){t.x>i.x&&([t,i]=[i,t]);let a=(i.y-t.y)/(i.x-t.x);for(let{x:s,y:o}=t;s<=i.x;s++)r.push({x:s,y:Math.round(o),color:n}),o+=a}else{t.y>i.y&&([t,i]=[i,t]);let a=(i.x-t.x)/(i.y-t.y);for(let{x:s,y:o}=t;o<=i.y;o++)r.push({x:Math.round(s),y:o,color:n}),s+=a}return this.draw(r)}}const $r="modulepreload",Ar=function(e){return"/knitscape-2024/"+e},Bn={},J=function(t,i,n){let r=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));r=Promise.allSettled(i.map(l=>{if(l=Ar(l),l in Bn)return;Bn[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":$r,c||(u.as="script"),u.crossOrigin="",u.href=l,o&&u.setAttribute("nonce",o),document.head.appendChild(u),c)return new Promise((p,g)=>{u.addEventListener("load",p),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return r.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return t().catch(a)})},yi=100,wi=5,bi=6,xi=.6,Pr=1e3,_i=["yarnPalette","yarnSequence","repeats"],hn={knit:new Path2D("M 0 0.5 L 0.4 0.5 C 0.7 0.5 0.7 0.2 0.5 0.2 C 0.3 0.2 0.3 0.5 0.6 0.5 L 1 0.5"),purl:new Path2D("M 1 0.5 L 0.6 0.5 C 0.3 0.5 0.3 0.8 0.5 0.8 C 0.7 0.8 0.7 0.5 0.4 0.5 L 0 0.5"),slip:new Path2D("M 0 0.5 L 1 0.5"),tuck:new Path2D("M 0 0.5 L 0.2 0.5 C 0.3 0.5 0.35 0.5 0.4 0.45 C 0.45 0.4 0.4 0.2 0.5 0.2 C 0.6 0.2 0.55 0.4 0.6 0.45 C 0.65 0.5 0.7 0.5 0.8 0.5 L 1 0.5")},Ei={knit:!1,purl:!1,slip:!0,tuck:!0},Lr=[{opName:"knit",color:"#000000",path:new Path2D("M 0 0.5 L 0.4 0.5 C 0.7 0.5 0.7 0.2 0.5 0.2 C 0.3 0.2 0.3 0.5 0.6 0.5 L 1 0.5")},{opName:"purl",color:"#333333",path:new Path2D("M 1 0.5 L 0.6 0.5 C 0.3 0.5 0.3 0.8 0.5 0.8 C 0.7 0.8 0.7 0.5 0.4 0.5 L 0 0.5")},{opName:"slip",color:"#ffffff",path:new Path2D("M 0 0.5 L 1 0.5")},{opName:"tuck",color:"#cccccc",path:new Path2D("M 0 0.5 L 0.2 0.5 C 0.3 0.5 0.35 0.5 0.4 0.45 C 0.45 0.4 0.4 0.2 0.5 0.2 C 0.6 0.2 0.55 0.4 0.6 0.45 C 0.65 0.5 0.7 0.5 0.8 0.5 L 1 0.5")}],Mr=["knit","purl","slip","tuck"],Rr=Object.assign({"../examples/basketweave.json":()=>J(()=>import("./basketweave-hKyJLA9q.js"),[]),"../examples/beetles.json":()=>J(()=>import("./beetles-BPssPfT6.js"),[]),"../examples/birds.json":()=>J(()=>import("./birds-DmdOULOk.js"),[]),"../examples/ells.json":()=>J(()=>import("./ells-B9mCPQfL.js"),[]),"../examples/hat mosaic.json":()=>J(()=>import("./hat mosaic-BTINFtu1.js"),[]),"../examples/hex quilt.json":()=>J(()=>import("./hex quilt-BsuDD9VA.js"),[]),"../examples/hourglass.json":()=>J(()=>import("./hourglass-CKa4yPZV.js"),[]),"../examples/interblocks.json":()=>J(()=>import("./interblocks-ChFd_WOU.js"),[]),"../examples/pseudoweave.json":()=>J(()=>import("./pseudoweave-DDCG01YT.js"),[]),"../examples/pseudoweave_wool.json":()=>J(()=>import("./pseudoweave_wool-B6meBy1F.js"),[]),"../examples/pyramids (slip).json":()=>J(()=>import("./pyramids (slip)-aGDcl6SJ.js"),[]),"../examples/pyramids (tuck).json":()=>J(()=>import("./pyramids (tuck)-6gPqbf5X.js"),[]),"../examples/scrunched ovals.json":()=>J(()=>import("./scrunched ovals-B1_SnACF.js"),[]),"../examples/squargets.json":()=>J(()=>import("./squargets-BKcsvc1I.js"),[]),"../examples/sunset dots.json":()=>J(()=>import("./sunset dots-DBi8ESHE.js"),[]),"../examples/teardown.json":()=>J(()=>import("./teardown-D2-FWyzY.js"),[])}),Si={brush:{icon:"fa-solid fa-paintbrush",hotkey:"b"},flood:{icon:"fa-solid fa-fill-drip fa-flip-horizontal",hotkey:"f"},rect:{icon:"fa-solid fa-vector-square",hotkey:"r"},line:{icon:"fa-solid fa-minus",hotkey:"l"},shift:{icon:"fa-solid fa-right-left",hotkey:"s"},move:{hotkey:"h"}};let d={editingPalette:!1,transforming:!1,activeTool:"brush",activeSymbol:0,chartBackground:"#ffffff",symbolPalette:{},symbolMap:Mr,patternLibrary:Rr,scale:15,pos:{x:-1,y:-1},chartPan:{x:0,y:0},simScale:1,simPan:{x:0,y:0},activeYarn:0,yarnPalette:["rgba(16,18,189,1)","rgba(235,233,187,1)","rgba(247,85,0,1)"],yarnSequence:new O(1,8,[1,1,1,1,2,2,0,0]),editingRepeat:0,repeatPos:[-1,-1],repeats:[{bitmap:new O(4,8,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0]),pos:[0,0],area:[48,60]}],repeatLibrary:[{title:"blank",bitmap:new O(2,2,[0,0,0,0])},{title:"checks",bitmap:new O(2,2,[0,2,2,0])},{title:"stripe",bitmap:new O(2,2,[0,2,0,2])}],chart:O.empty(48,60,0),reverseScroll:!1,grid:!0,symbolLineWidth:3,flipped:!1,punchcardMode:!1,machine:"th860",punchVerticalRepeats:5,rows:40,numSides:8,showLibrary:!1,showSettings:!1,showDownload:!1,showRepeatLibrary:!1,debug:!1,snapshots:[],lastSnapshot:0,heldKeys:new Set};function Br(e){if(!(d.lastSnapshot<Date.now()-Pr))return!1;for(const t of _i)if(t in e)return!0;return!1}function Nr(e){return d={...d,...e,snapshots:[Object.fromEntries(_i.map(t=>[t,d[t]])),...d.snapshots],lastSnapshot:Date.now()},d}function Tr(e){return d={...d,...e},d}function zr(e){return Br(e)?Nr(e):Tr(e)}function ki(){if(d.snapshots.length<1)return;const e=Object.keys(d.snapshots[0]);d={...d,...d.snapshots[0],lastSnapshot:0,snapshots:d.snapshots.slice(1)},un.syncState(d,e)}function w(e){const t=Object.keys(e);un.syncState(zr(e),t)}const un=(()=>{const e=[];function t(n,r){e.forEach(a=>{a.syncState(n,r)})}function i(n){n.forEach(r=>e.push(r({state:d,dispatch:w})))}return{register:i,syncState:t}})();function Ir(e){const t=e.getBoundingClientRect();return{width:t.width*devicePixelRatio,height:t.height*devicePixelRatio}}function be(e,t){const i=t.getBoundingClientRect(),n=Math.floor((e.clientX-i.x)/d.scale*devicePixelRatio),r=Math.floor((e.clientY-i.y)/d.scale*devicePixelRatio);return{x:n,y:d.yarnSequence.height-r-1}}function bt(e,t){const i=t.getBoundingClientRect(),n=Math.floor((e.clientX-i.x)/d.scale*devicePixelRatio),r=Math.floor((e.clientY-i.y)/d.scale*devicePixelRatio);return{x:n,y:r}}function xe(){const e="0123456789ABCDEF";let t="#";for(let i=0;i<6;i++)t+=e[Math.floor(Math.random()*16)];return t}function Me(e,t){const i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("download",t),document.body.appendChild(i),i.click(),i.remove()}function Dr(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function Hr(e){const t=new ImageData(e.width,e.height);for(let i=0;i<e.pixels.length;i++){const n=e.pixels[i],r=Fr(Lr[n].color);t.data[i*4]=r[0],t.data[i*4+1]=r[1],t.data[i*4+2]=r[2],t.data[i*4+3]=255}return t}function Fr(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Vr(e){return e.sort(()=>Math.random()>.5?1:-1)}function Or(){var e=window.document,t=e.documentElement,i=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,n=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;!e.fullscreenElement&&!e.mozFullScreenElement&&!e.webkitFullscreenElement&&!e.msFullscreenElement?i.call(t):n.call(e)}function De(e){let t=document.getElementById("desktop").getBoundingClientRect();$i({x:t.width/2,y:t.height/2},e)}function He(e){let t=document.getElementById("sim-container").getBoundingClientRect();Ci({x:t.width/2,y:t.height/2},e)}function Ci(e,t){if(t<xi||t>bi)return;const i={x:(e.x-d.simPan.x)/d.simScale,y:(e.y-d.simPan.y)/d.simScale};w({simScale:t,simPan:{x:e.x-i.x*t,y:e.y-i.y*t}})}function $i(e,t){if(t<wi||t>yi)return;const i={x:(e.x-d.chartPan.x)/d.scale,y:(e.y-d.chartPan.y)/d.scale};w({scale:t,chartPan:{x:e.x-i.x*t,y:e.y-i.y*t}})}function Dt(){const{width:e,height:t}=Ir(document.getElementById("desktop")),i=Math.floor(.9*Math.min(Math.floor(e/d.chart.width),Math.floor(t/d.chart.height)));w({scale:i,chartPan:{x:(e-i*d.chart.width)/2/devicePixelRatio,y:(t-i*d.chart.height)/2/devicePixelRatio}})}function _e(e,t,i){e.width=d.scale*t,e.height=d.scale*i,e.style.width=`${d.scale*t/devicePixelRatio}px`,e.style.height=`${d.scale*i/devicePixelRatio}px`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Bt(e,t,i){return e?t(e):i==null?void 0:i(e)}function Ai(e){let{yarnSequence:t,yarnPalette:i,repeats:n,width:r,height:a}=e;w({yarnPalette:i,width:r,height:a,yarnSequence:O.fromJSON(t),chart:O.empty(r,a,0),repeats:n.map(({bitmap:s,pos:o,area:l})=>({bitmap:O.fromJSON(s),pos:o,area:l}))}),Dt()}function Wr(){w({repeats:[],yarnSequence:new O(1,4,[0,0,1,1]),yarnPalette:[xe(),xe()],chart:O.empty(30,40,0),repeats:[{bitmap:new O(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),area:[30,40],pos:[0,0]}]}),Dt()}function qr(e){w({showLibrary:!1}),d.patternLibrary[e]().then(t=>Ai(t))}function Yr(){let e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",document.body.appendChild(e),e.click(),e.onchange=t=>{let i=t.target.files[0];const n=new FileReader;n.readAsText(i),n.onload=()=>{Ai(JSON.parse(n.result))}},document.body.removeChild(e)}function Gr(e){e=e>500?500:e,w({chart:d.chart.resize(e,d.chart.height)}),Dt()}function Xr(e){e=e>500?500:e,w({chart:d.chart.resize(d.chart.width,e)}),Dt()}function Ur(){return F`<div id="taskbar">
    <h1 class="site-title">KnitScape-2024</h1>
    <div id="chart-size-controls">
      <label>Width</label>
      <input
        class="input"
        type="number"
        .value=${d.chart.width}
        @change=${e=>Gr(Number(e.target.value))}
        min="5"
        max="1000" />
      <label>Height</label>
      <input
        class="input"
        type="number"
        .value=${d.chart.height}
        @change=${e=>Xr(Number(e.target.value))}
        min="5"
        max="1000" />
    </div>
    <div class="taskbar-buttons">
      <button class="btn icon" @click=${()=>ki()}>
        <i class="fa-solid fa-rotate-left"></i>
      </button>
      <button class="btn icon" @click=${()=>Wr()}>
        <i class="fa-solid fa-file"></i>
      </button>
      <button class="btn icon" @click=${()=>Yr()}>
        <i class="fa-solid fa-upload"></i>
      </button>
      <button class="btn icon" @click=${()=>w({showDownload:!0})}>
        <i class="fa-solid fa-download"></i>
      </button>
      <button
        class="btn icon ${d.showLibrary?"open":""}"
        @click=${()=>w({showLibrary:!d.showLibrary})}>
        <i class="fa-solid fa-book"></i>
      </button>
      <button
        class="btn icon ${d.showSettings?"open":""}"
        @click=${()=>w({showSettings:!d.showSettings})}>
        <i class="fa-solid fa-gear"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>window.open("https://github.com/branchwelder/knitscape")}>
        <i class="fa-brands fa-github"></i>
      </button>

      <button class="btn icon" @click=${()=>Or()}>
        <i
          class="fa-solid fa-${!window.document.fullscreenElement&&!window.document.mozFullScreenElement&&!window.document.webkitFullscreenElement&&!window.document.msFullscreenElement?"up-right-and-down-left-from-center":"down-left-and-up-right-to-center"}"></i>
      </button>
    </div>
  </div>`}function Kr(){const e=document.getElementById("punchcard");let i=new XMLSerializer().serializeToString(e);i.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(i=i.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),i.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(i=i.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),i=`<?xml version="1.0" standalone="no"?>\r
`+i,Me("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i),"punchcard.svg")}function Jr(){const e=`SilverKnit
`+d.repeats[0].bitmap.make2d().map(t=>t.map(i=>i==0||i==1?7:8).join("")).join(`
`);Me("data:text/plain;charset=utf-8,"+encodeURIComponent(e),"pattern.txt")}function Zr(){const e=d.chart.width,t=d.chart.height,i=[];for(let r=0;r<t;r++){let a=d.yarnSequence.pixel(0,(t-r-1)%d.yarnSequence.height);i.push(new Array(e).fill(a).join(""))}const n=`FILE FORMAT : DAK
YARNS
`+i.join(`
`)+`
YARN PALETTE
STITCH SYMBOLS
`+d.chart.make2d().map(r=>r.map(a=>a==0||a==1?".":"-").join("")).join(`
`)+`
END`;Me("data:text/plain;charset=utf-8,"+encodeURIComponent(n),"pattern.txt")}function Qr(){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({width:d.chart.width,height:d.chart.height,repeats:d.repeats.map(({bitmap:t,pos:i,area:n})=>({bitmap:t.toJSON(),pos:i,area:n})),yarnPalette:d.yarnPalette,yarnSequence:d.yarnSequence.toJSON()}));Me(e,"pattern.json")}const Pt={th860:{cardWidth:144,holeSize:5,cols:24,punchRadius:3.75/2,h:4.5,v:5,b:16,c:11}};function pt(e,t,i=Pt[d.machine].punchRadius){const n=[],r=2*Math.PI/d.numSides;for(let a=0;a<d.numSides;a++)n.push([e+i*Math.sin(a*r),t+i*Math.cos(a*r)]);return pr`<polygon points="${n.map(a=>`${a[0]},${a[1]}`)}" />`}function jr(){const{b:e,c:t,h:i,v:n,cols:r}=Pt[d.machine],a=[];for(let s=0;s<r;s++)a.push(pt(e+i/2+s*i,t+n/2-n)),a.push(pt(e+i/2+s*i,t+n/2-2*n)),a.push(pt(e+i/2+s*i,t+n/2+d.rows*n)),a.push(pt(e+i/2+s*i,t+n/2+(d.rows+1)*n));return a}function ts(){const{b:e,h:t,c:i,v:n,cols:r}=Pt[d.machine],a=O.fromTile(r,d.rows,d.repeats[0].bitmap).make2d(),s=[];for(let o=0;o<a.length;o++)for(let l=0;l<a[0].length;l++)a[o][l]==0&&s.push(pt(t*l+e+t/2,n*o+i+n/2));return s}function es(){const{b:e,h:t,c:i,v:n,cols:r,punchRadius:a}=Pt[d.machine],s=[];for(let o=-2;o<d.rows+2;o++)s.push(pt(e+t/2-5.5,i+n/2+o*n,a-.25)),s.push(pt(e+t/2+(r-1)*t+5.5,i+n/2+o*n,a-.25));return s}function ns(){const{b:e,c:t,v:i,h:n,cols:r}=Pt[d.machine],a=[];for(const s of[-1,0,d.rows/2-1,d.rows/2])a.push(pt(e-10.5,t+i+s*2*i)),a.push(pt(e+r*n+10.5,t+(s*2+1)*i));return a}function Fe(){const{v:e,c:t}=Pt[d.machine];return d.rows*e+2*t}function Ve(){const{cols:e,h:t,b:i}=Pt[d.machine];return e*t+2*i}function is(){return F` <div class="punchcard-preview">
    
    <svg
      id="punchcard"
      viewBox="0 0 ${Ve()} ${Fe()}"
      width="${Ve()}mm"
      height="${Fe()}mm">
      <g stroke="black" stroke-width="0.5" fill="none">
        <rect width="${Ve()}" height="${Fe()}" />
        ${jr()}${es()}${ns()}${ts()}
      </g>
    </svg>
  </div>
</div>`}function rs(){document.getElementById("preview-canvas").toBlob(t=>{const i=document.createElement("a");i.href=URL.createObjectURL(t),i.download="output.bmp",i.click()},"image/bmp")}function ss(e){const t=document.getElementById("preview-canvas");if(!t)return;const i=t.parentNode;t.width=e.width,t.height=e.height;const n=i.clientHeight,r=n/e.height;t.style.width=`${e.width*r}px`,t.style.height=`${n}px`,t.style.imageRendering="pixelated",t.style.imageRendering="crisp-edges";const a=t.getContext("2d"),s=Hr(e);a.putImageData(s,0,0)}function as(){return ss(d.repeats[0].bitmap),F`<div class="modal">
    <div class="modal-content">
      <h2>Export Workspace</h2>
      <div style="display: flex; gap: 5px;">
        <button class="btn solid" @click=${()=>Qr()}>
          Workspace JSON
        </button>
      </div>

      <h2>Export Repeat</h2>
      <div style="display: flex; gap: 15px;">
        <canvas id="preview-canvas"> </canvas>
        <div style="display: flex; flex-direction: column; gap: 5px;">
          <button class="btn solid" @click=${()=>rs()}>BMP</button>
          <button class="btn solid" @click=${()=>Jr()}>
            TXT (SilverKnit)
          </button>
          <button class="btn solid" @click=${()=>Zr()}>
            TXT (Kniterate)
          </button>
        </div>
      </div>

      <h2>Punchcard</h2>
      <p>Supports Brother/Taitexma 24-stitch punchcards.</p>
      <label class="form-control range">
        Vertical Repeats
        <input
          type="range"
          name="line-width"
          min="1"
          max="10"
          .value=${String(d.punchVerticalRepeats)}
          @input=${e=>w({punchVerticalRepeats:Number(e.target.value),rows:Number(e.target.value)*d.repeats[0].bitmap.height})} />
      </label>

      ${is()}
      <button class="btn solid" @click=${()=>Kr()}>
        Download Punchcard SVG
      </button>
    </div>
  </div>`}function os(){return F` <div id="library-modal" class="modal">
    <h2>Pattern Library</h2>
    <div class="modal-content">
      ${Object.entries(d.patternLibrary).map(([e,t])=>F`<div class="library-item">
            <span>${e.split("/").at(-1).split(".")[0]}</span>
            <button class="btn solid" @click=${()=>qr(e)}>
              <i class="fa-solid fa-upload"></i>
            </button>
          </div>`)}
    </div>
  </div>`}var ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Pi={exports:{}};/**
 * jscolor - JavaScript Color Picker
 *
 * @link    http://jscolor.com
 * @license For open source use: GPLv3
 *          For commercial use: JSColor Commercial License
 * @author  Jan Odvarko - East Desire
 *
 * See usage examples at http://jscolor.com/examples/
 */(function(e){(function(t,i){{e.exports=t.document?i(t):function(n){if(!n.document)throw new Error("jscolor needs a window with document");return i(n)};return}})(typeof window<"u"?window:ls,function(t){var i=function(){var n={initialized:!1,instances:[],readyQueue:[],register:function(){typeof t<"u"&&t.document&&(t.document.readyState!=="loading"?n.pub.init():t.document.addEventListener("DOMContentLoaded",n.pub.init,!1))},installBySelector:function(r,a){if(a=a?n.node(a):t.document,!a)throw new Error("Missing root node");for(var s=a.querySelectorAll(r),o=new RegExp("(^|\\s)("+n.pub.lookupClass+")(\\s*(\\{[^}]*\\})|\\s|$)","i"),l=0;l<s.length;l+=1)if(!(s[l].jscolor&&s[l].jscolor instanceof n.pub)&&!(s[l].type!==void 0&&s[l].type.toLowerCase()=="color"&&n.isColorAttrSupported)){var c,h;if((c=n.getDataAttr(s[l],"jscolor"))!==null||s[l].className&&(h=s[l].className.match(o))){var u=s[l],p="";c!==null?p=c:h&&(console.warn('Installation using class name is DEPRECATED. Use data-jscolor="" attribute instead.'+n.docsRef),h[4]&&(p=h[4]));var g=null;if(p.trim())try{g=n.parseOptionsStr(p)}catch(y){console.warn(y+`
`+p)}try{new n.pub(u,g)}catch(y){console.warn(y)}}}},parseOptionsStr:function(r){var a=null;try{a=JSON.parse(r)}catch(s){if(n.pub.looseJSON)try{a=new Function("var opts = ("+r+'); return typeof opts === "object" ? opts : {};')()}catch(o){throw new Error("Could not evaluate jscolor options: "+o)}else throw new Error("Could not parse jscolor options as JSON: "+s)}return a},getInstances:function(){for(var r=[],a=0;a<n.instances.length;a+=1)n.instances[a]&&n.instances[a].targetElement&&r.push(n.instances[a]);return r},createEl:function(r){var a=t.document.createElement(r);return n.setData(a,"gui",!0),a},node:function(r){if(!r)return null;if(typeof r=="string"){var a=r,s=null;try{s=t.document.querySelector(a)}catch(o){return console.warn(o),null}return s||console.warn("No element matches the selector: %s",a),s}return n.isNode(r)?r:(console.warn("Invalid node of type %s: %s",typeof r,r),null)},isNode:function(r){return typeof Node=="object"?r instanceof Node:r&&typeof r=="object"&&typeof r.nodeType=="number"&&typeof r.nodeName=="string"},nodeName:function(r){return r&&r.nodeName?r.nodeName.toLowerCase():!1},removeChildren:function(r){for(;r.firstChild;)r.removeChild(r.firstChild)},isTextInput:function(r){return r&&n.nodeName(r)==="input"&&r.type.toLowerCase()==="text"},isButton:function(r){if(!r)return!1;var a=n.nodeName(r);return a==="button"||a==="input"&&["button","submit","reset"].indexOf(r.type.toLowerCase())>-1},isButtonEmpty:function(r){switch(n.nodeName(r)){case"input":return!r.value||r.value.trim()==="";case"button":return r.textContent.trim()===""}return null},isPassiveEventSupported:function(){var r=!1;try{var a=Object.defineProperty({},"passive",{get:function(){r=!0}});t.addEventListener("testPassive",null,a),t.removeEventListener("testPassive",null,a)}catch{}return r}(),isColorAttrSupported:function(){var r=t.document.createElement("input");return!!(r.setAttribute&&(r.setAttribute("type","color"),r.type.toLowerCase()=="color"))}(),dataProp:"_data_jscolor",setData:function(){var r=arguments[0];if(arguments.length===3){var a=r.hasOwnProperty(n.dataProp)?r[n.dataProp]:r[n.dataProp]={},s=arguments[1],o=arguments[2];return a[s]=o,!0}else if(arguments.length===2&&typeof arguments[1]=="object"){var a=r.hasOwnProperty(n.dataProp)?r[n.dataProp]:r[n.dataProp]={},l=arguments[1];for(var s in l)l.hasOwnProperty(s)&&(a[s]=l[s]);return!0}throw new Error("Invalid arguments")},removeData:function(){var r=arguments[0];if(!r.hasOwnProperty(n.dataProp))return!0;for(var a=1;a<arguments.length;a+=1){var s=arguments[a];delete r[n.dataProp][s]}return!0},getData:function(r,a,s){if(!r.hasOwnProperty(n.dataProp))if(s!==void 0)r[n.dataProp]={};else return;var o=r[n.dataProp];return!o.hasOwnProperty(a)&&s!==void 0&&(o[a]=s),o[a]},getDataAttr:function(r,a){var s="data-"+a,o=r.getAttribute(s);return o},setDataAttr:function(r,a,s){var o="data-"+a;r.setAttribute(o,s)},_attachedGroupEvents:{},attachGroupEvent:function(r,a,s,o){n._attachedGroupEvents.hasOwnProperty(r)||(n._attachedGroupEvents[r]=[]),n._attachedGroupEvents[r].push([a,s,o]),a.addEventListener(s,o,!1)},detachGroupEvents:function(r){if(n._attachedGroupEvents.hasOwnProperty(r)){for(var a=0;a<n._attachedGroupEvents[r].length;a+=1){var s=n._attachedGroupEvents[r][a];s[0].removeEventListener(s[1],s[2],!1)}delete n._attachedGroupEvents[r]}},preventDefault:function(r){r.preventDefault&&r.preventDefault(),r.returnValue=!1},triggerEvent:function(r,a,s,o){if(r){var l=null;return typeof Event=="function"?l=new Event(a,{bubbles:s,cancelable:o}):(l=t.document.createEvent("Event"),l.initEvent(a,s,o)),l?(n.setData(l,"internal",!0),r.dispatchEvent(l),!0):!1}},triggerInputEvent:function(r,a,s,o){r&&n.isTextInput(r)&&n.triggerEvent(r,a,s,o)},eventKey:function(r){var a={9:"Tab",13:"Enter",27:"Escape"};return typeof r.code=="string"?r.code:r.keyCode!==void 0&&a.hasOwnProperty(r.keyCode)?a[r.keyCode]:null},strList:function(r){return r?r.replace(/^\s+|\s+$/g,"").split(/\s+/):[]},hasClass:function(r,a){return a?r.classList!==void 0?r.classList.contains(a):(" "+r.className.replace(/\s+/g," ")+" ").indexOf(" "+a+" ")!=-1:!1},addClass:function(r,a){var s=n.strList(a);if(r.classList!==void 0){for(var o=0;o<s.length;o+=1)r.classList.add(s[o]);return}for(var o=0;o<s.length;o+=1)n.hasClass(r,s[o])||(r.className+=(r.className?" ":"")+s[o])},removeClass:function(r,a){var s=n.strList(a);if(r.classList!==void 0){for(var o=0;o<s.length;o+=1)r.classList.remove(s[o]);return}for(var o=0;o<s.length;o+=1){var l=new RegExp("^\\s*"+s[o]+"\\s*|\\s*"+s[o]+"\\s*$|\\s+"+s[o]+"(\\s+)","g");r.className=r.className.replace(l,"$1")}},getCompStyle:function(r){var a=t.getComputedStyle?t.getComputedStyle(r):r.currentStyle;return a||{}},setStyle:function(r,a,s,o){var l=s?"important":"",c=null;for(var h in a)if(a.hasOwnProperty(h)){var u=null;a[h]===null?(c||(c=n.getData(r,"origStyle")),c&&c.hasOwnProperty(h)&&(u=c[h])):(o&&(c||(c=n.getData(r,"origStyle",{})),c.hasOwnProperty(h)||(c[h]=r.style[h])),u=a[h]),u!==null&&r.style.setProperty(h,u,l)}},appendCss:function(r){var a=document.querySelector("head"),s=document.createElement("style");s.innerText=r,a.appendChild(s)},appendDefaultCss:function(r){n.appendCss([".jscolor-wrap, .jscolor-wrap div, .jscolor-wrap canvas { position:static; display:block; visibility:visible; overflow:visible; margin:0; padding:0; border:none; border-radius:0; outline:none; z-index:auto; float:none; width:auto; height:auto; left:auto; right:auto; top:auto; bottom:auto; min-width:0; min-height:0; max-width:none; max-height:none; background:none; clip:auto; opacity:1; transform:none; box-shadow:none; box-sizing:content-box; }",".jscolor-wrap { clear:both; }",".jscolor-wrap .jscolor-picker { position:relative; }",".jscolor-wrap .jscolor-shadow { position:absolute; left:0; top:0; width:100%; height:100%; }",".jscolor-wrap .jscolor-border { position:relative; }",".jscolor-wrap .jscolor-palette { position:absolute; }",".jscolor-wrap .jscolor-palette-sw { position:absolute; display:block; cursor:pointer; }",".jscolor-wrap .jscolor-btn { position:absolute; overflow:hidden; white-space:nowrap; font:13px sans-serif; text-align:center; cursor:pointer; }"].join(`
`))},hexColor:function(r,a,s){return"#"+(("0"+Math.round(r).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)).toUpperCase()},hexaColor:function(r,a,s,o){return"#"+(("0"+Math.round(r).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)+("0"+Math.round(o*255).toString(16)).slice(-2)).toUpperCase()},rgbColor:function(r,a,s){return"rgb("+Math.round(r)+","+Math.round(a)+","+Math.round(s)+")"},rgbaColor:function(r,a,s,o){return"rgba("+Math.round(r)+","+Math.round(a)+","+Math.round(s)+","+Math.round((o??1)*100)/100+")"},linearGradient:function(){function r(){for(var s="linear-gradient",o=["","-webkit-","-moz-","-o-","-ms-"],l=t.document.createElement("div"),c=0;c<o.length;c+=1){var h=o[c]+s,u=h+"(to right, rgba(0,0,0,0), rgba(0,0,0,0))";if(l.style.background=u,l.style.background)return h}return s}var a=r();return function(){return a+"("+Array.prototype.join.call(arguments,", ")+")"}}(),setBorderRadius:function(r,a){n.setStyle(r,{"border-radius":a||"0"})},setBoxShadow:function(r,a){n.setStyle(r,{"box-shadow":a||"none"})},getElementPos:function(r,a){var s=0,o=0,l=r.getBoundingClientRect();if(s=l.left,o=l.top,!a){var c=n.getViewPos();s+=c[0],o+=c[1]}return[s,o]},getElementSize:function(r){return[r.offsetWidth,r.offsetHeight]},getAbsPointerPos:function(r){var a=0,s=0;return typeof r.changedTouches<"u"&&r.changedTouches.length?(a=r.changedTouches[0].clientX,s=r.changedTouches[0].clientY):typeof r.clientX=="number"&&(a=r.clientX,s=r.clientY),{x:a,y:s}},getRelPointerPos:function(r){var a=r.target||r.srcElement,s=a.getBoundingClientRect(),o=0,l=0,c=0,h=0;return typeof r.changedTouches<"u"&&r.changedTouches.length?(c=r.changedTouches[0].clientX,h=r.changedTouches[0].clientY):typeof r.clientX=="number"&&(c=r.clientX,h=r.clientY),o=c-s.left,l=h-s.top,{x:o,y:l}},getViewPos:function(){var r=t.document.documentElement;return[(t.pageXOffset||r.scrollLeft)-(r.clientLeft||0),(t.pageYOffset||r.scrollTop)-(r.clientTop||0)]},getViewSize:function(){var r=t.document.documentElement;return[t.innerWidth||r.clientWidth,t.innerHeight||r.clientHeight]},RGB_HSV:function(r,a,s){r/=255,a/=255,s/=255;var o=Math.min(Math.min(r,a),s),l=Math.max(Math.max(r,a),s),c=l-o;if(c===0)return[null,0,100*l];var h=r===o?3+(s-a)/c:a===o?5+(r-s)/c:1+(a-r)/c;return[60*(h===6?0:h),100*(c/l),100*l]},HSV_RGB:function(r,a,s){var o=255*(s/100);if(r===null)return[o,o,o];r/=60,a/=100;var l=Math.floor(r),c=l%2?r-l:1-(r-l),h=o*(1-a),u=o*(1-a*c);switch(l){case 6:case 0:return[o,u,h];case 1:return[u,o,h];case 2:return[h,o,u];case 3:return[h,u,o];case 4:return[u,h,o];case 5:return[o,h,u]}},parseColorString:function(r){var a={rgba:null,format:null},s;if(s=r.match(/^\W*([0-9A-F]{3,8})\W*$/i)){if(s[1].length===8)a.format="hexa",a.rgba=[parseInt(s[1].slice(0,2),16),parseInt(s[1].slice(2,4),16),parseInt(s[1].slice(4,6),16),parseInt(s[1].slice(6,8),16)/255];else if(s[1].length===6)a.format="hex",a.rgba=[parseInt(s[1].slice(0,2),16),parseInt(s[1].slice(2,4),16),parseInt(s[1].slice(4,6),16),null];else if(s[1].length===3)a.format="hex",a.rgba=[parseInt(s[1].charAt(0)+s[1].charAt(0),16),parseInt(s[1].charAt(1)+s[1].charAt(1),16),parseInt(s[1].charAt(2)+s[1].charAt(2),16),null];else return!1;return a}if(s=r.match(/^\W*rgba?\(([^)]*)\)\W*$/i)){var o=s[1].split(","),l=/^\s*(\d+|\d*\.\d+|\d+\.\d*)\s*$/,c,h,u,p;if(o.length>=3&&(c=o[0].match(l))&&(h=o[1].match(l))&&(u=o[2].match(l)))return a.format="rgb",a.rgba=[parseFloat(c[1])||0,parseFloat(h[1])||0,parseFloat(u[1])||0,null],o.length>=4&&(p=o[3].match(l))&&(a.format="rgba",a.rgba[3]=parseFloat(p[1])||0),a}return!1},parsePaletteValue:function(r){var a=[];typeof r=="string"?r.replace(/#[0-9A-F]{3}\b|#[0-9A-F]{6}([0-9A-F]{2})?\b|rgba?\(([^)]*)\)/ig,function(c){a.push(c)}):Array.isArray(r)&&(a=r);for(var s=[],o=0;o<a.length;o++){var l=n.parseColorString(a[o]);l&&s.push(l)}return s},containsTranparentColor:function(r){for(var a=0;a<r.length;a++){var s=r[a].rgba[3];if(s!==null&&s<1)return!0}return!1},isAlphaFormat:function(r){switch(r.toLowerCase()){case"hexa":case"rgba":return!0}return!1},scaleCanvasForHighDPR:function(r){var a=t.devicePixelRatio||1;r.width*=a,r.height*=a;var s=r.getContext("2d");s.scale(a,a)},genColorPreviewCanvas:function(r,a,s,o){var l=Math.round(n.pub.previewSeparator.length),c=n.pub.chessboardSize,h=n.pub.chessboardColor1,u=n.pub.chessboardColor2,p=s||c*2,g=c*2,y=n.createEl("canvas"),v=y.getContext("2d");y.width=p,y.height=g,o&&n.scaleCanvasForHighDPR(y),v.fillStyle=h,v.fillRect(0,0,p,g),v.fillStyle=u;for(var x=0;x<p;x+=c*2)v.fillRect(x,0,c,c),v.fillRect(x+c,c,c,c);r&&(v.fillStyle=r,v.fillRect(0,0,p,g));var A=null;switch(a){case"left":A=0,v.clearRect(0,0,l/2,g);break;case"right":A=p-l,v.clearRect(p-l/2,0,l/2,g);break}if(A!==null){v.lineWidth=1;for(var L=0;L<n.pub.previewSeparator.length;L+=1)v.beginPath(),v.strokeStyle=n.pub.previewSeparator[L],v.moveTo(.5+A+L,0),v.lineTo(.5+A+L,g),v.stroke()}return{canvas:y,width:p,height:g}},genColorPreviewGradient:function(r,a,s){var o=[];return a&&s?o=["to "+{left:"right",right:"left"}[a],r+" 0%",r+" "+s+"px","rgba(0,0,0,0) "+(s+1)+"px","rgba(0,0,0,0) 100%"]:o=["to right",r+" 0%",r+" 100%"],n.linearGradient.apply(this,o)},redrawPosition:function(){if(!(!n.picker||!n.picker.owner)){var r=n.picker.owner;if(r.container!==t.document.body)n._drawPosition(r,0,0,"relative",!1);else{var a,s;r.fixed?(a=n.getElementPos(r.targetElement,!0),s=[0,0]):(a=n.getElementPos(r.targetElement),s=n.getViewPos());var o=n.getElementSize(r.targetElement),l=n.getViewSize(),c=n.getPickerDims(r),h=[c.borderW,c.borderH],u,p,g;switch(r.position.toLowerCase()){case"left":u=1,p=0,g=-1;break;case"right":u=1,p=0,g=1;break;case"top":u=0,p=1,g=-1;break;default:u=0,p=1,g=1;break}var y=(o[p]+h[p])/2;if(r.smartPosition)var v=[-s[u]+a[u]+h[u]>l[u]&&-s[u]+a[u]+o[u]/2>l[u]/2&&a[u]+o[u]-h[u]>=0?a[u]+o[u]-h[u]:a[u],-s[p]+a[p]+o[p]+h[p]-y+y*g>l[p]?-s[p]+a[p]+o[p]/2>l[p]/2&&a[p]+o[p]-y-y*g>=0?a[p]+o[p]-y-y*g:a[p]+o[p]-y+y*g:a[p]+o[p]-y+y*g>=0?a[p]+o[p]-y+y*g:a[p]+o[p]-y-y*g];else var v=[a[u],a[p]+o[p]-y+y*g];var x=v[u],A=v[p],L=r.fixed?"fixed":"absolute",T=(v[0]+h[0]>a[0]||v[0]<a[0]+o[0])&&v[1]+h[1]<a[1]+o[1];n._drawPosition(r,x,A,L,T)}}},_drawPosition:function(r,a,s,o,l){var c=l?0:r.shadowBlur;n.picker.wrap.style.position=o,(Math.round(parseFloat(n.picker.wrap.style.left))!==Math.round(a)||Math.round(parseFloat(n.picker.wrap.style.top))!==Math.round(s))&&(n.picker.wrap.style.left=a+"px",n.picker.wrap.style.top=s+"px"),n.setBoxShadow(n.picker.boxS,r.shadow?new n.BoxShadow(0,c,r.shadowBlur,0,r.shadowColor):null)},getPickerDims:function(r){var a=2*r.controlBorderWidth+r.width,s=2*r.controlBorderWidth+r.height,o=2*r.controlBorderWidth+2*n.getControlPadding(r)+r.sliderSize;n.getSliderChannel(r)&&(a+=o),r.hasAlphaChannel()&&(a+=o);var l=n.getPaletteDims(r,a);l.height&&(s+=l.height+r.padding),r.closeButton&&(s+=2*r.controlBorderWidth+r.padding+r.buttonHeight);var c=a+2*r.padding,h=s+2*r.padding;return{contentW:a,contentH:s,paddedW:c,paddedH:h,borderW:c+2*r.borderWidth,borderH:h+2*r.borderWidth,palette:l}},getPaletteDims:function(r,a){var s=0,o=0,l=0,c=0,h=0,u=r._palette?r._palette.length:0;return u&&(s=r.paletteCols,o=s>0?Math.ceil(u/s):0,l=Math.max(1,Math.floor((a-(s-1)*r.paletteSpacing)/s)),c=r.paletteHeight?Math.min(r.paletteHeight,l):l),o&&(h=o*c+(o-1)*r.paletteSpacing),{cols:s,rows:o,cellW:l,cellH:c,width:a,height:h}},getControlPadding:function(r){return Math.max(r.padding/2,2*r.pointerBorderWidth+r.pointerThickness-r.controlBorderWidth)},getPadYChannel:function(r){switch(r.mode.charAt(1).toLowerCase()){case"v":return"v"}return"s"},getSliderChannel:function(r){if(r.mode.length>2)switch(r.mode.charAt(2).toLowerCase()){case"s":return"s";case"v":return"v"}return null},triggerCallback:function(r,a){if(r[a]){var s=null;if(typeof r[a]=="string")try{s=new Function(r[a])}catch(o){console.error(o)}else s=r[a];s&&s.call(r)}},triggerGlobal:function(r){for(var a=n.getInstances(),s=0;s<a.length;s+=1)a[s].trigger(r)},_pointerMoveEvent:{mouse:"mousemove",touch:"touchmove"},_pointerEndEvent:{mouse:"mouseup",touch:"touchend"},_pointerOrigin:null,onDocumentKeyUp:function(r){["Tab","Escape"].indexOf(n.eventKey(r))!==-1&&n.picker&&n.picker.owner&&n.picker.owner.tryHide()},onWindowResize:function(r){n.redrawPosition()},onWindowScroll:function(r){n.redrawPosition()},onParentScroll:function(r){n.picker&&n.picker.owner&&n.picker.owner.tryHide()},onDocumentMouseDown:function(r){var a=r.target||r.srcElement;if(a.jscolor&&a.jscolor instanceof n.pub)a.jscolor.showOnClick&&!a.disabled&&a.jscolor.show();else if(n.getData(a,"gui")){var s=n.getData(a,"control");s&&n.onControlPointerStart(r,a,n.getData(a,"control"),"mouse")}else n.picker&&n.picker.owner&&n.picker.owner.tryHide()},onPickerTouchStart:function(r){var a=r.target||r.srcElement;n.getData(a,"control")&&n.onControlPointerStart(r,a,n.getData(a,"control"),"touch")},onControlPointerStart:function(r,a,s,o){var l=n.getData(a,"instance");n.preventDefault(r);var c=function(y,v){n.attachGroupEvent("drag",y,n._pointerMoveEvent[o],n.onDocumentPointerMove(r,a,s,o,v)),n.attachGroupEvent("drag",y,n._pointerEndEvent[o],n.onDocumentPointerEnd(r,a,s,o))};if(c(t.document,[0,0]),t.parent&&t.frameElement){var h=t.frameElement.getBoundingClientRect(),u=[-h.left,-h.top];c(t.parent.window.document,u)}var p=n.getAbsPointerPos(r),g=n.getRelPointerPos(r);switch(n._pointerOrigin={x:p.x-g.x,y:p.y-g.y},s){case"pad":n.getSliderChannel(l)==="v"&&l.channels.v===0&&l.fromHSVA(null,null,100,null),n.setPad(l,r,0,0);break;case"sld":n.setSld(l,r,0);break;case"asld":n.setASld(l,r,0);break}l.trigger("input")},onDocumentPointerMove:function(r,a,s,o,l){return function(c){var h=n.getData(a,"instance");switch(s){case"pad":n.setPad(h,c,l[0],l[1]);break;case"sld":n.setSld(h,c,l[1]);break;case"asld":n.setASld(h,c,l[1]);break}h.trigger("input")}},onDocumentPointerEnd:function(r,a,s,o){return function(l){var c=n.getData(a,"instance");n.detachGroupEvents("drag"),c.trigger("input"),c.trigger("change")}},onPaletteSampleClick:function(r){var a=r.currentTarget,s=n.getData(a,"instance"),o=n.getData(a,"color");s.format.toLowerCase()==="any"&&(s._setFormat(o.format),n.isAlphaFormat(s.getFormat())||(o.rgba[3]=1)),o.rgba[3]===null&&(s.paletteSetsAlpha===!0||s.paletteSetsAlpha==="auto"&&s._paletteHasTransparency)&&(o.rgba[3]=1),s.fromRGBA.apply(s,o.rgba),s.trigger("input"),s.trigger("change"),s.hideOnPaletteClick&&s.hide()},setPad:function(r,a,s,o){var l=n.getAbsPointerPos(a),c=s+l.x-n._pointerOrigin.x-r.padding-r.controlBorderWidth,h=o+l.y-n._pointerOrigin.y-r.padding-r.controlBorderWidth,u=c*(360/(r.width-1)),p=100-h*(100/(r.height-1));switch(n.getPadYChannel(r)){case"s":r.fromHSVA(u,p,null,null);break;case"v":r.fromHSVA(u,null,p,null);break}},setSld:function(r,a,s){var o=n.getAbsPointerPos(a),l=s+o.y-n._pointerOrigin.y-r.padding-r.controlBorderWidth,c=100-l*(100/(r.height-1));switch(n.getSliderChannel(r)){case"s":r.fromHSVA(null,c,null,null);break;case"v":r.fromHSVA(null,null,c,null);break}},setASld:function(r,a,s){var o=n.getAbsPointerPos(a),l=s+o.y-n._pointerOrigin.y-r.padding-r.controlBorderWidth,c=1-l*(1/(r.height-1));if(c<1){var h=r.getFormat();r.format.toLowerCase()==="any"&&!n.isAlphaFormat(h)&&r._setFormat(h==="hex"?"hexa":"rgba")}r.fromHSVA(null,null,null,c)},createPadCanvas:function(){var r={elm:null,draw:null},a=n.createEl("canvas"),s=a.getContext("2d"),o=function(l,c,h){a.width=l,a.height=c,s.clearRect(0,0,a.width,a.height);var u=s.createLinearGradient(0,0,a.width,0);u.addColorStop(0/6,"#F00"),u.addColorStop(1/6,"#FF0"),u.addColorStop(2/6,"#0F0"),u.addColorStop(3/6,"#0FF"),u.addColorStop(4/6,"#00F"),u.addColorStop(5/6,"#F0F"),u.addColorStop(6/6,"#F00"),s.fillStyle=u,s.fillRect(0,0,a.width,a.height);var p=s.createLinearGradient(0,0,0,a.height);switch(h.toLowerCase()){case"s":p.addColorStop(0,"rgba(255,255,255,0)"),p.addColorStop(1,"rgba(255,255,255,1)");break;case"v":p.addColorStop(0,"rgba(0,0,0,0)"),p.addColorStop(1,"rgba(0,0,0,1)");break}s.fillStyle=p,s.fillRect(0,0,a.width,a.height)};return r.elm=a,r.draw=o,r},createSliderGradient:function(){var r={elm:null,draw:null},a=n.createEl("canvas"),s=a.getContext("2d"),o=function(l,c,h,u){a.width=l,a.height=c,s.clearRect(0,0,a.width,a.height);var p=s.createLinearGradient(0,0,0,a.height);p.addColorStop(0,h),p.addColorStop(1,u),s.fillStyle=p,s.fillRect(0,0,a.width,a.height)};return r.elm=a,r.draw=o,r},createASliderGradient:function(){var r={elm:null,draw:null},a=n.createEl("canvas"),s=a.getContext("2d"),o=function(l,c,h){a.width=l,a.height=c,s.clearRect(0,0,a.width,a.height);var u=a.width/2,p=n.pub.chessboardColor1,g=n.pub.chessboardColor2;if(s.fillStyle=p,s.fillRect(0,0,a.width,a.height),u>0)for(var y=0;y<a.height;y+=u*2)s.fillStyle=g,s.fillRect(0,y,u,u),s.fillRect(u,y+u,u,u);var v=s.createLinearGradient(0,0,0,a.height);v.addColorStop(0,h),v.addColorStop(1,"rgba(0,0,0,0)"),s.fillStyle=v,s.fillRect(0,0,a.width,a.height)};return r.elm=a,r.draw=o,r},BoxShadow:function(){var r=function(a,s,o,l,c,h){this.hShadow=a,this.vShadow=s,this.blur=o,this.spread=l,this.color=c,this.inset=!!h};return r.prototype.toString=function(){var a=[Math.round(this.hShadow)+"px",Math.round(this.vShadow)+"px",Math.round(this.blur)+"px",Math.round(this.spread)+"px",this.color];return this.inset&&a.push("inset"),a.join(" ")},r}(),flags:{leaveValue:1,leaveAlpha:2,leavePreview:4},enumOpts:{format:["auto","any","hex","hexa","rgb","rgba"],previewPosition:["left","right"],mode:["hsv","hvs","hs","hv"],position:["left","right","top","bottom"],alphaChannel:["auto",!0,!1],paletteSetsAlpha:["auto",!0,!1]},deprecatedOpts:{styleElement:"previewElement",onFineChange:"onInput",overwriteImportant:"forceStyle",closable:"closeButton",insetWidth:"controlBorderWidth",insetColor:"controlBorderColor",refine:null},docsRef:" See https://jscolor.com/docs/",pub:function(r,a){var s=this;a||(a={}),this.channels={r:255,g:255,b:255,h:0,s:0,v:100,a:1},this.format="auto",this.value=void 0,this.alpha=void 0,this.random=!1,this.onChange=void 0,this.onInput=void 0,this.valueElement=void 0,this.alphaElement=void 0,this.previewElement=void 0,this.previewPosition="left",this.previewSize=32,this.previewPadding=8,this.required=!0,this.hash=!0,this.uppercase=!0,this.forceStyle=!0,this.width=181,this.height=101,this.mode="HSV",this.alphaChannel="auto",this.position="bottom",this.smartPosition=!0,this.showOnClick=!0,this.hideOnLeave=!0,this.palette=[],this.paletteCols=10,this.paletteSetsAlpha="auto",this.paletteHeight=16,this.paletteSpacing=4,this.hideOnPaletteClick=!1,this.sliderSize=16,this.crossSize=8,this.closeButton=!1,this.closeText="Close",this.buttonColor="rgba(0,0,0,1)",this.buttonHeight=18,this.padding=12,this.backgroundColor="rgba(255,255,255,1)",this.borderWidth=1,this.borderColor="rgba(187,187,187,1)",this.borderRadius=8,this.controlBorderWidth=1,this.controlBorderColor="rgba(187,187,187,1)",this.shadow=!0,this.shadowBlur=15,this.shadowColor="rgba(0,0,0,0.2)",this.pointerColor="rgba(76,76,76,1)",this.pointerBorderWidth=1,this.pointerBorderColor="rgba(255,255,255,1)",this.pointerThickness=2,this.zIndex=5e3,this.container=void 0,this.minS=0,this.maxS=100,this.minV=0,this.maxV=100,this.minA=0,this.maxA=1,this.option=function(){if(!arguments.length)throw new Error("No option specified");if(arguments.length===1&&typeof arguments[0]=="string"){try{return l(arguments[0])}catch(S){console.warn(S)}return!1}else if(arguments.length>=2&&typeof arguments[0]=="string"){try{if(!o(arguments[0],arguments[1]))return!1}catch(S){return console.warn(S),!1}return this.redraw(),this.exposeColor(),!0}else if(arguments.length===1&&typeof arguments[0]=="object"){var f=arguments[0],b=!0;for(var C in f)if(f.hasOwnProperty(C))try{o(C,f[C])||(b=!1)}catch(S){console.warn(S),b=!1}return this.redraw(),this.exposeColor(),b}throw new Error("Invalid arguments")},this.channel=function(f,b){if(typeof f!="string")throw new Error("Invalid value for channel name: "+f);if(b===void 0)return this.channels.hasOwnProperty(f.toLowerCase())?this.channels[f.toLowerCase()]:(console.warn("Getting unknown channel: "+f),!1);var C=!1;switch(f.toLowerCase()){case"r":C=this.fromRGBA(b,null,null,null);break;case"g":C=this.fromRGBA(null,b,null,null);break;case"b":C=this.fromRGBA(null,null,b,null);break;case"h":C=this.fromHSVA(b,null,null,null);break;case"s":C=this.fromHSVA(null,b,null,null);break;case"v":C=this.fromHSVA(null,null,b,null);break;case"a":C=this.fromHSVA(null,null,null,b);break;default:return console.warn("Setting unknown channel: "+f),!1}return C?(this.redraw(),!0):!1},this.trigger=function(f){for(var b=n.strList(f),C=0;C<b.length;C+=1){var S=b[C].toLowerCase(),M=null;switch(S){case"input":M="onInput";break;case"change":M="onChange";break}M&&n.triggerCallback(this,M),n.triggerInputEvent(this.valueElement,S,!0,!0)}},this.fromHSVA=function(f,b,C,S,M){if(f===void 0&&(f=null),b===void 0&&(b=null),C===void 0&&(C=null),S===void 0&&(S=null),f!==null){if(isNaN(f))return!1;this.channels.h=Math.max(0,Math.min(360,f))}if(b!==null){if(isNaN(b))return!1;this.channels.s=Math.max(0,Math.min(100,this.maxS,b),this.minS)}if(C!==null){if(isNaN(C))return!1;this.channels.v=Math.max(0,Math.min(100,this.maxV,C),this.minV)}if(S!==null){if(isNaN(S))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,S),this.minA):1}var R=n.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=R[0],this.channels.g=R[1],this.channels.b=R[2],this.exposeColor(M),!0},this.fromRGBA=function(f,b,C,S,M){if(f===void 0&&(f=null),b===void 0&&(b=null),C===void 0&&(C=null),S===void 0&&(S=null),f!==null){if(isNaN(f))return!1;f=Math.max(0,Math.min(255,f))}if(b!==null){if(isNaN(b))return!1;b=Math.max(0,Math.min(255,b))}if(C!==null){if(isNaN(C))return!1;C=Math.max(0,Math.min(255,C))}if(S!==null){if(isNaN(S))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,S),this.minA):1}var R=n.RGB_HSV(f===null?this.channels.r:f,b===null?this.channels.g:b,C===null?this.channels.b:C);R[0]!==null&&(this.channels.h=Math.max(0,Math.min(360,R[0]))),R[2]!==0&&(this.channels.s=Math.max(0,this.minS,Math.min(100,this.maxS,R[1]))),this.channels.v=Math.max(0,this.minV,Math.min(100,this.maxV,R[2]));var _=n.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=_[0],this.channels.g=_[1],this.channels.b=_[2],this.exposeColor(M),!0},this.fromHSV=function(f,b,C,S){return console.warn("fromHSV() method is DEPRECATED. Using fromHSVA() instead."+n.docsRef),this.fromHSVA(f,b,C,null,S)},this.fromRGB=function(f,b,C,S){return console.warn("fromRGB() method is DEPRECATED. Using fromRGBA() instead."+n.docsRef),this.fromRGBA(f,b,C,null,S)},this.fromString=function(f,b){if(!this.required&&f.trim()==="")return this.setPreviewElementBg(null),this.setValueElementValue(""),!0;var C=n.parseColorString(f);return C?(this.format.toLowerCase()==="any"&&(this._setFormat(C.format),n.isAlphaFormat(this.getFormat())||(C.rgba[3]=1)),this.fromRGBA(C.rgba[0],C.rgba[1],C.rgba[2],C.rgba[3],b),!0):!1},this.randomize=function(f,b,C,S,M,R,_,P){f===void 0&&(f=0),b===void 0&&(b=100),C===void 0&&(C=0),S===void 0&&(S=100),M===void 0&&(M=0),R===void 0&&(R=359),_===void 0&&(_=1),P===void 0&&(P=1),this.fromHSVA(M+Math.floor(Math.random()*(R-M+1)),C+Math.floor(Math.random()*(S-C+1)),f+Math.floor(Math.random()*(b-f+1)),(100*_+Math.floor(Math.random()*(100*(P-_)+1)))/100)},this.toString=function(f){switch(f===void 0&&(f=this.getFormat()),f.toLowerCase()){case"hex":return this.toHEXString();case"hexa":return this.toHEXAString();case"rgb":return this.toRGBString();case"rgba":return this.toRGBAString()}return!1},this.toHEXString=function(){return n.hexColor(this.channels.r,this.channels.g,this.channels.b)},this.toHEXAString=function(){return n.hexaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toRGBString=function(){return n.rgbColor(this.channels.r,this.channels.g,this.channels.b)},this.toRGBAString=function(){return n.rgbaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toGrayscale=function(){return .213*this.channels.r+.715*this.channels.g+.072*this.channels.b},this.toCanvas=function(){return n.genColorPreviewCanvas(this.toRGBAString()).canvas},this.toDataURL=function(){return this.toCanvas().toDataURL()},this.toBackground=function(){return n.pub.background(this.toRGBAString())},this.isLight=function(){return this.toGrayscale()>127.5},this.hide=function(){y()&&c()},this.show=function(){h()},this.redraw=function(){y()&&h()},this.getFormat=function(){return this._currentFormat},this._setFormat=function(f){this._currentFormat=f.toLowerCase()},this.hasAlphaChannel=function(){return this.alphaChannel==="auto"?this.format.toLowerCase()==="any"||n.isAlphaFormat(this.getFormat())||this.alpha!==void 0||this.alphaElement!==void 0:this.alphaChannel},this.processValueInput=function(f){this.fromString(f)||this.exposeColor()},this.processAlphaInput=function(f){this.fromHSVA(null,null,null,parseFloat(f))||this.exposeColor()},this.exposeColor=function(f){var b=this.toString(),C=this.getFormat();if(n.setDataAttr(this.targetElement,"current-color",b),!(f&n.flags.leaveValue)&&this.valueElement&&((C==="hex"||C==="hexa")&&(this.uppercase||(b=b.toLowerCase()),this.hash||(b=b.replace(/^#/,""))),this.setValueElementValue(b)),!(f&n.flags.leaveAlpha)&&this.alphaElement){var S=Math.round(this.channels.a*100)/100;this.setAlphaElementValue(S)}!(f&n.flags.leavePreview)&&this.previewElement&&((n.isTextInput(this.previewElement)||n.isButton(this.previewElement)&&!n.isButtonEmpty(this.previewElement))&&this.previewPosition,this.setPreviewElementBg(this.toRGBAString())),y()&&(u(),p(),g())},this.setPreviewElementBg=function(f){if(this.previewElement){var b=null,C=null;(n.isTextInput(this.previewElement)||n.isButton(this.previewElement)&&!n.isButtonEmpty(this.previewElement))&&(b=this.previewPosition,C=this.previewSize);var S=[];if(!f)S.push({image:"none",position:"left top",size:"auto",repeat:"no-repeat",origin:"padding-box"});else{S.push({image:n.genColorPreviewGradient(f,b,C?C-n.pub.previewSeparator.length:null),position:"left top",size:"auto",repeat:b?"repeat-y":"repeat",origin:"padding-box"});var M=n.genColorPreviewCanvas("rgba(0,0,0,0)",b?{left:"right",right:"left"}[b]:null,C,!0);S.push({image:"url('"+M.canvas.toDataURL()+"')",position:(b||"left")+" top",size:M.width+"px "+M.height+"px",repeat:b?"repeat-y":"repeat",origin:"padding-box"})}for(var R={image:[],position:[],size:[],repeat:[],origin:[]},_=0;_<S.length;_+=1)R.image.push(S[_].image),R.position.push(S[_].position),R.size.push(S[_].size),R.repeat.push(S[_].repeat),R.origin.push(S[_].origin);var I={"background-image":R.image.join(", "),"background-position":R.position.join(", "),"background-size":R.size.join(", "),"background-repeat":R.repeat.join(", "),"background-origin":R.origin.join(", ")};n.setStyle(this.previewElement,I,this.forceStyle);var P={left:null,right:null};b&&(P[b]=this.previewSize+this.previewPadding+"px");var I={"padding-left":P.left,"padding-right":P.right};n.setStyle(this.previewElement,I,this.forceStyle,!0)}},this.setValueElementValue=function(f){this.valueElement&&(n.nodeName(this.valueElement)==="input"?this.valueElement.value=f:this.valueElement.innerHTML=f)},this.setAlphaElementValue=function(f){this.alphaElement&&(n.nodeName(this.alphaElement)==="input"?this.alphaElement.value=f:this.alphaElement.innerHTML=f)},this._processParentElementsInDOM=function(){if(!this._parentElementsProcessed){this._parentElementsProcessed=!0;var f=this.targetElement;do{var b=n.getCompStyle(f);b.position&&b.position.toLowerCase()==="fixed"&&(this.fixed=!0),f!==this.targetElement&&(n.getData(f,"hasScrollListener")||(f.addEventListener("scroll",n.onParentScroll,!1),n.setData(f,"hasScrollListener",!0)))}while((f=f.parentNode)&&n.nodeName(f)!=="body")}},this.tryHide=function(){this.hideOnLeave&&this.hide()},this.set__palette=function(f){this.palette=f,this._palette=n.parsePaletteValue(f),this._paletteHasTransparency=n.containsTranparentColor(this._palette)};function o(f,b){if(typeof f!="string")throw new Error("Invalid value for option name: "+f);if(n.enumOpts.hasOwnProperty(f)&&(typeof b=="string"&&(b=b.toLowerCase()),n.enumOpts[f].indexOf(b)===-1))throw new Error("Option '"+f+"' has invalid value: "+b);if(n.deprecatedOpts.hasOwnProperty(f)){var C=f,S=n.deprecatedOpts[f];if(S)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+n.docsRef,C,S),f=S;else throw new Error("Option '"+f+"' is DEPRECATED")}var M="set__"+f;if(typeof s[M]=="function")return s[M](b),!0;if(f in s)return s[f]=b,!0;throw new Error("Unrecognized configuration option: "+f)}function l(f){if(typeof f!="string")throw new Error("Invalid value for option name: "+f);if(n.deprecatedOpts.hasOwnProperty(f)){var b=f,C=n.deprecatedOpts[f];if(C)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+n.docsRef,b,C),f=C;else throw new Error("Option '"+f+"' is DEPRECATED")}var S="get__"+f;if(typeof s[S]=="function")return s[S](value);if(f in s)return s[f];throw new Error("Unrecognized configuration option: "+f)}function c(){n.removeClass(s.targetElement,n.pub.activeClassName),n.picker.wrap.parentNode.removeChild(n.picker.wrap),delete n.picker.owner}function h(){s._processParentElementsInDOM(),n.picker||(n.picker={owner:null,wrap:n.createEl("div"),box:n.createEl("div"),boxS:n.createEl("div"),boxB:n.createEl("div"),pad:n.createEl("div"),padB:n.createEl("div"),padM:n.createEl("div"),padCanvas:n.createPadCanvas(),cross:n.createEl("div"),crossBY:n.createEl("div"),crossBX:n.createEl("div"),crossLY:n.createEl("div"),crossLX:n.createEl("div"),sld:n.createEl("div"),sldB:n.createEl("div"),sldM:n.createEl("div"),sldGrad:n.createSliderGradient(),sldPtrS:n.createEl("div"),sldPtrIB:n.createEl("div"),sldPtrMB:n.createEl("div"),sldPtrOB:n.createEl("div"),asld:n.createEl("div"),asldB:n.createEl("div"),asldM:n.createEl("div"),asldGrad:n.createASliderGradient(),asldPtrS:n.createEl("div"),asldPtrIB:n.createEl("div"),asldPtrMB:n.createEl("div"),asldPtrOB:n.createEl("div"),pal:n.createEl("div"),btn:n.createEl("div"),btnT:n.createEl("div")},n.picker.pad.appendChild(n.picker.padCanvas.elm),n.picker.padB.appendChild(n.picker.pad),n.picker.cross.appendChild(n.picker.crossBY),n.picker.cross.appendChild(n.picker.crossBX),n.picker.cross.appendChild(n.picker.crossLY),n.picker.cross.appendChild(n.picker.crossLX),n.picker.padB.appendChild(n.picker.cross),n.picker.box.appendChild(n.picker.padB),n.picker.box.appendChild(n.picker.padM),n.picker.sld.appendChild(n.picker.sldGrad.elm),n.picker.sldB.appendChild(n.picker.sld),n.picker.sldB.appendChild(n.picker.sldPtrOB),n.picker.sldPtrOB.appendChild(n.picker.sldPtrMB),n.picker.sldPtrMB.appendChild(n.picker.sldPtrIB),n.picker.sldPtrIB.appendChild(n.picker.sldPtrS),n.picker.box.appendChild(n.picker.sldB),n.picker.box.appendChild(n.picker.sldM),n.picker.asld.appendChild(n.picker.asldGrad.elm),n.picker.asldB.appendChild(n.picker.asld),n.picker.asldB.appendChild(n.picker.asldPtrOB),n.picker.asldPtrOB.appendChild(n.picker.asldPtrMB),n.picker.asldPtrMB.appendChild(n.picker.asldPtrIB),n.picker.asldPtrIB.appendChild(n.picker.asldPtrS),n.picker.box.appendChild(n.picker.asldB),n.picker.box.appendChild(n.picker.asldM),n.picker.box.appendChild(n.picker.pal),n.picker.btn.appendChild(n.picker.btnT),n.picker.box.appendChild(n.picker.btn),n.picker.boxB.appendChild(n.picker.box),n.picker.wrap.appendChild(n.picker.boxS),n.picker.wrap.appendChild(n.picker.boxB),n.picker.wrap.addEventListener("touchstart",n.onPickerTouchStart,n.isPassiveEventSupported?{passive:!1}:!1));var f=n.picker,b=!!n.getSliderChannel(s),C=s.hasAlphaChannel(),S=n.getPickerDims(s),M=2*s.pointerBorderWidth+s.pointerThickness+2*s.crossSize,R=n.getControlPadding(s),_=Math.min(s.borderRadius,Math.round(s.padding*Math.PI)),P="crosshair";f.wrap.className="jscolor-wrap",f.wrap.style.width=S.borderW+"px",f.wrap.style.height=S.borderH+"px",f.wrap.style.zIndex=s.zIndex,f.box.className="jscolor-picker",f.box.style.width=S.paddedW+"px",f.box.style.height=S.paddedH+"px",f.boxS.className="jscolor-shadow",n.setBorderRadius(f.boxS,_+"px"),f.boxB.className="jscolor-border",f.boxB.style.border=s.borderWidth+"px solid",f.boxB.style.borderColor=s.borderColor,f.boxB.style.background=s.backgroundColor,n.setBorderRadius(f.boxB,_+"px"),f.padM.style.background="rgba(255,0,0,.2)",f.sldM.style.background="rgba(0,255,0,.2)",f.asldM.style.background="rgba(0,0,255,.2)",f.padM.style.opacity=f.sldM.style.opacity=f.asldM.style.opacity="0",f.pad.style.position="relative",f.pad.style.width=s.width+"px",f.pad.style.height=s.height+"px",f.padCanvas.draw(s.width,s.height,n.getPadYChannel(s)),f.padB.style.position="absolute",f.padB.style.left=s.padding+"px",f.padB.style.top=s.padding+"px",f.padB.style.border=s.controlBorderWidth+"px solid",f.padB.style.borderColor=s.controlBorderColor,f.padM.style.position="absolute",f.padM.style.left="0px",f.padM.style.top="0px",f.padM.style.width=s.padding+2*s.controlBorderWidth+s.width+R+"px",f.padM.style.height=2*s.controlBorderWidth+2*s.padding+s.height+"px",f.padM.style.cursor=P,n.setData(f.padM,{instance:s,control:"pad"}),f.cross.style.position="absolute",f.cross.style.left=f.cross.style.top="0",f.cross.style.width=f.cross.style.height=M+"px",f.crossBY.style.position=f.crossBX.style.position="absolute",f.crossBY.style.background=f.crossBX.style.background=s.pointerBorderColor,f.crossBY.style.width=f.crossBX.style.height=2*s.pointerBorderWidth+s.pointerThickness+"px",f.crossBY.style.height=f.crossBX.style.width=M+"px",f.crossBY.style.left=f.crossBX.style.top=Math.floor(M/2)-Math.floor(s.pointerThickness/2)-s.pointerBorderWidth+"px",f.crossBY.style.top=f.crossBX.style.left="0",f.crossLY.style.position=f.crossLX.style.position="absolute",f.crossLY.style.background=f.crossLX.style.background=s.pointerColor,f.crossLY.style.height=f.crossLX.style.width=M-2*s.pointerBorderWidth+"px",f.crossLY.style.width=f.crossLX.style.height=s.pointerThickness+"px",f.crossLY.style.left=f.crossLX.style.top=Math.floor(M/2)-Math.floor(s.pointerThickness/2)+"px",f.crossLY.style.top=f.crossLX.style.left=s.pointerBorderWidth+"px",f.sld.style.overflow="hidden",f.sld.style.width=s.sliderSize+"px",f.sld.style.height=s.height+"px",f.sldGrad.draw(s.sliderSize,s.height,"#000","#000"),f.sldB.style.display=b?"block":"none",f.sldB.style.position="absolute",f.sldB.style.left=s.padding+s.width+2*s.controlBorderWidth+2*R+"px",f.sldB.style.top=s.padding+"px",f.sldB.style.border=s.controlBorderWidth+"px solid",f.sldB.style.borderColor=s.controlBorderColor,f.sldM.style.display=b?"block":"none",f.sldM.style.position="absolute",f.sldM.style.left=s.padding+s.width+2*s.controlBorderWidth+R+"px",f.sldM.style.top="0px",f.sldM.style.width=s.sliderSize+2*R+2*s.controlBorderWidth+(C?0:Math.max(0,s.padding-R))+"px",f.sldM.style.height=2*s.controlBorderWidth+2*s.padding+s.height+"px",f.sldM.style.cursor="default",n.setData(f.sldM,{instance:s,control:"sld"}),f.sldPtrIB.style.border=f.sldPtrOB.style.border=s.pointerBorderWidth+"px solid "+s.pointerBorderColor,f.sldPtrOB.style.position="absolute",f.sldPtrOB.style.left=-(2*s.pointerBorderWidth+s.pointerThickness)+"px",f.sldPtrOB.style.top="0",f.sldPtrMB.style.border=s.pointerThickness+"px solid "+s.pointerColor,f.sldPtrS.style.width=s.sliderSize+"px",f.sldPtrS.style.height=n.pub.sliderInnerSpace+"px",f.asld.style.overflow="hidden",f.asld.style.width=s.sliderSize+"px",f.asld.style.height=s.height+"px",f.asldGrad.draw(s.sliderSize,s.height,"#000"),f.asldB.style.display=C?"block":"none",f.asldB.style.position="absolute",f.asldB.style.left=s.padding+s.width+2*s.controlBorderWidth+R+(b?s.sliderSize+3*R+2*s.controlBorderWidth:0)+"px",f.asldB.style.top=s.padding+"px",f.asldB.style.border=s.controlBorderWidth+"px solid",f.asldB.style.borderColor=s.controlBorderColor,f.asldM.style.display=C?"block":"none",f.asldM.style.position="absolute",f.asldM.style.left=s.padding+s.width+2*s.controlBorderWidth+R+(b?s.sliderSize+2*R+2*s.controlBorderWidth:0)+"px",f.asldM.style.top="0px",f.asldM.style.width=s.sliderSize+2*R+2*s.controlBorderWidth+Math.max(0,s.padding-R)+"px",f.asldM.style.height=2*s.controlBorderWidth+2*s.padding+s.height+"px",f.asldM.style.cursor="default",n.setData(f.asldM,{instance:s,control:"asld"}),f.asldPtrIB.style.border=f.asldPtrOB.style.border=s.pointerBorderWidth+"px solid "+s.pointerBorderColor,f.asldPtrOB.style.position="absolute",f.asldPtrOB.style.left=-(2*s.pointerBorderWidth+s.pointerThickness)+"px",f.asldPtrOB.style.top="0",f.asldPtrMB.style.border=s.pointerThickness+"px solid "+s.pointerColor,f.asldPtrS.style.width=s.sliderSize+"px",f.asldPtrS.style.height=n.pub.sliderInnerSpace+"px",f.pal.className="jscolor-palette",f.pal.style.display=S.palette.rows?"block":"none",f.pal.style.left=s.padding+"px",f.pal.style.top=2*s.controlBorderWidth+2*s.padding+s.height+"px",f.pal.innerHTML="";for(var I=n.genColorPreviewCanvas("rgba(0,0,0,0)"),Y=0,et=0;et<S.palette.rows;et++)for(var k=0;k<S.palette.cols&&Y<s._palette.length;k++,Y++){var m=s._palette[Y],E=n.rgbaColor.apply(null,m.rgba),$=n.createEl("div");$.style.width=S.palette.cellW-2*s.controlBorderWidth+"px",$.style.height=S.palette.cellH-2*s.controlBorderWidth+"px",$.style.backgroundColor=E;var z=n.createEl("div");z.className="jscolor-palette-sw",z.style.left=(S.palette.cols<=1?0:Math.round(10*(k*((S.contentW-S.palette.cellW)/(S.palette.cols-1))))/10)+"px",z.style.top=et*(S.palette.cellH+s.paletteSpacing)+"px",z.style.border=s.controlBorderWidth+"px solid",z.style.borderColor=s.controlBorderColor,m.rgba[3]!==null&&m.rgba[3]<1&&(z.style.backgroundImage="url('"+I.canvas.toDataURL()+"')",z.style.backgroundRepeat="repeat",z.style.backgroundPosition="center center"),n.setData(z,{instance:s,control:"palette-sw",color:m}),z.addEventListener("click",n.onPaletteSampleClick,!1),z.appendChild($),f.pal.appendChild(z)}function q(){var Z=s.controlBorderColor.split(/\s+/),Mt=Z.length<2?Z[0]:Z[1]+" "+Z[0]+" "+Z[0]+" "+Z[1];f.btn.style.borderColor=Mt}var U=15;f.btn.className="jscolor-btn jscolor-btn-close",f.btn.style.display=s.closeButton?"block":"none",f.btn.style.left=s.padding+"px",f.btn.style.bottom=s.padding+"px",f.btn.style.padding="0 "+U+"px",f.btn.style.maxWidth=S.contentW-2*s.controlBorderWidth-2*U+"px",f.btn.style.height=s.buttonHeight+"px",f.btn.style.border=s.controlBorderWidth+"px solid",q(),f.btn.style.color=s.buttonColor,f.btn.onmousedown=function(){s.hide()},f.btnT.style.display="inline",f.btnT.style.lineHeight=s.buttonHeight+"px",f.btnT.innerText=s.closeText,u(),p(),g(),n.picker.owner&&n.picker.owner!==s&&n.removeClass(n.picker.owner.targetElement,n.pub.activeClassName),n.picker.owner=s,n.redrawPosition(),f.wrap.parentNode!==s.container&&s.container.appendChild(f.wrap),n.addClass(s.targetElement,n.pub.activeClassName)}function u(){var f=n.getPadYChannel(s),b=Math.round(s.channels.h/360*(s.width-1)),C=Math.round((1-s.channels[f]/100)*(s.height-1)),S=2*s.pointerBorderWidth+s.pointerThickness+2*s.crossSize,M=-Math.floor(S/2);switch(n.picker.cross.style.left=b+M+"px",n.picker.cross.style.top=C+M+"px",n.getSliderChannel(s)){case"s":var R=n.HSV_RGB(s.channels.h,100,s.channels.v),_=n.HSV_RGB(s.channels.h,0,s.channels.v),I="rgb("+Math.round(R[0])+","+Math.round(R[1])+","+Math.round(R[2])+")",Y="rgb("+Math.round(_[0])+","+Math.round(_[1])+","+Math.round(_[2])+")";n.picker.sldGrad.draw(s.sliderSize,s.height,I,Y);break;case"v":var P=n.HSV_RGB(s.channels.h,s.channels.s,100),I="rgb("+Math.round(P[0])+","+Math.round(P[1])+","+Math.round(P[2])+")",Y="#000";n.picker.sldGrad.draw(s.sliderSize,s.height,I,Y);break}n.picker.asldGrad.draw(s.sliderSize,s.height,s.toHEXString())}function p(){var f=n.getSliderChannel(s);if(f){var b=Math.round((1-s.channels[f]/100)*(s.height-1));n.picker.sldPtrOB.style.top=b-(2*s.pointerBorderWidth+s.pointerThickness)-Math.floor(n.pub.sliderInnerSpace/2)+"px"}n.picker.asldGrad.draw(s.sliderSize,s.height,s.toHEXString())}function g(){var f=Math.round((1-s.channels.a)*(s.height-1));n.picker.asldPtrOB.style.top=f-(2*s.pointerBorderWidth+s.pointerThickness)-Math.floor(n.pub.sliderInnerSpace/2)+"px"}function y(){return n.picker&&n.picker.owner===s}function v(f){n.eventKey(f)==="Enter"&&(s.valueElement&&s.processValueInput(s.valueElement.value),s.tryHide())}function x(f){n.eventKey(f)==="Enter"&&(s.alphaElement&&s.processAlphaInput(s.alphaElement.value),s.tryHide())}function A(f){if(!n.getData(f,"internal")){var b=s.valueElement.value;s.processValueInput(s.valueElement.value),n.triggerCallback(s,"onChange"),s.valueElement.value!==b&&n.triggerInputEvent(s.valueElement,"change",!0,!0)}}function L(f){if(!n.getData(f,"internal")){var b=s.alphaElement.value;s.processAlphaInput(s.alphaElement.value),n.triggerCallback(s,"onChange"),n.triggerInputEvent(s.valueElement,"change",!0,!0),s.alphaElement.value!==b&&n.triggerInputEvent(s.alphaElement,"change",!0,!0)}}function T(f){n.getData(f,"internal")||(s.valueElement&&s.fromString(s.valueElement.value,n.flags.leaveValue),n.triggerCallback(s,"onInput"))}function B(f){n.getData(f,"internal")||(s.alphaElement&&s.fromHSVA(null,null,null,parseFloat(s.alphaElement.value),n.flags.leaveAlpha),n.triggerCallback(s,"onInput"),n.triggerInputEvent(s.valueElement,"input",!0,!0))}if(n.pub.options){for(var N in n.pub.options)if(n.pub.options.hasOwnProperty(N))try{o(N,n.pub.options[N])}catch(f){console.warn(f)}}var V=[];a.preset&&(typeof a.preset=="string"?V=a.preset.split(/\s+/):Array.isArray(a.preset)?V=a.preset.slice():console.warn("Unrecognized preset value")),V.indexOf("default")===-1&&V.push("default");for(var W=V.length-1;W>=0;W-=1){var D=V[W];if(D){if(!n.pub.presets.hasOwnProperty(D)){console.warn("Unknown preset: %s",D);continue}for(var N in n.pub.presets[D])if(n.pub.presets[D].hasOwnProperty(N))try{o(N,n.pub.presets[D][N])}catch(b){console.warn(b)}}}var H=["preset"];for(var N in a)if(a.hasOwnProperty(N)&&H.indexOf(N)===-1)try{o(N,a[N])}catch(b){console.warn(b)}if(this.container===void 0?this.container=t.document.body:this.container=n.node(this.container),!this.container)throw new Error("Cannot instantiate color picker without a container element");if(this.targetElement=n.node(r),!this.targetElement){if(typeof r=="string"&&/^[a-zA-Z][\w:.-]*$/.test(r)){var X=r;throw new Error("If '"+X+"' is supposed to be an ID, please use '#"+X+"' or any valid CSS selector.")}throw new Error("Cannot instantiate color picker without a target element")}if(this.targetElement.jscolor&&this.targetElement.jscolor instanceof n.pub)throw new Error("Color picker already installed on this element");if(this.targetElement.jscolor=this,n.addClass(this.targetElement,n.pub.className),n.instances.push(this),n.isButton(this.targetElement)&&(this.targetElement.type.toLowerCase()!=="button"&&(this.targetElement.type="button"),n.isButtonEmpty(this.targetElement))){n.removeChildren(this.targetElement),this.targetElement.appendChild(t.document.createTextNode(""));var Lt=n.getCompStyle(this.targetElement),Ht=parseFloat(Lt["min-width"])||0;Ht<this.previewSize&&n.setStyle(this.targetElement,{"min-width":this.previewSize+"px"},this.forceStyle)}if(this.valueElement===void 0?n.isTextInput(this.targetElement)&&(this.valueElement=this.targetElement):this.valueElement===null||(this.valueElement=n.node(this.valueElement)),this.alphaElement&&(this.alphaElement=n.node(this.alphaElement)),this.previewElement===void 0?this.previewElement=this.targetElement:this.previewElement===null||(this.previewElement=n.node(this.previewElement)),this.valueElement&&n.isTextInput(this.valueElement)){var ct={onInput:this.valueElement.oninput};this.valueElement.oninput=null,this.valueElement.addEventListener("keydown",v,!1),this.valueElement.addEventListener("change",A,!1),this.valueElement.addEventListener("input",T,!1),ct.onInput&&this.valueElement.addEventListener("input",ct.onInput,!1),this.valueElement.setAttribute("autocomplete","off"),this.valueElement.setAttribute("autocorrect","off"),this.valueElement.setAttribute("autocapitalize","off"),this.valueElement.setAttribute("spellcheck",!1)}this.alphaElement&&n.isTextInput(this.alphaElement)&&(this.alphaElement.addEventListener("keydown",x,!1),this.alphaElement.addEventListener("change",L,!1),this.alphaElement.addEventListener("input",B,!1),this.alphaElement.setAttribute("autocomplete","off"),this.alphaElement.setAttribute("autocorrect","off"),this.alphaElement.setAttribute("autocapitalize","off"),this.alphaElement.setAttribute("spellcheck",!1));var vt="FFFFFF";this.value!==void 0?vt=this.value:this.valueElement&&this.valueElement.value!==void 0&&(vt=this.valueElement.value);var j=void 0;if(this.alpha!==void 0?j=""+this.alpha:this.alphaElement&&this.alphaElement.value!==void 0&&(j=this.alphaElement.value),this._currentFormat=null,["auto","any"].indexOf(this.format.toLowerCase())>-1){var mt=n.parseColorString(vt);this._currentFormat=mt?mt.format:"hex"}else this._currentFormat=this.format.toLowerCase();this.processValueInput(vt),j!==void 0&&this.processAlphaInput(j),this.random&&this.randomize.apply(this,Array.isArray(this.random)?this.random:[])}};return n.pub.className="jscolor",n.pub.activeClassName="jscolor-active",n.pub.looseJSON=!0,n.pub.presets={},n.pub.presets.default={},n.pub.presets.light={backgroundColor:"rgba(255,255,255,1)",controlBorderColor:"rgba(187,187,187,1)",buttonColor:"rgba(0,0,0,1)"},n.pub.presets.dark={backgroundColor:"rgba(51,51,51,1)",controlBorderColor:"rgba(153,153,153,1)",buttonColor:"rgba(240,240,240,1)"},n.pub.presets.small={width:101,height:101,padding:10,sliderSize:14,paletteCols:8},n.pub.presets.medium={width:181,height:101,padding:12,sliderSize:16,paletteCols:10},n.pub.presets.large={width:271,height:151,padding:12,sliderSize:24,paletteCols:15},n.pub.presets.thin={borderWidth:1,controlBorderWidth:1,pointerBorderWidth:1},n.pub.presets.thick={borderWidth:2,controlBorderWidth:2,pointerBorderWidth:2},n.pub.sliderInnerSpace=3,n.pub.chessboardSize=8,n.pub.chessboardColor1="#666666",n.pub.chessboardColor2="#999999",n.pub.previewSeparator=["rgba(255,255,255,.65)","rgba(128,128,128,.65)"],n.pub.init=function(){if(!n.initialized)for(t.document.addEventListener("mousedown",n.onDocumentMouseDown,!1),t.document.addEventListener("keyup",n.onDocumentKeyUp,!1),t.addEventListener("resize",n.onWindowResize,!1),t.addEventListener("scroll",n.onWindowScroll,!1),n.appendDefaultCss(),n.pub.install(),n.initialized=!0;n.readyQueue.length;){var r=n.readyQueue.shift();r()}},n.pub.install=function(r){var a=!0;try{n.installBySelector("[data-jscolor]",r)}catch(s){a=!1,console.warn(s)}if(n.pub.lookupClass)try{n.installBySelector("input."+n.pub.lookupClass+", button."+n.pub.lookupClass,r)}catch{}return a},n.pub.ready=function(r){return typeof r!="function"?(console.warn("Passed value is not a function"),!1):(n.initialized?r():n.readyQueue.push(r),!0)},n.pub.trigger=function(r){var a=function(){n.triggerGlobal(r)};n.initialized?a():n.pub.ready(a)},n.pub.hide=function(){n.picker&&n.picker.owner&&n.picker.owner.hide()},n.pub.chessboard=function(r){r||(r="rgba(0,0,0,0)");var a=n.genColorPreviewCanvas(r);return a.canvas.toDataURL()},n.pub.background=function(r){var a=[];a.push(n.genColorPreviewGradient(r));var s=n.genColorPreviewCanvas();return a.push(["url('"+s.canvas.toDataURL()+"')","left top","repeat"].join(" ")),a.join(", ")},n.pub.options={},n.pub.lookupClass="jscolor",n.pub.installByClassName=function(){return console.error('jscolor.installByClassName() is DEPRECATED. Use data-jscolor="" attribute instead of a class name.'+n.docsRef),!1},n.register(),n.pub}();return typeof t.jscolor>"u"&&(t.jscolor=t.JSColor=i),i})})(Pi);var hs=Pi.exports;const us=cs(hs);function ds(){return F` <div id="settings-modal" class="modal">
    <h2>Settings</h2>

    <div class="modal-content">
      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${d.reverseScroll}
          @change=${e=>w({reverseScroll:e.target.checked})} />
        Invert Scroll
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="grid"
          ?checked=${d.grid}
          @change=${e=>w({grid:e.target.checked})} />
        Grid
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${d.debug}
          @change=${e=>w({debug:e.target.checked})} />
        Debug
      </label>

      <label class="form-control range">
        Symbol Line Width
        <input
          type="range"
          name="line-width"
          min="1"
          max="10"
          .value=${String(d.symbolLineWidth)}
          ?checked=${d.debug}
          @input=${e=>w({symbolLineWidth:Number(e.target.value)})} />
      </label>
    </div>
  </div>`}function fs(){return F` <div class="panzoom-controls">
    <button class="btn icon" @click=${()=>De(d.scale-1)}>
      <i class="fa-solid fa-magnifying-glass-minus"></i>
    </button>
    <input
      type="range"
      min=${wi}
      max=${yi}
      .value=${String(d.scale)}
      @input=${e=>De(Number(e.target.value))} />
    <button class="btn icon" @click=${()=>De(d.scale+1)}>
      <i class="fa-solid fa-magnifying-glass-plus"></i>
    </button>
    <button class="btn icon" @click=${Dt}>
      <i class="fa-solid fa-expand"></i>
    </button>
  </div>`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Nn(e,t){if(e!==void 0){let i=0;for(const n of e)yield t(n,i++)}}const ps=F`<style>
  #debug-pane {
    display: flex;
    flex-direction: column;
  }
  #debug-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #1a1919;
    padding: 4px;
  }

  #debug-header > h3 {
    margin: 0;
  }

  #debug-header > button {
    display: flex;
    padding: 0;
    border: 0;
    outline: 0;
    background-color: transparent;
    color: #939292;
    font-size: large;
    cursor: pointer;
  }

  #debug-header > button:hover {
    color: red;
  }

  #debug-content {
    display: grid;
    grid-template-columns: auto auto;
    gap: 1px;
    background-color: #1a1919;
    color: #dadada;
    flex-basis: 350px;
    overflow-y: auto;
  }

  #debug-content > * {
    background-color: #2c2c2c;
    padding: 5px;
  }

  #debug-content > h4 {
    margin: 0;
    text-align: right;
    white-space: nowrap;
  }

  .chip-container {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  .chip {
    font-weight: bold;
    padding: 4px;
    border-radius: 5px;
    background: #5e5e5e;
    paint-order: stroke fill;
    text-shadow: 1px 0 0 black, 0 1px 0 black, -1px 0 0 black, 0 -1px 0 black;
    box-shadow: 0 0 2px black;
  }

  .number-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
  }

  .bool-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
    background-color: rgba(177, 211, 111, 1);
  }
</style>`;function gs(){return F`${ps}
    <div id="debug-pane">
      <div id="debug-header">
        <h3>Debug</h3>
        <button @click=${()=>w({debug:!1})}>
          <i class="fa-solid fa-circle-xmark"></i>
        </button>
      </div>
      <div id="debug-content">
        <h4>Scale</h4>
        <span>
          <span class="number-field">${d.scale}</span> pixels per
          pixel
        </span>
        <h4>x pos</h4>
        <span class="number-field">${d.pos.x}</span>
        <h4>y pos</h4>
        <span class="number-field">${d.pos.y}</span>
        <h4>Active Tool</h4>
        <span class="text-field">${d.activeTool}</span>
        <h4>Active Color</h4>
        <span class="number-field">${d.activeColor}</span>
        <h4>Device Pixel Ratio</h4>
        <span>
          <span class="number-field">${devicePixelRatio}</span> device pixel(s)
          per CSS pixel
        </span>
        <h4>Color Palette</h4>
        <div class="chip-container">
          ${Nn(d.yarnPalette,e=>F`<code class="chip" style="background:${e};"
                >${e}</code
              >`)}
        </div>
        <h4>Snapshot Length</h4>
        <span class="number-field">${d.snapshots.length}</span>
        <h4>Held Keys</h4>
        <div class="chip-container">
          ${d.heldKeys.size>0?Nn(d.heldKeys,e=>F`<span class="chip">${e}</span>`):F`<span class="chip">none</span>`}
        </div>
        <h4>Grid</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${d.grid?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${d.grid}</span
          >
        </div>
        <h4>Editing Palette</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${d.editingPalette?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${d.editingPalette}</span
          >
        </div>
        <h4>Show Settings</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${d.showSettings?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${d.showSettings}</span
          >
        </div>
        <h4>Show download</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${d.showDownload?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${d.showDownload}</span
          >
        </div>
        <h4>Show debug</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${d.debug?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${d.debug}</span
          >
        </div>
      </div>
    </div>`}function vs(){return F` <div id="symbol-picker">
    <h3>Symbols</h3>
    ${d.symbolMap.map((e,t)=>F`<button
        class="btn solid img ${d.activeSymbol==t?"current":""}"
        @click=${()=>w({activeSymbol:t})}>
        <div>${e}</div>
        <canvas class="symbol-preview" data-symbol=${e}></canvas>
      </button>`)}
  </div>`}function ms(e){if(d.yarnPalette.length==1){alert("you need some color in your life");return}const t=d.yarnPalette.filter((n,r)=>r!=e),i=d.yarnSequence.pixels.map(n=>n==e?0:n>e?n-1:n);w({yarnPalette:t,yarnSequence:new O(d.yarnSequence.width,d.yarnSequence.height,i)})}function Tn(e){const t=document.getElementById(`color-${e}`);if(!t.jscolor){const i=new us(t,{preset:"dark large",format:"hexa",value:d.yarnPalette[e],onInput:()=>{const n=[...d.yarnPalette];n[e]=i.toRGBAString(),w({yarnPalette:n,yarnSequence:d.yarnSequence})},previewElement:null})}t.jscolor.show()}function ys(){return F`<div id="yarn-picker">
    <h3>Yarns</h3>
    <div>
      <button
        class="btn icon ${d.editingPalette?"selected":""}"
        @click=${()=>w({editingPalette:!d.editingPalette})}>
        <i class="fa-solid fa-pen"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{let e=[...d.yarnPalette];e.push(xe()),w({yarnPalette:e})}}>
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
    ${d.yarnPalette.map((e,t)=>F`<button
          class="btn solid color-select ${t==d.activeYarn?"selected":""}"
          @click=${()=>w({activeYarn:t})}>
          <div class="color-label">${t+1}</div>
          <div class="color-preview" style="--current: ${e};">
            ${d.editingPalette?F`
                  <button
                    class="delete-color-button"
                    @click=${()=>ms(t)}>
                    <i class="fa-solid fa-circle-xmark"></i>
                  </button>
                  <button
                    id="color-${t}"
                    class="edit-color-btn"
                    @click=${i=>Tn(t)}></button>
                  <div
                    class="edit-color-icon"
                    @click=${i=>Tn(t)}>
                    <i class="fa-solid fa-pen"></i>
                  </div>
                `:""}
          </div>
        </button>`)}

    <div>
      <button
        class="btn icon"
        @click=${()=>{w({yarnPalette:[...Vr(d.yarnPalette)]})}}>
        <i class="fa-solid fa-arrows-rotate"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{w({yarnPalette:Array.from(Array(d.yarnPalette.length),()=>xe())})}}>
        <i class="fa-solid fa-dice"></i>
      </button>
    </div>
  </div>`}function ws(){return F`<div id="left-bar" class="scroller">
    ${vs()} ${ys()}
  </div>`}function bs(e){return Math.floor(e.pos[0]*d.scale/devicePixelRatio)}function xs(e){return Math.floor((d.chart.height-e.bitmap.height-e.pos[1])*d.scale/devicePixelRatio)}function _s(){return F` <div id="repeat-container">
    ${d.repeats.map((e,t)=>F`<div
          data-repeatindex=${t}
          class="repeat-canvas-container"
          style="transform: translate(${bs(e)}px, ${xs(e)}px); ${d.editingRepeat==t?"z-index: 3":"z-index: 1"}"
          id="repeat-${t}-container">
          ${Bt(d.editingRepeat==t,()=>F`<button class="btn solid resize-repeat grab">
                <i class="fa-solid fa-up-right-and-down-left-from-center"></i>
              </button> `)}
          <!-- <div
            class="repeat-bounds"
            style="width: ${e.area[0]*d.scale/devicePixelRatio}px; height: ${e.area[1]*d.scale/devicePixelRatio}px;">
            ${Bt(d.editingRepeat==t,()=>F`<button class="repeat-area-dragger y-axis">
                  <i class="fa-solid fa-angles-up"></i></button
                ><button class="repeat-area-dragger x-axis">
                  <i class="fa-solid fa-angles-right"></i>
                </button>`)}
          </div> -->
          <canvas id="repeat-${t}" class="repeat-canvas"></canvas>
          <canvas id="repeat-${t}-grid" class="grid-canvas"></canvas>
          <canvas id="repeat-${t}-outline" class="outline-canvas"></canvas>
        </div>`)}
  </div>`}function ae(e,t){w({repeats:[...d.repeats.slice(0,e),{...d.repeats[e],bitmap:t},...d.repeats.slice(e+1)]})}function Es(e,t){function i(n){const r=d.repeats[e].bitmap.line({x:t.x,y:t.y},{x:n.x,y:n.y},d.activeSymbol);t=n,ae(e,r)}return i(t),i}function Ss(e,t){function i(n){ae(e,d.repeats[e].bitmap.flood(n,d.activeSymbol))}return i(t),i}function ks(e,t){const i=d.repeats[e].bitmap;function n(r){const a=i.rect({x:t.x,y:t.y},{x:r.x,y:r.y},d.activeSymbol);ae(e,a)}return n(t),n}function Cs(e,t){const i=d.repeats[e].bitmap;function n(r){const a=i.line({x:t.x,y:t.y},{x:r.x,y:r.y},d.activeSymbol);ae(e,a)}return n(t),n}function $s(e,t){const i=d.repeats[e].bitmap;function n(r){ae(e,i.shift(t.x-r.x,t.y-r.y))}return n(t),n}const te={brush:Es,flood:Ss,line:Cs,rect:ks,shift:$s};function As(){return F` <div class="tool-picker">
    <!-- <button
      class="btn"
      @click=${()=>w({editingRepeat:-1,repeats:[...d.repeats.slice(0,d.editingRepeat),...d.repeats.slice(d.editingRepeat+1)]})}>
      <i class="fa-solid fa-trash"></i>
    </button> -->
    <span
      >${d.repeats[d.editingRepeat].bitmap.width} x
      ${d.repeats[d.editingRepeat].bitmap.height}
    </span>
    ${Object.keys(te).map(e=>F`<button
        class="btn solid ${d.activeTool==e?"current":""}"
        @click=${()=>w({activeTool:e})}>
        <i class=${Si[e].icon}></i>
      </button>`)}
    <!-- <button
      class="btn solid move-repeat ${d.activeTool=="move"?"current":""}"
      @click=${()=>w({activeTool:"move"})}>
      <i class="fa-solid fa-hand"></i>
    </button> -->
    <!-- <button
      class="btn"
      @click=${()=>w({editingRepeat:-1})}>
      <i class="fa-solid fa-circle-xmark"></i>
    </button> -->
  </div>`}const Ke="ECN",qt="PCN",_t="ACN",Ot="UACN",Ps="K",Ls="P",zn="T",In="M";class Ms{constructor(t,i,n=!0){if(this.width=2*t,this.height=i+1,this.contacts=Array.from({length:this.width*this.height},()=>[null,Ke,[null,null]]),n)for(let r=0;r<this.width;r++)this.setAV(r,0,qt),this.setMV(r,0,[0,0])}getST(t,i){return this.neighborhood(t,i)[0]}setSt(t,i,n){this.neighborhood(t,i)[0]=n}getAV(t,i){return this.neighborhood(t,i)[1]}setAV(t,i,n){this.neighborhood(t,i)[1]=n}getMV(t,i){return this.neighborhood(t,i)[2]}getDeltaI(t,i){return this.neighborhood(t,i)[2][0]}getDeltaJ(t,i){return this.neighborhood(t,i)[2][1]}setMV(t,i,n){this.neighborhood(t,i)[2]=n}setDeltaJ(t,i,n){this.neighborhood(t,i)[2][1]=n}setDeltaI(t,i,n){this.neighborhood(t,i)[2][0]=n}neighborhood(t,i){return this.contacts[i*this.width+t]}}class Rs{constructor(t){this.instructions=t,this.width=t.width,this.height=t.height,this.cn=new Ms(this.width,this.height),this.populateContacts()}handleKPLower(t,i,n){this.cn.setSt(t,i,n);const r=this.cn.getAV(t,i),a=this.cn.getMV(t,i);r==qt&&a[0]===0&&this.cn.setAV(t,i,_t),r==Ot&&((this.cn.getAV(t+1,i-1)==_t&&this.cn.getMV(t+1,i-1)[1]==0||this.cn.getAV(t-1,i-1)==_t&&this.cn.getMV(t-1,i-1)[1]==0)&&this.cn.setAV(t,i,_t),this.cn.getAV(t,i-1)==qt&&this.cn.setAV(t,i-1,_t))}handleKPUpper(t,i){if(this.cn.setMV(t,i+1,[0,0]),this.cn.getAV(t,i)==_t?this.cn.setAV(t,i+1,qt):this.cn.setAV(t,i+1,Ot),this.cn.getAV(t,i)==Ot){let n=!1,r=0,a=0;for(;!n&&!(i-r<0);)if(this.cn.getAV(t,i-r)==="PCN"&&(n=!0,this.cn.setAV(t,i-r,_t)),r++,a++,a>1e3){console.error("COULDN'T FIND STITCH");break}}}handleTuckMissUpper(t,i,n){n==zn?(this.cn.setAV(t,i+1,Ot),this.cn.setMV(t,i+1,[0,0])):n==In&&(this.cn.setAV(t,i+1,Ke),this.cn.setMV(t,i+1,[0,-1]))}handleTuckMissLower(t,i,n){const r=this.cn.getAV(t,i);if(r==qt||r==Ot)this.cn.setDeltaJ(t,i,1);else if(r==Ke){let a=!1,s=0,o=0;for(;!a;){const l=this.cn.getMV(t,i-s)[1];if(l>0&&(this.cn.setDeltaJ(t,i-s,l+1),a=!0),s++,o++,o>1e3){console.error("COULDN'T FIND STITCH");break}}}}handleOp(t,i,n,r){(n==Ps||n==Ls)&&(this.handleKPLower(t,i,n),this.handleKPLower(t+r,i,n),this.handleKPUpper(t,i,n),this.handleKPUpper(t+r,i,n)),(n==zn||n==In)&&(this.handleTuckMissLower(t,i,n),this.handleTuckMissLower(t+r,i,n),this.handleTuckMissUpper(t,i,n),this.handleTuckMissUpper(t+r,i,n))}processRow(t,i){if(i)for(let n=0;n<this.width;n++){const r=this.instructions.op(n,t);this.handleOp(2*n,t,r,1)}else for(let n=this.width-1;n>=0;n--){const r=this.instructions.op(n,t);this.handleOp(2*n+1,t,r,-1)}}populateContacts(){let t=!0;for(let i=0;i<this.height;i++)this.processRow(i,t),t=!t}}const Bs={T:0,K:1,S:2,p:3},Ns=["K","P","M","T"];class Ts{constructor(t){this.ops=Array.from(t.pixels).map(i=>Ns[i]),this.width=t.width,this.height=t.height}op(t,i){return t>this.width-1||t<0||i>this.height-1||i<0?-1:this.ops.at(t+i*this.width)}makeOpData(){const t=this.width,i=this.height,n=[];for(let r=0;r<i;r++)for(let a=0;a<t;a++){const s=r*t+a,o=this.op(a,r),l=[[2*a,r],[2*a+1,r],[2*a+1,r+1],[2*a,r+1]];n.push({index:s,stitch:o,op:Bs[o],cnIndices:l.map(([c,h])=>h*2*t+c)})}return n}}const Li="K",Mi="P",zs="ECN",Is="ACN",Ds="UACN";function Hs(e){let t=0,i=0,n=!0,r=0;const a=[];for(;i<e.height;){const s=r%2==0,o=t%2==0,l=s===o?"F":"L";if(Fs(t,i,n,a,e)){let c;if(n)c=[t,i,r,l+"L"];else{const h=Ri(t,i,e);c=[h.i,h.j,r,l+"H"]}a.push(c)}({i:t,j:i,legNode:n,currentStitchRow:r}=Bi(t,i,n,r,e))}return a}function Fs(e,t,i,n,r){if(i)return r.getST(e,t)==Li||r.getST(e,t)==Mi;{let a=r.getAV(e,t);if(a==zs)return!1;if(a==Ds){let s,o,l,c;if(e%2!=t%2)[s,o,l,c]=n.at(-1);else{const u=Bi(e,t,i,t-1,r);s=u.i,o=u.j}const h=Ri(e,t,r);return o<h.j?(r.setAV(e,t,Is),!0):!1}else return!0}}function Ri(e,t,i){const[n,r]=i.getMV(e,t);return t==i.height-1?{i:e,j:t}:n!=0?Je(e+n,t,i):Je(e,t+r,i)}function Je(e,t,i){return i.getST(e,t)==Li||i.getST(e,t)==Mi?{i:e,j:t}:t==i.height-1?{i:e,j:t}:Je(e,t+i.getDeltaJ(e,t),i)}function Bi(e,t,i,n,r){const a=n%2==0,s=e%2==0;let o=e,l=t,c=i;return i?a?s?(l=t+1,c=!1):o=e+1:s?o=e-1:(l=t+1,c=!1):a?s?o=e+1:(l=t-1,c=!0):s?(l=t-1,c=!0):o=e-1,o<0||o>=r.width?{i:e,j:t+1,legNode:!0,currentStitchRow:n+1}:{i:o,j:l,legNode:c,currentStitchRow:n}}function Vs(e,t,i,n){return e[t].st=="K"&&e[i].st=="K"?n=="LHLL"||n=="FLFH"?"front":"back":e[t].st=="P"&&e[i].st=="P"?n=="LHLL"||n=="FLFH"?"back":"front":"mid"}class Os{constructor(t){this.width=t.width,this.height=t.height,this.cns=t,this.contactNodes=t.contacts.map((i,n)=>({index:n,st:i[0],cn:i[1],mv:i[2]})),this.yarnPath=Hs(t)}yarnPathToLinks(){let t=0,i=this.yarnPath[0][3];const n=[];return this.yarnPath.forEach(([r,a,s,o],l)=>{if(l==0)return;let c=a*this.width+r,h=i+o;n.push({source:t,target:c,linkType:h,row:s,index:l-1,layer:Vs(this.contactNodes,t,c,h)}),t=c,i=o}),n}makeNice(){return this.yarnPath.map(([t,i,n,r])=>({cnIndex:i*this.width+t,i:t,j:i,row:n,cnType:r,angle:null,normal:[0,0]}))}}function Oe(e){return function(){return e}}function Dn(e){return(e()-.5)*1e-6}function Ws(e){return e.index}function Hn(e,t){var i=e.get(t);if(!i)throw new Error("node not found: "+t);return i}function qs(e){var t=Ws,i=u,n,r=Oe(30),a,s,o,l,c,h=1;e==null&&(e=[]);function u(x){return 1/Math.min(o[x.source.index],o[x.target.index])}function p(x){for(var A=0,L=e.length;A<h;++A)for(var T=0,B,N,V,W,D,H,X;T<L;++T)B=e[T],N=B.source,V=B.target,W=V.x+V.vx-N.x-N.vx||Dn(c),D=V.y+V.vy-N.y-N.vy||Dn(c),H=Math.sqrt(W*W+D*D),B.linkType=="FLFH"||B.linkType=="LHLL"?Math.sign(H-a[T])<=0?H=(H-a[T])/H*x*.001:H=(H-a[T])/H*x*.2:H=(H-a[T])/H*x*.5,W*=H,D*=H,V.vx-=W*(X=l[T]),V.vy-=D*X,N.vx+=W*(X=1-X),N.vy+=D*X}function g(){if(s){var x,A=s.length,L=e.length,T=new Map(s.map((N,V)=>[t(N,V,s),N])),B;for(x=0,o=new Array(A);x<L;++x)B=e[x],B.index=x,typeof B.source!="object"&&(B.source=Hn(T,B.source)),typeof B.target!="object"&&(B.target=Hn(T,B.target)),o[B.source.index]=(o[B.source.index]||0)+1,o[B.target.index]=(o[B.target.index]||0)+1;for(x=0,l=new Array(L);x<L;++x)B=e[x],l[x]=o[B.source.index]/(o[B.source.index]+o[B.target.index]);n=new Array(L),y(),a=new Array(L),v()}}function y(){if(s)for(var x=0,A=e.length;x<A;++x)n[x]=+i(e[x],x,e)}function v(){if(s)for(var x=0,A=e.length;x<A;++x)a[x]=+r(e[x],x,e)}return p.initialize=function(x,A){s=x,c=A,g()},p.links=function(x){return arguments.length?(e=x,g(),p):e},p.id=function(x){return arguments.length?(t=x,p):t},p.iterations=function(x){return arguments.length?(h=+x,p):h},p.strength=function(x){return arguments.length?(i=typeof x=="function"?x:Oe(+x),y(),p):i},p.distance=function(x){return arguments.length?(r=typeof x=="function"?x:Oe(+x),v(),p):r},p}var Ys={value:()=>{}};function dn(){for(var e=0,t=arguments.length,i={},n;e<t;++e){if(!(n=arguments[e]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new ve(i)}function ve(e){this._=e}function Gs(e,t){return e.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!t.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}ve.prototype=dn.prototype={constructor:ve,on:function(e,t){var i=this._,n=Gs(e+"",i),r,a=-1,s=n.length;if(arguments.length<2){for(;++a<s;)if((r=(e=n[a]).type)&&(r=Xs(i[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<s;)if(r=(e=n[a]).type)i[r]=Fn(i[r],e.name,t);else if(t==null)for(r in i)i[r]=Fn(i[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var i in t)e[i]=t[i].slice();return new ve(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],n=0,r=a.length;n<r;++n)a[n].value.apply(t,i)},apply:function(e,t,i){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],r=0,a=n.length;r<a;++r)n[r].value.apply(t,i)}};function Xs(e,t){for(var i=0,n=e.length,r;i<n;++i)if((r=e[i]).name===t)return r.value}function Fn(e,t,i){for(var n=0,r=e.length;n<r;++n)if(e[n].name===t){e[n]=Ys,e=e.slice(0,n).concat(e.slice(n+1));break}return i!=null&&e.push({name:t,value:i}),e}var Ze="http://www.w3.org/1999/xhtml";const Vn={svg:"http://www.w3.org/2000/svg",xhtml:Ze,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Re(e){var t=e+="",i=t.indexOf(":");return i>=0&&(t=e.slice(0,i))!=="xmlns"&&(e=e.slice(i+1)),Vn.hasOwnProperty(t)?{space:Vn[t],local:e}:e}function Us(e){return function(){var t=this.ownerDocument,i=this.namespaceURI;return i===Ze&&t.documentElement.namespaceURI===Ze?t.createElement(e):t.createElementNS(i,e)}}function Ks(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ni(e){var t=Re(e);return(t.local?Ks:Us)(t)}function Js(){}function fn(e){return e==null?Js:function(){return this.querySelector(e)}}function Zs(e){typeof e!="function"&&(e=fn(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var a=t[r],s=a.length,o=n[r]=new Array(s),l,c,h=0;h<s;++h)(l=a[h])&&(c=e.call(l,l.__data__,h,a))&&("__data__"in l&&(c.__data__=l.__data__),o[h]=c);return new ot(n,this._parents)}function Qs(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function js(){return[]}function Ti(e){return e==null?js:function(){return this.querySelectorAll(e)}}function ta(e){return function(){return Qs(e.apply(this,arguments))}}function ea(e){typeof e=="function"?e=ta(e):e=Ti(e);for(var t=this._groups,i=t.length,n=[],r=[],a=0;a<i;++a)for(var s=t[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&(n.push(e.call(l,l.__data__,c,s)),r.push(l));return new ot(n,r)}function zi(e){return function(){return this.matches(e)}}function Ii(e){return function(t){return t.matches(e)}}var na=Array.prototype.find;function ia(e){return function(){return na.call(this.children,e)}}function ra(){return this.firstElementChild}function sa(e){return this.select(e==null?ra:ia(typeof e=="function"?e:Ii(e)))}var aa=Array.prototype.filter;function oa(){return Array.from(this.children)}function la(e){return function(){return aa.call(this.children,e)}}function ca(e){return this.selectAll(e==null?oa:la(typeof e=="function"?e:Ii(e)))}function ha(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var a=t[r],s=a.length,o=n[r]=[],l,c=0;c<s;++c)(l=a[c])&&e.call(l,l.__data__,c,a)&&o.push(l);return new ot(n,this._parents)}function Di(e){return new Array(e.length)}function ua(){return new ot(this._enter||this._groups.map(Di),this._parents)}function Ee(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Ee.prototype={constructor:Ee,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function da(e){return function(){return e}}function fa(e,t,i,n,r,a){for(var s=0,o,l=t.length,c=a.length;s<c;++s)(o=t[s])?(o.__data__=a[s],n[s]=o):i[s]=new Ee(e,a[s]);for(;s<l;++s)(o=t[s])&&(r[s]=o)}function pa(e,t,i,n,r,a,s){var o,l,c=new Map,h=t.length,u=a.length,p=new Array(h),g;for(o=0;o<h;++o)(l=t[o])&&(p[o]=g=s.call(l,l.__data__,o,t)+"",c.has(g)?r[o]=l:c.set(g,l));for(o=0;o<u;++o)g=s.call(e,a[o],o,a)+"",(l=c.get(g))?(n[o]=l,l.__data__=a[o],c.delete(g)):i[o]=new Ee(e,a[o]);for(o=0;o<h;++o)(l=t[o])&&c.get(p[o])===l&&(r[o]=l)}function ga(e){return e.__data__}function va(e,t){if(!arguments.length)return Array.from(this,ga);var i=t?pa:fa,n=this._parents,r=this._groups;typeof e!="function"&&(e=da(e));for(var a=r.length,s=new Array(a),o=new Array(a),l=new Array(a),c=0;c<a;++c){var h=n[c],u=r[c],p=u.length,g=ma(e.call(h,h&&h.__data__,c,n)),y=g.length,v=o[c]=new Array(y),x=s[c]=new Array(y),A=l[c]=new Array(p);i(h,u,v,x,A,g,t);for(var L=0,T=0,B,N;L<y;++L)if(B=v[L]){for(L>=T&&(T=L+1);!(N=x[T])&&++T<y;);B._next=N||null}}return s=new ot(s,n),s._enter=o,s._exit=l,s}function ma(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ya(){return new ot(this._exit||this._groups.map(Di),this._parents)}function wa(e,t,i){var n=this.enter(),r=this,a=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function ba(e){for(var t=e.selection?e.selection():e,i=this._groups,n=t._groups,r=i.length,a=n.length,s=Math.min(r,a),o=new Array(r),l=0;l<s;++l)for(var c=i[l],h=n[l],u=c.length,p=o[l]=new Array(u),g,y=0;y<u;++y)(g=c[y]||h[y])&&(p[y]=g);for(;l<r;++l)o[l]=i[l];return new ot(o,this._parents)}function xa(){for(var e=this._groups,t=-1,i=e.length;++t<i;)for(var n=e[t],r=n.length-1,a=n[r],s;--r>=0;)(s=n[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function _a(e){e||(e=Ea);function t(u,p){return u&&p?e(u.__data__,p.__data__):!u-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var s=i[a],o=s.length,l=r[a]=new Array(o),c,h=0;h<o;++h)(c=s[h])&&(l[h]=c);l.sort(t)}return new ot(r,this._parents).order()}function Ea(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Sa(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ka(){return Array.from(this)}function Ca(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n=e[t],r=0,a=n.length;r<a;++r){var s=n[r];if(s)return s}return null}function $a(){let e=0;for(const t of this)++e;return e}function Aa(){return!this.node()}function Pa(e){for(var t=this._groups,i=0,n=t.length;i<n;++i)for(var r=t[i],a=0,s=r.length,o;a<s;++a)(o=r[a])&&e.call(o,o.__data__,a,r);return this}function La(e){return function(){this.removeAttribute(e)}}function Ma(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ra(e,t){return function(){this.setAttribute(e,t)}}function Ba(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Na(e,t){return function(){var i=t.apply(this,arguments);i==null?this.removeAttribute(e):this.setAttribute(e,i)}}function Ta(e,t){return function(){var i=t.apply(this,arguments);i==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,i)}}function za(e,t){var i=Re(e);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((t==null?i.local?Ma:La:typeof t=="function"?i.local?Ta:Na:i.local?Ba:Ra)(i,t))}function Hi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ia(e){return function(){this.style.removeProperty(e)}}function Da(e,t,i){return function(){this.style.setProperty(e,t,i)}}function Ha(e,t,i){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,i)}}function Fa(e,t,i){return arguments.length>1?this.each((t==null?Ia:typeof t=="function"?Ha:Da)(e,t,i??"")):zt(this.node(),e)}function zt(e,t){return e.style.getPropertyValue(t)||Hi(e).getComputedStyle(e,null).getPropertyValue(t)}function Va(e){return function(){delete this[e]}}function Oa(e,t){return function(){this[e]=t}}function Wa(e,t){return function(){var i=t.apply(this,arguments);i==null?delete this[e]:this[e]=i}}function qa(e,t){return arguments.length>1?this.each((t==null?Va:typeof t=="function"?Wa:Oa)(e,t)):this.node()[e]}function Fi(e){return e.trim().split(/^|\s+/)}function pn(e){return e.classList||new Vi(e)}function Vi(e){this._node=e,this._names=Fi(e.getAttribute("class")||"")}Vi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Oi(e,t){for(var i=pn(e),n=-1,r=t.length;++n<r;)i.add(t[n])}function Wi(e,t){for(var i=pn(e),n=-1,r=t.length;++n<r;)i.remove(t[n])}function Ya(e){return function(){Oi(this,e)}}function Ga(e){return function(){Wi(this,e)}}function Xa(e,t){return function(){(t.apply(this,arguments)?Oi:Wi)(this,e)}}function Ua(e,t){var i=Fi(e+"");if(arguments.length<2){for(var n=pn(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof t=="function"?Xa:t?Ya:Ga)(i,t))}function Ka(){this.textContent=""}function Ja(e){return function(){this.textContent=e}}function Za(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Qa(e){return arguments.length?this.each(e==null?Ka:(typeof e=="function"?Za:Ja)(e)):this.node().textContent}function ja(){this.innerHTML=""}function to(e){return function(){this.innerHTML=e}}function eo(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function no(e){return arguments.length?this.each(e==null?ja:(typeof e=="function"?eo:to)(e)):this.node().innerHTML}function io(){this.nextSibling&&this.parentNode.appendChild(this)}function ro(){return this.each(io)}function so(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ao(){return this.each(so)}function oo(e){var t=typeof e=="function"?e:Ni(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function lo(){return null}function co(e,t){var i=typeof e=="function"?e:Ni(e),n=t==null?lo:typeof t=="function"?t:fn(t);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function ho(){var e=this.parentNode;e&&e.removeChild(this)}function uo(){return this.each(ho)}function fo(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function po(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function go(e){return this.select(e?po:fo)}function vo(e){return arguments.length?this.property("__data__",e):this.node().__data__}function mo(e){return function(t){e.call(this,t,this.__data__)}}function yo(e){return e.trim().split(/^|\s+/).map(function(t){var i="",n=t.indexOf(".");return n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),{type:t,name:i}})}function wo(e){return function(){var t=this.__on;if(t){for(var i=0,n=-1,r=t.length,a;i<r;++i)a=t[i],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++n]=a;++n?t.length=n:delete this.__on}}}function bo(e,t,i){return function(){var n=this.__on,r,a=mo(t);if(n){for(var s=0,o=n.length;s<o;++s)if((r=n[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=i),r.value=t;return}}this.addEventListener(e.type,a,i),r={type:e.type,name:e.name,value:t,listener:a,options:i},n?n.push(r):this.__on=[r]}}function xo(e,t,i){var n=yo(e+""),r,a=n.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,c=o.length,h;l<c;++l)for(r=0,h=o[l];r<a;++r)if((s=n[r]).type===h.type&&s.name===h.name)return h.value}return}for(o=t?bo:wo,r=0;r<a;++r)this.each(o(n[r],t,i));return this}function qi(e,t,i){var n=Hi(e),r=n.CustomEvent;typeof r=="function"?r=new r(t,i):(r=n.document.createEvent("Event"),i?(r.initEvent(t,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function _o(e,t){return function(){return qi(this,e,t)}}function Eo(e,t){return function(){return qi(this,e,t.apply(this,arguments))}}function So(e,t){return this.each((typeof t=="function"?Eo:_o)(e,t))}function*ko(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n=e[t],r=0,a=n.length,s;r<a;++r)(s=n[r])&&(yield s)}var Co=[null];function ot(e,t){this._groups=e,this._parents=t}function oe(){return new ot([[document.documentElement]],Co)}function $o(){return this}ot.prototype=oe.prototype={constructor:ot,select:Zs,selectAll:ea,selectChild:sa,selectChildren:ca,filter:ha,data:va,enter:ua,exit:ya,join:wa,merge:ba,selection:$o,order:xa,sort:_a,call:Sa,nodes:ka,node:Ca,size:$a,empty:Aa,each:Pa,attr:za,style:Fa,property:qa,classed:Ua,text:Qa,html:no,raise:ro,lower:ao,append:oo,insert:co,remove:uo,clone:go,datum:vo,on:xo,dispatch:So,[Symbol.iterator]:ko};function gn(e,t,i){e.prototype=t.prototype=i,i.constructor=e}function Yi(e,t){var i=Object.create(e.prototype);for(var n in t)i[n]=t[n];return i}function le(){}var ee=.7,Se=1/ee,Nt="\\s*([+-]?\\d+)\\s*",ne="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ht="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ao=/^#([0-9a-f]{3,8})$/,Po=new RegExp(`^rgb\\(${Nt},${Nt},${Nt}\\)$`),Lo=new RegExp(`^rgb\\(${ht},${ht},${ht}\\)$`),Mo=new RegExp(`^rgba\\(${Nt},${Nt},${Nt},${ne}\\)$`),Ro=new RegExp(`^rgba\\(${ht},${ht},${ht},${ne}\\)$`),Bo=new RegExp(`^hsl\\(${ne},${ht},${ht}\\)$`),No=new RegExp(`^hsla\\(${ne},${ht},${ht},${ne}\\)$`),On={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gn(le,ie,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Wn,formatHex:Wn,formatHex8:To,formatHsl:zo,formatRgb:qn,toString:qn});function Wn(){return this.rgb().formatHex()}function To(){return this.rgb().formatHex8()}function zo(){return Gi(this).formatHsl()}function qn(){return this.rgb().formatRgb()}function ie(e){var t,i;return e=(e+"").trim().toLowerCase(),(t=Ao.exec(e))?(i=t[1].length,t=parseInt(t[1],16),i===6?Yn(t):i===3?new Q(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):i===8?de(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):i===4?de(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Po.exec(e))?new Q(t[1],t[2],t[3],1):(t=Lo.exec(e))?new Q(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Mo.exec(e))?de(t[1],t[2],t[3],t[4]):(t=Ro.exec(e))?de(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Bo.exec(e))?Un(t[1],t[2]/100,t[3]/100,1):(t=No.exec(e))?Un(t[1],t[2]/100,t[3]/100,t[4]):On.hasOwnProperty(e)?Yn(On[e]):e==="transparent"?new Q(NaN,NaN,NaN,0):null}function Yn(e){return new Q(e>>16&255,e>>8&255,e&255,1)}function de(e,t,i,n){return n<=0&&(e=t=i=NaN),new Q(e,t,i,n)}function Io(e){return e instanceof le||(e=ie(e)),e?(e=e.rgb(),new Q(e.r,e.g,e.b,e.opacity)):new Q}function Qe(e,t,i,n){return arguments.length===1?Io(e):new Q(e,t,i,n??1)}function Q(e,t,i,n){this.r=+e,this.g=+t,this.b=+i,this.opacity=+n}gn(Q,Qe,Yi(le,{brighter(e){return e=e==null?Se:Math.pow(Se,e),new Q(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?ee:Math.pow(ee,e),new Q(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Q(Ct(this.r),Ct(this.g),Ct(this.b),ke(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Gn,formatHex:Gn,formatHex8:Do,formatRgb:Xn,toString:Xn}));function Gn(){return`#${kt(this.r)}${kt(this.g)}${kt(this.b)}`}function Do(){return`#${kt(this.r)}${kt(this.g)}${kt(this.b)}${kt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Xn(){const e=ke(this.opacity);return`${e===1?"rgb(":"rgba("}${Ct(this.r)}, ${Ct(this.g)}, ${Ct(this.b)}${e===1?")":`, ${e})`}`}function ke(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ct(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function kt(e){return e=Ct(e),(e<16?"0":"")+e.toString(16)}function Un(e,t,i,n){return n<=0?e=t=i=NaN:i<=0||i>=1?e=t=NaN:t<=0&&(e=NaN),new at(e,t,i,n)}function Gi(e){if(e instanceof at)return new at(e.h,e.s,e.l,e.opacity);if(e instanceof le||(e=ie(e)),!e)return new at;if(e instanceof at)return e;e=e.rgb();var t=e.r/255,i=e.g/255,n=e.b/255,r=Math.min(t,i,n),a=Math.max(t,i,n),s=NaN,o=a-r,l=(a+r)/2;return o?(t===a?s=(i-n)/o+(i<n)*6:i===a?s=(n-t)/o+2:s=(t-i)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new at(s,o,l,e.opacity)}function Ho(e,t,i,n){return arguments.length===1?Gi(e):new at(e,t,i,n??1)}function at(e,t,i,n){this.h=+e,this.s=+t,this.l=+i,this.opacity=+n}gn(at,Ho,Yi(le,{brighter(e){return e=e==null?Se:Math.pow(Se,e),new at(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ee:Math.pow(ee,e),new at(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*t,r=2*i-n;return new Q(We(e>=240?e-240:e+120,r,n),We(e,r,n),We(e<120?e+240:e-120,r,n),this.opacity)},clamp(){return new at(Kn(this.h),fe(this.s),fe(this.l),ke(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ke(this.opacity);return`${e===1?"hsl(":"hsla("}${Kn(this.h)}, ${fe(this.s)*100}%, ${fe(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Kn(e){return e=(e||0)%360,e<0?e+360:e}function fe(e){return Math.max(0,Math.min(1,e||0))}function We(e,t,i){return(e<60?t+(i-t)*e/60:e<180?i:e<240?t+(i-t)*(240-e)/60:t)*255}const Xi=e=>()=>e;function Fo(e,t){return function(i){return e+i*t}}function Vo(e,t,i){return e=Math.pow(e,i),t=Math.pow(t,i)-e,i=1/i,function(n){return Math.pow(e+n*t,i)}}function Oo(e){return(e=+e)==1?Ui:function(t,i){return i-t?Vo(t,i,e):Xi(isNaN(t)?i:t)}}function Ui(e,t){var i=t-e;return i?Fo(e,i):Xi(isNaN(e)?t:e)}const Jn=function e(t){var i=Oo(t);function n(r,a){var s=i((r=Qe(r)).r,(a=Qe(a)).r),o=i(r.g,a.g),l=i(r.b,a.b),c=Ui(r.opacity,a.opacity);return function(h){return r.r=s(h),r.g=o(h),r.b=l(h),r.opacity=c(h),r+""}}return n.gamma=e,n}(1);function yt(e,t){return e=+e,t=+t,function(i){return e*(1-i)+t*i}}var je=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qe=new RegExp(je.source,"g");function Wo(e){return function(){return e}}function qo(e){return function(t){return e(t)+""}}function Yo(e,t){var i=je.lastIndex=qe.lastIndex=0,n,r,a,s=-1,o=[],l=[];for(e=e+"",t=t+"";(n=je.exec(e))&&(r=qe.exec(t));)(a=r.index)>i&&(a=t.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:yt(n,r)})),i=qe.lastIndex;return i<t.length&&(a=t.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?qo(l[0].x):Wo(t):(t=l.length,function(c){for(var h=0,u;h<t;++h)o[(u=l[h]).i]=u.x(c);return o.join("")})}var Zn=180/Math.PI,tn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ki(e,t,i,n,r,a){var s,o,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*i+t*n)&&(i-=e*l,n-=t*l),(o=Math.sqrt(i*i+n*n))&&(i/=o,n/=o,l/=o),e*n<t*i&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*Zn,skewX:Math.atan(l)*Zn,scaleX:s,scaleY:o}}var pe;function Go(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?tn:Ki(t.a,t.b,t.c,t.d,t.e,t.f)}function Xo(e){return e==null||(pe||(pe=document.createElementNS("http://www.w3.org/2000/svg","g")),pe.setAttribute("transform",e),!(e=pe.transform.baseVal.consolidate()))?tn:(e=e.matrix,Ki(e.a,e.b,e.c,e.d,e.e,e.f))}function Ji(e,t,i,n){function r(c){return c.length?c.pop()+" ":""}function a(c,h,u,p,g,y){if(c!==u||h!==p){var v=g.push("translate(",null,t,null,i);y.push({i:v-4,x:yt(c,u)},{i:v-2,x:yt(h,p)})}else(u||p)&&g.push("translate("+u+t+p+i)}function s(c,h,u,p){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),p.push({i:u.push(r(u)+"rotate(",null,n)-2,x:yt(c,h)})):h&&u.push(r(u)+"rotate("+h+n)}function o(c,h,u,p){c!==h?p.push({i:u.push(r(u)+"skewX(",null,n)-2,x:yt(c,h)}):h&&u.push(r(u)+"skewX("+h+n)}function l(c,h,u,p,g,y){if(c!==u||h!==p){var v=g.push(r(g)+"scale(",null,",",null,")");y.push({i:v-4,x:yt(c,u)},{i:v-2,x:yt(h,p)})}else(u!==1||p!==1)&&g.push(r(g)+"scale("+u+","+p+")")}return function(c,h){var u=[],p=[];return c=e(c),h=e(h),a(c.translateX,c.translateY,h.translateX,h.translateY,u,p),s(c.rotate,h.rotate,u,p),o(c.skewX,h.skewX,u,p),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,u,p),c=h=null,function(g){for(var y=-1,v=p.length,x;++y<v;)u[(x=p[y]).i]=x.x(g);return u.join("")}}}var Uo=Ji(Go,"px, ","px)","deg)"),Ko=Ji(Xo,", ",")",")"),It=0,Yt=0,Wt=0,Zi=1e3,Ce,Gt,$e=0,At=0,Be=0,re=typeof performance=="object"&&performance.now?performance:Date,Qi=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function vn(){return At||(Qi(Jo),At=re.now()+Be)}function Jo(){At=0}function Ae(){this._call=this._time=this._next=null}Ae.prototype=mn.prototype={constructor:Ae,restart:function(e,t,i){if(typeof e!="function")throw new TypeError("callback is not a function");i=(i==null?vn():+i)+(t==null?0:+t),!this._next&&Gt!==this&&(Gt?Gt._next=this:Ce=this,Gt=this),this._call=e,this._time=i,en()},stop:function(){this._call&&(this._call=null,this._time=1/0,en())}};function mn(e,t,i){var n=new Ae;return n.restart(e,t,i),n}function Zo(){vn(),++It;for(var e=Ce,t;e;)(t=At-e._time)>=0&&e._call.call(void 0,t),e=e._next;--It}function Qn(){At=($e=re.now())+Be,It=Yt=0;try{Zo()}finally{It=0,jo(),At=0}}function Qo(){var e=re.now(),t=e-$e;t>Zi&&(Be-=t,$e=e)}function jo(){for(var e,t=Ce,i,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(i=t._next,t._next=null,t=e?e._next=i:Ce=i);Gt=e,en(n)}function en(e){if(!It){Yt&&(Yt=clearTimeout(Yt));var t=e-At;t>24?(e<1/0&&(Yt=setTimeout(Qn,e-re.now()-Be)),Wt&&(Wt=clearInterval(Wt))):(Wt||($e=re.now(),Wt=setInterval(Qo,Zi)),It=1,Qi(Qn))}}function jn(e,t,i){var n=new Ae;return t=t==null?0:+t,n.restart(r=>{n.stop(),e(r+t)},t,i),n}var tl=dn("start","end","cancel","interrupt"),el=[],ji=0,ti=1,nn=2,me=3,ei=4,rn=5,ye=6;function Ne(e,t,i,n,r,a){var s=e.__transition;if(!s)e.__transition={};else if(i in s)return;nl(e,i,{name:t,index:n,group:r,on:tl,tween:el,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:ji})}function yn(e,t){var i=lt(e,t);if(i.state>ji)throw new Error("too late; already scheduled");return i}function ut(e,t){var i=lt(e,t);if(i.state>me)throw new Error("too late; already running");return i}function lt(e,t){var i=e.__transition;if(!i||!(i=i[t]))throw new Error("transition not found");return i}function nl(e,t,i){var n=e.__transition,r;n[t]=i,i.timer=mn(a,0,i.time);function a(c){i.state=ti,i.timer.restart(s,i.delay,i.time),i.delay<=c&&s(c-i.delay)}function s(c){var h,u,p,g;if(i.state!==ti)return l();for(h in n)if(g=n[h],g.name===i.name){if(g.state===me)return jn(s);g.state===ei?(g.state=ye,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete n[h]):+h<t&&(g.state=ye,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete n[h])}if(jn(function(){i.state===me&&(i.state=ei,i.timer.restart(o,i.delay,i.time),o(c))}),i.state=nn,i.on.call("start",e,e.__data__,i.index,i.group),i.state===nn){for(i.state=me,r=new Array(p=i.tween.length),h=0,u=-1;h<p;++h)(g=i.tween[h].value.call(e,e.__data__,i.index,i.group))&&(r[++u]=g);r.length=u+1}}function o(c){for(var h=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=rn,1),u=-1,p=r.length;++u<p;)r[u].call(e,h);i.state===rn&&(i.on.call("end",e,e.__data__,i.index,i.group),l())}function l(){i.state=ye,i.timer.stop(),delete n[t];for(var c in n)return;delete e.__transition}}function il(e,t){var i=e.__transition,n,r,a=!0,s;if(i){t=t==null?null:t+"";for(s in i){if((n=i[s]).name!==t){a=!1;continue}r=n.state>nn&&n.state<rn,n.state=ye,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete i[s]}a&&delete e.__transition}}function rl(e){return this.each(function(){il(this,e)})}function sl(e,t){var i,n;return function(){var r=ut(this,e),a=r.tween;if(a!==i){n=i=a;for(var s=0,o=n.length;s<o;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}r.tween=n}}function al(e,t,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=ut(this,e),s=a.tween;if(s!==n){r=(n=s).slice();for(var o={name:t,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=o;break}l===c&&r.push(o)}a.tween=r}}function ol(e,t){var i=this._id;if(e+="",arguments.length<2){for(var n=lt(this.node(),i).tween,r=0,a=n.length,s;r<a;++r)if((s=n[r]).name===e)return s.value;return null}return this.each((t==null?sl:al)(i,e,t))}function wn(e,t,i){var n=e._id;return e.each(function(){var r=ut(this,n);(r.value||(r.value={}))[t]=i.apply(this,arguments)}),function(r){return lt(r,n).value[t]}}function tr(e,t){var i;return(typeof t=="number"?yt:t instanceof ie?Jn:(i=ie(t))?(t=i,Jn):Yo)(e,t)}function ll(e){return function(){this.removeAttribute(e)}}function cl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hl(e,t,i){var n,r=i+"",a;return function(){var s=this.getAttribute(e);return s===r?null:s===n?a:a=t(n=s,i)}}function ul(e,t,i){var n,r=i+"",a;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===n?a:a=t(n=s,i)}}function dl(e,t,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=t(n=s,o)))}}function fl(e,t,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=t(n=s,o)))}}function pl(e,t){var i=Re(e),n=i==="transform"?Ko:tr;return this.attrTween(e,typeof t=="function"?(i.local?fl:dl)(i,n,wn(this,"attr."+e,t)):t==null?(i.local?cl:ll)(i):(i.local?ul:hl)(i,n,t))}function gl(e,t){return function(i){this.setAttribute(e,t.call(this,i))}}function vl(e,t){return function(i){this.setAttributeNS(e.space,e.local,t.call(this,i))}}function ml(e,t){var i,n;function r(){var a=t.apply(this,arguments);return a!==n&&(i=(n=a)&&vl(e,a)),i}return r._value=t,r}function yl(e,t){var i,n;function r(){var a=t.apply(this,arguments);return a!==n&&(i=(n=a)&&gl(e,a)),i}return r._value=t,r}function wl(e,t){var i="attr."+e;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;var n=Re(e);return this.tween(i,(n.local?ml:yl)(n,t))}function bl(e,t){return function(){yn(this,e).delay=+t.apply(this,arguments)}}function xl(e,t){return t=+t,function(){yn(this,e).delay=t}}function _l(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?bl:xl)(t,e)):lt(this.node(),t).delay}function El(e,t){return function(){ut(this,e).duration=+t.apply(this,arguments)}}function Sl(e,t){return t=+t,function(){ut(this,e).duration=t}}function kl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?El:Sl)(t,e)):lt(this.node(),t).duration}function Cl(e,t){if(typeof t!="function")throw new Error;return function(){ut(this,e).ease=t}}function $l(e){var t=this._id;return arguments.length?this.each(Cl(t,e)):lt(this.node(),t).ease}function Al(e,t){return function(){var i=t.apply(this,arguments);if(typeof i!="function")throw new Error;ut(this,e).ease=i}}function Pl(e){if(typeof e!="function")throw new Error;return this.each(Al(this._id,e))}function Ll(e){typeof e!="function"&&(e=zi(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var a=t[r],s=a.length,o=n[r]=[],l,c=0;c<s;++c)(l=a[c])&&e.call(l,l.__data__,c,a)&&o.push(l);return new gt(n,this._parents,this._name,this._id)}function Ml(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,i=e._groups,n=t.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l=t[o],c=i[o],h=l.length,u=s[o]=new Array(h),p,g=0;g<h;++g)(p=l[g]||c[g])&&(u[g]=p);for(;o<n;++o)s[o]=t[o];return new gt(s,this._parents,this._name,this._id)}function Rl(e){return(e+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");return i>=0&&(t=t.slice(0,i)),!t||t==="start"})}function Bl(e,t,i){var n,r,a=Rl(t)?yn:ut;return function(){var s=a(this,e),o=s.on;o!==n&&(r=(n=o).copy()).on(t,i),s.on=r}}function Nl(e,t){var i=this._id;return arguments.length<2?lt(this.node(),i).on.on(e):this.each(Bl(i,e,t))}function Tl(e){return function(){var t=this.parentNode;for(var i in this.__transition)if(+i!==e)return;t&&t.removeChild(this)}}function zl(){return this.on("end.remove",Tl(this._id))}function Il(e){var t=this._name,i=this._id;typeof e!="function"&&(e=fn(e));for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s)for(var o=n[s],l=o.length,c=a[s]=new Array(l),h,u,p=0;p<l;++p)(h=o[p])&&(u=e.call(h,h.__data__,p,o))&&("__data__"in h&&(u.__data__=h.__data__),c[p]=u,Ne(c[p],t,i,p,c,lt(h,i)));return new gt(a,this._parents,t,i)}function Dl(e){var t=this._name,i=this._id;typeof e!="function"&&(e=Ti(e));for(var n=this._groups,r=n.length,a=[],s=[],o=0;o<r;++o)for(var l=n[o],c=l.length,h,u=0;u<c;++u)if(h=l[u]){for(var p=e.call(h,h.__data__,u,l),g,y=lt(h,i),v=0,x=p.length;v<x;++v)(g=p[v])&&Ne(g,t,i,v,p,y);a.push(p),s.push(h)}return new gt(a,s,t,i)}var Hl=oe.prototype.constructor;function Fl(){return new Hl(this._groups,this._parents)}function Vl(e,t){var i,n,r;return function(){var a=zt(this,e),s=(this.style.removeProperty(e),zt(this,e));return a===s?null:a===i&&s===n?r:r=t(i=a,n=s)}}function er(e){return function(){this.style.removeProperty(e)}}function Ol(e,t,i){var n,r=i+"",a;return function(){var s=zt(this,e);return s===r?null:s===n?a:a=t(n=s,i)}}function Wl(e,t,i){var n,r,a;return function(){var s=zt(this,e),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(e),zt(this,e))),s===l?null:s===n&&l===r?a:(r=l,a=t(n=s,o))}}function ql(e,t){var i,n,r,a="style."+t,s="end."+a,o;return function(){var l=ut(this,e),c=l.on,h=l.value[a]==null?o||(o=er(t)):void 0;(c!==i||r!==h)&&(n=(i=c).copy()).on(s,r=h),l.on=n}}function Yl(e,t,i){var n=(e+="")=="transform"?Uo:tr;return t==null?this.styleTween(e,Vl(e,n)).on("end.style."+e,er(e)):typeof t=="function"?this.styleTween(e,Wl(e,n,wn(this,"style."+e,t))).each(ql(this._id,e)):this.styleTween(e,Ol(e,n,t),i).on("end.style."+e,null)}function Gl(e,t,i){return function(n){this.style.setProperty(e,t.call(this,n),i)}}function Xl(e,t,i){var n,r;function a(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&Gl(e,s,i)),n}return a._value=t,a}function Ul(e,t,i){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Xl(e,t,i??""))}function Kl(e){return function(){this.textContent=e}}function Jl(e){return function(){var t=e(this);this.textContent=t??""}}function Zl(e){return this.tween("text",typeof e=="function"?Jl(wn(this,"text",e)):Kl(e==null?"":e+""))}function Ql(e){return function(t){this.textContent=e.call(this,t)}}function jl(e){var t,i;function n(){var r=e.apply(this,arguments);return r!==i&&(t=(i=r)&&Ql(r)),t}return n._value=e,n}function tc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,jl(e))}function ec(){for(var e=this._name,t=this._id,i=nr(),n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,c=0;c<o;++c)if(l=s[c]){var h=lt(l,t);Ne(l,e,i,c,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new gt(n,this._parents,e,i)}function nc(){var e,t,i=this,n=i._id,r=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--r===0&&a()}};i.each(function(){var c=ut(this,n),h=c.on;h!==e&&(t=(e=h).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),c.on=t}),r===0&&a()})}var ic=0;function gt(e,t,i,n){this._groups=e,this._parents=t,this._name=i,this._id=n}function nr(){return++ic}var ft=oe.prototype;gt.prototype={constructor:gt,select:Il,selectAll:Dl,selectChild:ft.selectChild,selectChildren:ft.selectChildren,filter:Ll,merge:Ml,selection:Fl,transition:ec,call:ft.call,nodes:ft.nodes,node:ft.node,size:ft.size,empty:ft.empty,each:ft.each,on:Nl,attr:pl,attrTween:wl,style:Yl,styleTween:Ul,text:Zl,textTween:tc,remove:zl,tween:ol,delay:_l,duration:kl,ease:$l,easeVarying:Pl,end:nc,[Symbol.iterator]:ft[Symbol.iterator]};function rc(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var sc={time:null,delay:0,duration:250,ease:rc};function ac(e,t){for(var i;!(i=e.__transition)||!(i=i[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return i}function oc(e){var t,i;e instanceof gt?(t=e._id,e=e._name):(t=nr(),(i=sc).time=vn(),e=e==null?null:e+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&Ne(l,e,t,c,s,i||ac(l,t));return new gt(n,this._parents,e,t)}oe.prototype.interrupt=rl;oe.prototype.transition=oc;const sn=Math.PI,an=2*sn,Et=1e-6,lc=an-Et;function ir(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=arguments[t]+e[t]}function cc(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return ir;const i=10**t;return function(n){this._+=n[0];for(let r=1,a=n.length;r<a;++r)this._+=Math.round(arguments[r]*i)/i+n[r]}}class hc{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?ir:cc(t)}moveTo(t,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,i){this._append`L${this._x1=+t},${this._y1=+i}`}quadraticCurveTo(t,i,n,r){this._append`Q${+t},${+i},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,i,n,r,a,s){this._append`C${+t},${+i},${+n},${+r},${this._x1=+a},${this._y1=+s}`}arcTo(t,i,n,r,a){if(t=+t,i=+i,n=+n,r=+r,a=+a,a<0)throw new Error(`negative radius: ${a}`);let s=this._x1,o=this._y1,l=n-t,c=r-i,h=s-t,u=o-i,p=h*h+u*u;if(this._x1===null)this._append`M${this._x1=t},${this._y1=i}`;else if(p>Et)if(!(Math.abs(u*l-c*h)>Et)||!a)this._append`L${this._x1=t},${this._y1=i}`;else{let g=n-s,y=r-o,v=l*l+c*c,x=g*g+y*y,A=Math.sqrt(v),L=Math.sqrt(p),T=a*Math.tan((sn-Math.acos((v+p-x)/(2*A*L)))/2),B=T/L,N=T/A;Math.abs(B-1)>Et&&this._append`L${t+B*h},${i+B*u}`,this._append`A${a},${a},0,0,${+(u*g>h*y)},${this._x1=t+N*l},${this._y1=i+N*c}`}}arc(t,i,n,r,a,s){if(t=+t,i=+i,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(r),l=n*Math.sin(r),c=t+o,h=i+l,u=1^s,p=s?r-a:a-r;this._x1===null?this._append`M${c},${h}`:(Math.abs(this._x1-c)>Et||Math.abs(this._y1-h)>Et)&&this._append`L${c},${h}`,n&&(p<0&&(p=p%an+an),p>lc?this._append`A${n},${n},0,1,${u},${t-o},${i-l}A${n},${n},0,1,${u},${this._x1=c},${this._y1=h}`:p>Et&&this._append`A${n},${n},0,${+(p>=sn)},${u},${this._x1=t+n*Math.cos(a)},${this._y1=i+n*Math.sin(a)}`)}rect(t,i,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}const uc=1664525,dc=1013904223,ni=4294967296;function fc(){let e=1;return()=>(e=(uc*e+dc)%ni)/ni}var pc=10,gc=Math.PI*(3-Math.sqrt(5));function vc(e){var t,i=1,n=.001,r=1-Math.pow(n,1/300),a=0,s=.6,o=new Map,l=mn(u),c=dn("tick","end"),h=fc();e==null&&(e=[]);function u(){p(),c.call("tick",t),i<n&&(l.stop(),c.call("end",t))}function p(v){var x,A=e.length,L;v===void 0&&(v=1);for(var T=0;T<v;++T)for(i+=(a-i)*r,o.forEach(function(B){B(i)}),x=0;x<A;++x)L=e[x],L.fx==null?L.x+=L.vx*=s:(L.x=L.fx,L.vx=0),L.fy==null?L.y+=L.vy*=s:(L.y=L.fy,L.vy=0);return t}function g(){for(var v=0,x=e.length,A;v<x;++v){if(A=e[v],A.index=v,A.fx!=null&&(A.x=A.fx),A.fy!=null&&(A.y=A.fy),isNaN(A.x)||isNaN(A.y)){var L=pc*Math.sqrt(.5+v),T=v*gc;A.x=L*Math.cos(T),A.y=L*Math.sin(T)}(isNaN(A.vx)||isNaN(A.vy))&&(A.vx=A.vy=0)}}function y(v){return v.initialize&&v.initialize(e,h),v}return g(),t={tick:p,restart:function(){return l.restart(u),t},stop:function(){return l.stop(),t},nodes:function(v){return arguments.length?(e=v,g(),o.forEach(y),t):e},alpha:function(v){return arguments.length?(i=+v,t):i},alphaMin:function(v){return arguments.length?(n=+v,t):n},alphaDecay:function(v){return arguments.length?(r=+v,t):+r},alphaTarget:function(v){return arguments.length?(a=+v,t):a},velocityDecay:function(v){return arguments.length?(s=1-v,t):1-s},randomSource:function(v){return arguments.length?(h=v,o.forEach(y),t):h},force:function(v,x){return arguments.length>1?(x==null?o.delete(v):o.set(v,y(x)),t):o.get(v)},find:function(v,x,A){var L=0,T=e.length,B,N,V,W,D;for(A==null?A=1/0:A*=A,L=0;L<T;++L)W=e[L],B=v-W.x,N=x-W.y,V=B*B+N*N,V<A&&(D=W,A=V);return D},on:function(v,x){return arguments.length>1?(c.on(v,x),t):c.on(v)}}}function Rt(e){return function(){return e}}const ii=1e-12;function mc(e){let t=3;return e.digits=function(i){if(!arguments.length)return t;if(i==null)t=null;else{const n=Math.floor(i);if(!(n>=0))throw new RangeError(`invalid digits: ${i}`);t=n}return e},()=>new hc(t)}function yc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function rr(e){this._context=e}rr.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function wc(e){return new rr(e)}function bc(e){return e[0]}function xc(e){return e[1]}function _c(e,t){var i=Rt(!0),n=null,r=wc,a=null,s=mc(o);e=typeof e=="function"?e:e===void 0?bc:Rt(e),t=typeof t=="function"?t:t===void 0?xc:Rt(t);function o(l){var c,h=(l=yc(l)).length,u,p=!1,g;for(n==null&&(a=r(g=s())),c=0;c<=h;++c)!(c<h&&i(u=l[c],c,l))===p&&((p=!p)?a.lineStart():a.lineEnd()),p&&a.point(+e(u,c,l),+t(u,c,l));if(g)return a=null,g+""||null}return o.x=function(l){return arguments.length?(e=typeof l=="function"?l:Rt(+l),o):e},o.y=function(l){return arguments.length?(t=typeof l=="function"?l:Rt(+l),o):t},o.defined=function(l){return arguments.length?(i=typeof l=="function"?l:Rt(!!l),o):i},o.curve=function(l){return arguments.length?(r=l,n!=null&&(a=r(n)),o):r},o.context=function(l){return arguments.length?(l==null?n=a=null:a=r(n=l),o):n},o}function on(e,t,i){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-i),e._x2,e._y2)}function bn(e,t){this._context=e,this._k=(1-t)/6}bn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:on(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:on(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function i(n){return new bn(n,t)}return i.tension=function(n){return e(+n)},i})(0);function xn(e,t){this._context=e,this._k=(1-t)/6}xn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:on(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function i(n){return new xn(n,t)}return i.tension=function(n){return e(+n)},i})(0);function sr(e,t,i){var n=e._x1,r=e._y1,a=e._x2,s=e._y2;if(e._l01_a>ii){var o=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);n=(n*o-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*o-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>ii){var c=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,h=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*c+e._x1*e._l23_2a-t*e._l12_2a)/h,s=(s*c+e._y1*e._l23_2a-i*e._l12_2a)/h}e._context.bezierCurveTo(n,r,a,s,e._x2,e._y2)}function ar(e,t){this._context=e,this._alpha=t}ar.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var i=this._x2-e,n=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:sr(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function i(n){return t?new ar(n,t):new bn(n,0)}return i.alpha=function(n){return e(+n)},i})(.5);function or(e,t){this._context=e,this._alpha=t}or.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var i=this._x2-e,n=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:sr(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ec=function e(t){function i(n){return t?new or(n,t):new xn(n,0)}return i.alpha=function(n){return e(+n)},i}(.5);function Xt(e,t,i){this.k=e,this.x=t,this.y=i}Xt.prototype={constructor:Xt,scale:function(e){return e===1?this:new Xt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Xt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Xt.prototype;const Sc=1,ge=0,ri=5/3,kc=.24,Cc=.88,$c=.05,Ac=.2,Pc=1,Lc=.2,Mc=.7,si=devicePixelRatio;function Rc(e,t,i,n){let r=!1,a,s,o,l=new Set(t),c={...i,border:"#00000033"};performance.clearMeasures(),performance.mark("start");function h(_){const P=Math.min(H*.9/N.width,X*.9/N.height*ri),I=P/2;s=P/ri,a=P*kc;const Y=a+(H-N.width*P)/2,et=-a+(X-N.height*s)/2;return _.contactNodes.forEach((k,m)=>{const E=m%_.width,$=(m-E)/_.width;k.i=E,k.j=$,k.x=Y+E*I,k.y=et+(_.height-$)*s}),_.contactNodes}function u(_,P,I){if(_.index===P.index)return[0,0];const Y=_.x-P.x,et=_.y-P.y,k=Cc*Math.sqrt(Y**2+et**2);return I?[-et/k,Y/k]:[et/k,-Y/k]}function p(){M[0].normal=u(S[M[0].cnIndex],S[M[1].cnIndex],!0);for(let _=1;_<M.length-1;_++){let P;M[_].cnType=="FH"||M[_].cnType=="LH"?M[_].row%2==0?P=!0:P=!1:M[_].row%2==0?P=!1:P=!0,M[_].normal=u(S[M[_-1].cnIndex],S[M[_+1].cnIndex],P)}M.at(-1).normal=u(S[M.at(-2).cnIndex],S[M.at(-1).cnIndex],!0)}const g=_c().x(_=>S[_.cnIndex].x+a/2*_.normal[0]).y(_=>S[_.cnIndex].y+a/2*_.normal[1]).curve(Ec);function y(_){const P=_.index;if(P==0||P>R.length-3)return`M ${_.source.x} ${_.source.y} ${_.target.x} ${_.target.y}`;const I=[M[P-1],M[P],M[P+1],M[P+2]];return g(I)}function v(){const _={front:{border:[]},back:{border:[]},mid:{border:[]}};for(const P of l)_.front[P]=[],_.back[P]=[],_.mid[P]=[];return _}function x(_){return _<ge||_>=N.height-ge?"border":t[(_-ge)%t.length]}function A(_,P){_.lineWidth=a,Object.entries(P).forEach(([I,Y])=>{_.strokeStyle=c[I],_.stroke(new Path2D(Y.join(" ")))})}function L(){f.clearRect(0,0,H,X),mt.clearRect(0,0,H,X),j.clearRect(0,0,H,X),p();const _=v();R.forEach((P,I)=>{if(I==0||I>R.length-3)return;const Y=x(P.row);_[P.layer][Y].push(y(P))}),A(j,_.back),A(f,_.front),A(mt,_.mid)}function T(){r||(o=vc(S).alphaMin(Ac).alphaDecay($c).force("link",qs(R).strength(Lc).iterations(Pc).distance(_=>_.linkType=="FLFH"||_.linkType=="LHLL"?s*Mc:Math.abs(_.source.x-_.target.x))).on("tick",L),r=!0)}function B(){o&&o.stop()}const N=new Ts(e.pad(Sc,ge,0)),V=document.getElementById("sim-container").getBoundingClientRect(),W=V.width*n,D=V.height*n,H=si*W,X=si*D;function Lt(_){return _.map(P=>{let I=document.getElementById(P);return I.width=H,I.height=X,I.style.cssText=`width: ${W}px; height: ${D}px;`,I})}let[Ht,ct,vt]=Lt(["back","mid","front"]);const j=Ht.getContext("2d"),mt=ct.getContext("2d"),f=vt.getContext("2d"),b=new Rs(N),C=new Os(b.cn),S=h(C),M=C.makeNice(),R=C.yarnPathToLinks();return L(),{relax:T,stopSim:B}}let Ye,lr;function Bc(){return F`<div id="sim-pane">
    <div id="sim-container">
      <div
        style="transform: translate(${d.simPan.x}px, ${d.simPan.y}px)"
        class=${d.flipped?"mirrored":""}>
        <canvas
          id="back"
          class=${d.flipped?"top":"bottom"}></canvas>
        <canvas id="mid" class="mid"></canvas>
        <canvas
          id="front"
          class=${d.flipped?"bottom":"top"}></canvas>
      </div>
    </div>
    <div id="sim-controls" class="panzoom-controls">
      <button @click=${lr} class="btn solid">relax</button>
      <button
        @click=${()=>w({flipped:!d.flipped})}
        class="btn solid">
        flip
      </button>
      <button
        class="btn icon"
        @click=${()=>He(d.simScale*.9)}>
        <i class="fa-solid fa-magnifying-glass-minus"></i>
      </button>
      <input
        type="range"
        min=${xi}
        max=${bi}
        step="0.1"
        .value=${String(d.simScale)}
        @input=${e=>He(Number(e.target.value))} />
      <button
        class="btn icon"
        @click=${()=>He(d.simScale*1.1)}>
        <i class="fa-solid fa-magnifying-glass-plus"></i>
      </button>
      <button
        @click=${()=>w({simPan:{x:0,y:0},simScale:1})}
        class="btn icon">
        <i class="fa-solid fa-expand"></i>
      </button>
    </div>
  </div>`}const Nc=(e,t)=>{let i=null;return(...n)=>{window.clearTimeout(i),i=window.setTimeout(()=>{e.apply(null,n)},t)}};function Tc(){return({state:e})=>{function t(){Ye&&Ye(),{stopSim:Ye,relax:lr}=Rc(d.chart,d.yarnSequence.pixels,d.yarnPalette,d.simScale)}const i=Nc(t,30);return t(),{syncState(n,r){["repeats","yarnPalette","yarnSequence","chart"].some(s=>r.includes(s))&&i(),r.includes("simScale")&&t()}}}}function zc(){return F`
    ${Bt(d.showDownload,as)}
    ${Bt(d.showLibrary,os)}
    ${Bt(d.showSettings,ds)} ${Ur()}

    <div id="site">
      <div id="chart-pane">
        <div id="chart-layout">
          ${ws()}

          <div id="desktop">
            ${As()}
            <div
              id="canvas-transform-group"
              style="transform: translate(${Math.floor(d.chartPan.x)}px, ${Math.floor(d.chartPan.y)}px);">
              <div id="yarn-sequence">
                <button id="color-dragger" class="btn solid grab">
                  <i class="fa-solid fa-grip"></i>
                </button>
                <canvas id="yarn-sequence-canvas"></canvas>
              </div>
              <canvas id="yarn-color-canvas"></canvas>
              <canvas id="symbol-canvas"></canvas>
              <canvas id="grid" class="grid-canvas"></canvas>
              ${_s()}
            </div>
          </div>
          ${fs()}
        </div>
      </div>
      ${Bc()}
    </div>
    ${Bt(d.debug,gs)}
  `}function Ic({canvas:e}){return({state:t})=>{let{scale:i,yarnSequence:n,yarnPalette:r}=t,a=n.width,s=n.height,o=null;function l(){const c=e.getContext("2d");for(let h=0;h<s;h++)for(let u=0;u<a;u++){let p=n.pixel(u,s-h-1);(o==null||o.pixel(u,s-h-1)!=p)&&(c.translate(u*i,h*i),c.fillStyle=r[p],c.clearRect(0,0,i,i),c.fillRect(0,0,i,i),c.setTransform(1,0,0,1,0,0))}o=n}return _e(e,a,s),l(),{syncState(c){r!=c.yarnPalette&&(r=c.yarnPalette,o=null),(i!=c.scale||a!=c.yarnSequence.width||s!=c.yarnSequence.height)&&(a=c.yarnSequence.width,s=c.yarnSequence.height,i=c.scale,_e(e,a,s),o=null),o!=c.yarnSequence&&(n=c.yarnSequence,l())}}}}function Dc(e){return({state:t})=>{let{scale:i,yarnPalette:n,yarnSequence:r,chart:a}=t,s=null,o=a.width,l=a.height,c=r.height;function h(){const u=e.getContext("2d");for(let p=0;p<l;p++){let g=r.pixel(0,(l-p-1)%c);(s==null||s.pixel(0,(l-p-1)%c)!=g)&&(u.fillStyle=n[g],u.fillRect(0,p*i,o*i,i))}s=r}return s=null,h(),{syncState(u){r=u.yarnSequence,(o!=u.chart.width||l!=u.chart.height||c!=u.yarnSequence.height||i!=u.scale)&&(o=u.chart.width,l=u.chart.height,c=u.yarnSequence.height,i=u.scale,s=null),n!=u.yarnPalette&&(n=u.yarnPalette,s=null),s!=u.yarnSequence&&(r=u.yarnSequence,h())}}}}function Hc(e){return({state:t})=>{let{scale:i,symbolMap:n,chart:r,symbolLineWidth:a}=t,s=null,o=r.width,l=r.height;function c(){const h=e.getContext("2d");h.lineWidth=.01*a,h.resetTransform(),h.translate(-.5,-.5);for(let u=0;u<l;u++)for(let p=0;p<o;p++){let g=r.pixel(p,u);if(s==null||s.pixel(p,u)!=g){const y=n[g];h.save(),h.translate(p*i,(l-u-1)*i),h.scale(i,i),h.clearRect(0,0,1,1),Ei[y]&&(h.fillStyle="#fff",h.fillRect(0,0,1,1)),h.stroke(hn[y]),h.restore()}}s=r}return s=null,c(),{syncState(h){(o!=h.chart.width||l!=h.chart.height||i!=h.scale||a!=h.symbolLineWidth)&&(o=h.chart.width,l=h.chart.height,i=h.scale,a=h.symbolLineWidth,s=null),s!=h.chart&&(r=h.chart,c())}}}}function Fc(e){return({state:t})=>{let{scale:i,chart:n,grid:r}=t,a=n.width,s=n.height;function o(){if(!r)return;const l=e.getContext("2d");if(i<15){l.clearRect(0,0,e.width,e.height);return}l.save(),l.translate(-.5,-.5),l.clearRect(0,0,e.width,e.height),l.beginPath();for(let c=0;c<a;c++)l.moveTo(c*i,0),l.lineTo(c*i,s*i+1);for(let c=0;c<s;c++)l.moveTo(0,c*i),l.lineTo(a*i+1,c*i);l.stroke(),l.restore()}return _e(e,a,s),o(),{syncState(l){(i!=l.scale||a!=l.chart.width||s!=l.chart.height||r!=l.grid)&&(a=l.chart.width,s=l.chart.height,i=l.scale,r=l.grid,_e(e,a,s),o())}}}}function ai(e){for(const t of e)t.bitmap=null}function Vc(){return({state:e})=>{let{scale:t,symbolMap:i,repeats:n,symbolLineWidth:r}=e,a=n.map(h=>({bitmap:null,pos:[...h.pos]}));function s(h,u,p){[document.getElementById(`repeat-${h}`),document.getElementById(`repeat-${h}-grid`),document.getElementById(`repeat-${h}-outline`)].forEach(y=>{if(y==null){a[h].bitmap=null;return}y.width=d.scale*u,y.height=d.scale*p,y.style.width=`${d.scale*u/devicePixelRatio}px`,y.style.height=`${d.scale*p/devicePixelRatio}px`})}function o(h){if(!d.grid)return;const u=document.getElementById(`repeat-${h}-grid`),p=u.getContext("2d"),g=n[h].bitmap.width,y=n[h].bitmap.height;if(t<15){p.clearRect(0,0,u.width,u.height);return}p.save(),p.translate(-.5,-.5),p.clearRect(0,0,u.width,u.height),p.beginPath();for(let v=0;v<g;v++)p.moveTo(v*t,0),p.lineTo(v*t,y*t+1);for(let v=0;v<y;v++)p.moveTo(0,v*t),p.lineTo(g*t+1,v*t);p.stroke(),p.restore()}function l(h){const u=document.getElementById(`repeat-${h}`).getContext("2d");u.imageSmoothingEnabled=!1,u.lineWidth=.01*r,u.resetTransform(),u.translate(-.5,-.5);const p=n[h].bitmap;for(let g=0;g<p.height;g++)for(let y=0;y<p.width;y++){let v=p.pixel(y,g);if(a[h].bitmap==null||a[h].bitmap.pixel(y,g)!=v){const x=i[v];u.save(),u.translate(y*t,g*t),u.scale(t,t),u.clearRect(0,0,1,1),Ei[x]?(u.fillStyle="#fff",u.strokeStyle="#000"):(u.fillStyle="#000",u.strokeStyle="#fff"),u.fillRect(0,0,1,1),u.stroke(hn[x]),u.restore()}}a[h].bitmap=p}function c(){a=n.map(h=>({bitmap:null,pos:[...h.pos]}));for(let h=0;h<n.length;h++)s(h,n[h].bitmap.width,n[h].bitmap.height),l(h),o(h)}return{syncState(h){if(n=h.repeats,a.length!=n.length&&c(),r!=h.symbolLineWidth&&(r=h.symbolLineWidth,ai(a)),t!=h.scale){t=h.scale,ai(a);for(let u=0;u<n.length;u++)s(u,n[u].bitmap.width,n[u].bitmap.height),o(u)}for(let u=0;u<n.length;u++){let p=n[u];(a[u].bitmap==null||p.bitmap.width!=a[u].bitmap.width||p.bitmap.height!=a[u].bitmap.height)&&(s(u,n[u].bitmap.width,n[u].bitmap.height),o(u),a[u].bitmap=null),a[u].bitmap!=p.bitmap&&l(u)}}}}}const oi={a:()=>console.log("select all?"),z:()=>ki(),s:()=>w({showDownload:!0})},li={...Object.fromEntries(Object.entries(Si).map(([e,t])=>[t.hotkey,()=>w({activeTool:e})])),g:()=>w({grid:!d.grid}),Escape:()=>w({showLibrary:!1,showSettings:!1,showDownload:!1,showRepeatLibrary:!1}),d:()=>w({debug:!d.debug})};function Oc(e){e<=d.symbolMap.length&&w({activeSymbol:e})}function Wc(){window.addEventListener("keydown",e=>{e.ctrlKey&&e.key.toLowerCase()in oi?(e.preventDefault(),oi[e.key.toLowerCase()]()):e.key in li?li[e.key]():/^[0-9]$/i.test(e.key)&&Oc(Number(e.key)-1);const t=new Set(d.heldKeys);t.add(e.key),w({heldKeys:t})}),window.addEventListener("keyup",e=>{const t=new Set(d.heldKeys);t.delete(e.key),w({heldKeys:t})})}function qc(e,t){const i={x:e.clientX,y:e.clientY},n=d.chartPan;function r(s){if(s.buttons==0)a();else{const o=i.x-s.clientX,l=i.y-s.clientY;w({chartPan:{x:n.x-o,y:n.y-l}})}}function a(){t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",a),t.removeEventListener("pointerleave",a)}t.addEventListener("pointermove",r),t.addEventListener("pointerup",a),t.addEventListener("pointerleave",a)}function Yc(e){e.addEventListener("pointerdown",t=>{(t.target==e||t.target.id=="symbol-canvas")&&qc(t,e)}),e.addEventListener("pointermove",t=>{const{x:i,y:n}=bt(t,e);(d.pos.x!=i||d.pos.y!=n)&&w({pos:{x:i,y:n}})}),e.addEventListener("pointerleave",t=>{w({pos:{x:-1,y:-1}})}),e.addEventListener("wheel",t=>{const i=e.getBoundingClientRect();let n;Math.sign(t.deltaY)<0?n=d.reverseScroll?d.scale-1:d.scale+1:n=d.reverseScroll?d.scale+1:d.scale-1,$i({x:t.clientX-i.left,y:t.clientY-i.top},n)})}function Gc(e,t){let i=be(e,t);w({yarnSequence:d.yarnSequence.brush({x:i.x,y:i.y},d.activeYarn)});function n(a){let s=be(a,t);if(s.x==i.x&&s.y==i.y)return;const o=d.yarnSequence.line({x:i.x,y:i.y},{x:s.x,y:s.y},d.activeYarn);w({yarnSequence:o}),i=s}function r(){w({transforming:!1}),t.removeEventListener("pointermove",n),t.removeEventListener("pointerup",r),t.removeEventListener("pointerleave",r)}t.addEventListener("pointermove",n),t.addEventListener("pointerup",r),t.addEventListener("pointerleave",r)}function Xc(e){const t=d.yarnSequence,i=e.clientY;document.body.classList.add("grabbing"),e.target.classList.remove("grab");function n(){document.body.classList.remove("grabbing"),w({transforming:!1}),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",n),e.target.classList.add("grab")}function r(a){let s=t.height+Math.floor((i-a.clientY)/d.scale*devicePixelRatio);s<1||s==d.yarnSequence.height||w({yarnSequence:t.resize(1,s,d.activeYarn)})}window.addEventListener("pointermove",r),window.addEventListener("pointerup",n)}function Uc(e,t){e.addEventListener("pointerdown",i=>{w({transforming:!0}),Gc(i,e)}),t.addEventListener("pointerdown",i=>{w({transforming:!0}),Xc(i)})}function Kc(e){for(e=e.parentNode;e;){if(e.hasAttribute("data-repeatindex"))return Number(e.dataset.repeatindex);e=e.parentNode}return null}function Jc(e,t,i){let n=d.repeatPos;w({transforming:!0});let r=i(e,n);if(!r)return;function a(o){if(o.buttons==0)s();else{let l=d.repeatPos;if(l.x==n.x&&l.y==n.y)return;r(l),n=l}}function s(){w({transforming:!1}),t.removeEventListener("pointermove",a),t.removeEventListener("pointerup",s),t.removeEventListener("pointerleave",s)}t.addEventListener("pointermove",a),t.addEventListener("pointerup",s),t.addEventListener("pointerleave",s)}function Zc(e,t){const i=d.repeats[t],n=[e.clientX,e.clientY],r=e.target;w({transforming:!0}),document.body.classList.add("grabbing"),r.classList.remove("grab");const a=()=>{w({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",a),r.classList.add("grab")},s=o=>{let l=i.bitmap.width-Math.floor((n[0]-o.clientX)/(d.scale/devicePixelRatio)),c=i.bitmap.height+Math.floor((n[1]-o.clientY)/(d.scale/devicePixelRatio));if(c<1||l<1)return;let h=[...i.pos];l+i.pos[0]<1&&(h[0]=-l+1),c+i.pos[1]<1&&(h[1]=-c+1);let u=[l>i.area[0]?l:i.area[0],c>i.area[1]?c:i.area[1]];w({repeats:[...d.repeats.slice(0,t),{...d.repeats[t],bitmap:i.bitmap.vFlip().resize(l,c).vFlip(),pos:h,area:u},...d.repeats.slice(t+1)]})};window.addEventListener("pointermove",s),window.addEventListener("pointerup",a)}function ci(e,t,i){let n=d.repeats[t];const r=i=="x"?n.area[0]:n.area[1],a=[e.clientX,e.clientY],s=e.target;w({transforming:!0}),document.body.classList.add("grabbing"),s.classList.remove("grab");const o=()=>{w({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",o),s.classList.add("grab")},l=c=>{let h,u;i=="x"?(h=r-Math.floor((a[0]-c.clientX)/(d.scale/devicePixelRatio)),h=h<n.bitmap.width?n.bitmap.width:h,u={...n,area:[h,d.repeats[t].area[1]]}):(h=r+Math.floor((a[1]-c.clientY)/(d.scale/devicePixelRatio)),h=h<n.bitmap.height?n.bitmap.height:h,u={...d.repeats[t],area:[d.repeats[t].area[0],h]}),w({repeats:[...d.repeats.slice(0,t),u,...d.repeats.slice(t+1)]})};window.addEventListener("pointermove",l),window.addEventListener("pointerup",o)}function Qc(e){e.addEventListener("pointerdown",t=>{const i=Kc(t.target);let n=t.target.classList;if(n.contains("resize-repeat"))Zc(t,i);else if(n.contains("repeat-area-dragger"))n.contains("x-axis")?ci(t,i,"x"):ci(t,i,"y");else if(n.contains("repeat-canvas")){const r=d.activeTool;r in te?Jc(i,t.target,te[r]):console.warn(`Uh oh, ${r} is not a tool`)}}),e.addEventListener("pointermove",t=>{if(d.editingRepeat<0){const{x:i,y:n}=bt(t,e);(d.pos.x!=i||d.pos.y!=n)&&w({pos:{x:i,y:n}})}else{const{x:i,y:n}=bt(t,t.target);(d.pos.x!=i||d.pos.y!=n)&&w({repeatPos:{x:i,y:n}})}})}function jc(e,t){const i={x:e.clientX,y:e.clientY},n=d.simPan;function r(s){if(s.buttons==0)a();else{const o=i.x-s.clientX,l=i.y-s.clientY;w({simPan:{x:n.x-o,y:n.y-l}})}}function a(){t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",a),t.removeEventListener("pointerleave",a)}t.addEventListener("pointermove",r),t.addEventListener("pointerup",a),t.addEventListener("pointerleave",a)}function th(e){e.addEventListener("wheel",t=>{let i;const n=e.getBoundingClientRect();Math.sign(t.deltaY)<0?i=d.reverseScroll?d.simScale*.9:d.simScale*1.1:i=d.reverseScroll?d.simScale*1.1:d.simScale*.9,Ci({x:(t.clientX-n.left)/2,y:(t.clientY-n.top)/2},i)}),e.addEventListener("pointerdown",t=>{jc(t,e)})}function eh(e){function t(i,n){const r={x:i.touches[0].clientX,y:i.touches[0].clientY},a=d.chartPan;function s(l){const c=r.x-l.touches[0].clientX,h=r.y-l.touches[0].clientY;w({chartPan:{x:a.x-c,y:a.y-h}})}function o(){n.removeEventListener("touchmove",s),n.removeEventListener("touchcancel",o),n.removeEventListener("touchend",o)}n.addEventListener("touchmove",s),n.addEventListener("touchcancel",o),n.addEventListener("touchend",o)}e.addEventListener("touchstart",i=>{const{x:n,y:r}=bt(i.touches[0],e);(d.pos.x!=n||d.pos.y!=r)&&w({pos:{x:n,y:r}}),(i.target.id=="symbol-canvas"||i.target.id=="desktop")&&t(i,e)}),e.addEventListener("touchmove",i=>{const{x:n,y:r}=bt(i,e);(d.pos.x!=n||d.pos.y!=r)&&w({pos:{x:n,y:r}})}),e.addEventListener("touchmove",i=>{const{x:n,y:r}=bt(i.touches[0],e);(d.pos.x!=n||d.pos.y!=r)&&w({pos:{x:n,y:r}})}),e.addEventListener("touchend",i=>{w({pos:{x:-1,y:-1}})}),e.addEventListener("touchcancel",i=>{w({pos:{x:-1,y:-1}})})}function nh(e,t){let i=be(e.touches[0],t);w({yarnSequence:d.yarnSequence.brush({x:i.x,y:i.y},d.activeYarn)});function n(a){let s=be(a.touches[0],t);if(s.x==i.x&&s.y==i.y)return;const o=d.yarnSequence.line({x:i.x,y:i.y},{x:s.x,y:s.y},d.activeYarn);w({yarnSequence:o}),i=s}function r(){w({transforming:!1}),t.removeEventListener("touchmove",n),t.removeEventListener("touchcancel",r),t.removeEventListener("touchend",r)}t.addEventListener("touchmove",n),t.addEventListener("touchcancel",r),t.addEventListener("touchend",r)}function ih(e){const t=d.yarnSequence,i=e.touches[0].clientY,n=()=>{w({transforming:!1}),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",n),window.removeEventListener("touchcancel",n)},r=a=>{let s=t.height+Math.floor((i-a.touches[0].clientY)/d.scale*devicePixelRatio);s<1||s==t.height||w({yarnSequence:t.resize(1,s,d.activeYarn)})};window.addEventListener("touchmove",r),window.addEventListener("touchend",n),window.addEventListener("touchcancel",n)}function rh(e,t){e.addEventListener("touchstart",i=>{w({transforming:!0}),nh(i,e)}),t.addEventListener("touchstart",i=>{w({transforming:!0}),ih(i)})}function sh(e){for(e=e.parentNode;e;){if(e.hasAttribute("data-repeatindex"))return Number(e.dataset.repeatindex);e=e.parentNode}return null}function ah(e,t,i){let n=d.repeatPos;w({transforming:!0});let r=i(e,n);if(!r)return;function a(){let o=d.repeatPos;o.x==n.x&&o.y==n.y||(r(o),n=o)}function s(){w({transforming:!1}),t.removeEventListener("touchmove",a),t.removeEventListener("touchend",s),t.removeEventListener("touchcancel",s)}t.addEventListener("touchmove",a),t.addEventListener("touchend",s),t.addEventListener("touchcancel",s)}function oh(e,t){const i=d.repeats[t],n=[e.clientX,e.clientY],r=e.target;w({transforming:!0}),document.body.classList.add("grabbing"),r.classList.remove("grab");const a=()=>{w({transforming:!1}),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},s=o=>{let l=i.bitmap.width-Math.floor((n[0]-o.touches[0].clientX)/(d.scale/devicePixelRatio)),c=i.bitmap.height+Math.floor((n[1]-o.touches[0].clientY)/(d.scale/devicePixelRatio));if(c==i.height&&l==i.width||c<1||l<1)return;let h=[...i.pos];l+i.pos[0]<1&&(h[0]=-l+1),c+i.pos[1]<1&&(h[1]=-c+1);let u=[l>i.area[0]?l:i.area[0],c>i.area[1]?c:i.area[1]];w({repeats:[...d.repeats.slice(0,t),{...d.repeats[t],bitmap:i.bitmap.vFlip().resize(l,c).vFlip(),pos:h,area:u},...d.repeats.slice(t+1)]})};window.addEventListener("touchmove",s),window.addEventListener("touchcancel",a),window.addEventListener("touchend",a)}function lh(e,t){let i=d.repeats[t];const n=[...d.repeats[t].pos],r=[e.clientX,e.clientY];console.log(r),w({transforming:!0});const a=()=>{w({transforming:!1}),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},s=o=>{let l=n[0]-Math.floor((r[0]-o.touches[0].clientX)/(d.scale/devicePixelRatio)),c=n[1]+Math.floor((r[1]-o.touches[0].clientY)/(d.scale/devicePixelRatio));l=l<-(i.bitmap.width-1)?-(i.bitmap.width-1):l,c=c<-(i.bitmap.height-1)?-(i.bitmap.height-1):c,l=l>d.chart.width-1?d.chart.width-1:l,c=c>d.chart.height-1?d.chart.height-1:c,w({repeats:[...d.repeats.slice(0,t),{...i,pos:[l,c]},...d.repeats.slice(t+1)]})};window.addEventListener("touchmove",s),window.addEventListener("touchcancel",a),window.addEventListener("touchend",a)}function hi(e,t){if(d.editingRepeat<0){const{x:i,y:n}=bt(e,t);(d.pos.x!=i||d.pos.y!=n)&&w({pos:{x:i,y:n}})}else{const{x:i,y:n}=bt(e,e.target);(d.pos.x!=i||d.pos.y!=n)&&w({repeatPos:{x:i,y:n}})}}function ui(e,t,i){let n=d.repeats[t];const r=i=="x"?n.area[0]:n.area[1],a=[e.clientX,e.clientY];w({transforming:!0});const s=()=>{w({transforming:!1}),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},o=l=>{let c,h;i=="x"?(c=r-Math.floor((a[0]-l.touches[0].clientX)/(d.scale/devicePixelRatio)),c=c<n.bitmap.width?n.bitmap.width:c,h={...d.repeats[t],area:[c,d.repeats[t].area[1]]}):(c=r+Math.floor((a[1]-l.touches[0].clientY)/(d.scale/devicePixelRatio)),c=c<n.bitmap.height?n.bitmap.height:c,h={...d.repeats[t],area:[d.repeats[t].area[0],c]}),w({repeats:[...d.repeats.slice(0,t),h,...d.repeats.slice(t+1)]})};window.addEventListener("touchmove",o),window.addEventListener("touchcancel",s),window.addEventListener("touchend",s)}function ch(e){e.addEventListener("touchstart",t=>{hi(t.touches[0],e);const i=sh(t.target);let n=t.target.classList;if(d.editingRepeat!=i&&n.contains("repeat-canvas")){w({editingRepeat:i});return}if(n.contains("resize-repeat"))oh(t.touches[0],i);else if(n.contains("repeat-area-dragger"))n.contains("x-axis")?ui(t.touches[0],i,"x"):ui(t.touches[0],i,"y");else if(n.contains("repeat-canvas")){const r=d.activeTool;r in te?ah(i,t.target,te[r]):r=="move"?lh(t.touches[0],i):console.console.warn(`Uh oh, ${r} is not a tool`)}}),e.addEventListener("touchmove",t=>{hi(t.touches[0],e)})}function hh(e,t){const i={x:e.clientX,y:e.clientY},n=d.simPan;function r(s){const o=i.x-s.touches[0].clientX,l=i.y-s.touches[0].clientY;w({simPan:{x:n.x-o,y:n.y-l}})}function a(){t.removeEventListener("touchmove",r),t.removeEventListener("touchcancel",a),t.removeEventListener("touchend",a)}t.addEventListener("touchmove",r),t.addEventListener("touchcancel",a),t.addEventListener("touchend",a)}function uh(e){e.addEventListener("touchstart",t=>{hh(t.touches[0],e)})}function dh(e){return({state:t})=>{let{symbolMap:i,symbolLineWidth:n}=t;function r(){i.forEach(a=>{const s=document.querySelector(`[data-symbol=${a}]`);if(!s)return;s.width=50,s.height=50;const o=s.getContext("2d");o.scale(50,50),o.imageSmoothingEnabled=!1,o.lineWidth=.01*n,o.stroke(hn[a])})}return r(),{syncState(a){n!=a.symbolLineWidth&&(n=a.symbolLineWidth,r())}}}}function fh(e,t,i,n){e.width=n*t,e.height=n*i,e.style.width=`${n*t/devicePixelRatio}px`,e.style.height=`${n*i/devicePixelRatio}px`}function ph(e){return({state:t})=>{let{scale:i,chart:n}=t,r=n.width,a=n.height;function s(){e.forEach(o=>{fh(o,r,a,i)})}return{syncState(o){(r!=o.chart.width||a!=o.chart.height||i!=o.scale)&&(r=o.chart.width,a=o.chart.height,i=o.scale,s())}}}}function cr(){document.getElementById("site").addEventListener("pointerdown",e=>{w({showLibrary:!1,showSettings:!1,showDownload:!1})})}function gh(){return({state:e})=>{let{repeats:t}=e,i=e.chart.width,n=e.chart.height;function r(){let a=O.empty(d.chart.width,d.chart.height,0);for(const s of t){let o=O.fromTile(d.chart.width,d.chart.height,s.bitmap.vFlip()).vFlip();a=a.overlay(o,s.pos)}w({chart:a})}return r(),{syncState(a){(t!=a.repeats||i!=a.chart.width||n!=a.chart.height)&&(t=a.repeats,i=a.chart.width,n=a.chart.height,r())}}}}let Ge,Xe,Ue,_n,En,Pe,Sn,kn;function hr(){xr(zc(),document.body),window.requestAnimationFrame(hr)}function vh(){Wc(),Yc(_n),Qc(En),Uc(Pe,Sn),th(kn),cr()}function mh(){document.body.style.setProperty("--font-size","1.1rem"),eh(_n),ch(En),rh(Pe,Sn),uh(kn),cr()}function ur(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`),document.documentElement.style.setProperty("--vw",`${window.innerWidth*.01}px`)}function yh(){hr(),Ge=document.getElementById("symbol-canvas"),Xe=document.getElementById("grid"),Ue=document.getElementById("yarn-color-canvas"),Pe=document.getElementById("yarn-sequence-canvas"),_n=document.getElementById("desktop"),En=document.getElementById("repeat-container"),kn=document.getElementById("sim-container"),document.getElementById("repeat-library"),Sn=document.getElementById("color-dragger"),Cr(["#chart-pane","#sim-pane"],{sizes:[60,40],minSize:100,gutterSize:11}),Dr()?mh():vh(),un.register([ph([Ge,Xe,Ue]),Ic({canvas:Pe}),Hc(Ge),Dc(Ue),Fc(Xe),Vc(),dh(),Tc(),gh()]),ur(),Dt()}window.onload=yh;window.onresize=ur;
