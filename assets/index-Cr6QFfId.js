(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ze=globalThis,je=ze.trustedTypes,zt=je?je.createPolicy("lit-html",{createHTML:i=>i}):void 0,ln="$lit$",he=`lit$${Math.random().toFixed(9).slice(2)}$`,cn="?"+he,qn=`<${cn}>`,ve=document,Ne=()=>ve.createComment(""),Ie=i=>i===null||typeof i!="object"&&typeof i!="function",kt=Array.isArray,Gn=i=>kt(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",st=`[ 	
\f\r]`,Ce=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Nt=/-->/g,It=/>/g,de=RegExp(`>|${st}(?:([^\\s"'>=/]+)(${st}*=${st}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Dt=/'/g,Ht=/"/g,hn=/^(?:script|style|textarea|title)$/i,un=i=>(t,...r)=>({_$litType$:i,strings:t,values:r}),V=un(1),Yn=un(2),De=Symbol.for("lit-noChange"),Y=Symbol.for("lit-nothing"),Vt=new WeakMap,ge=ve.createTreeWalker(ve,129);function dn(i,t){if(!kt(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return zt!==void 0?zt.createHTML(t):t}const Un=(i,t)=>{const r=i.length-1,e=[];let n,s=t===2?"<svg>":t===3?"<math>":"",a=Ce;for(let o=0;o<r;o++){const l=i[o];let u,d,p=-1,f=0;for(;f<l.length&&(a.lastIndex=f,d=a.exec(l),d!==null);)f=a.lastIndex,a===Ce?d[1]==="!--"?a=Nt:d[1]!==void 0?a=It:d[2]!==void 0?(hn.test(d[2])&&(n=RegExp("</"+d[2],"g")),a=de):d[3]!==void 0&&(a=de):a===de?d[0]===">"?(a=n??Ce,p=-1):d[1]===void 0?p=-2:(p=a.lastIndex-d[2].length,u=d[1],a=d[3]===void 0?de:d[3]==='"'?Ht:Dt):a===Ht||a===Dt?a=de:a===Nt||a===It?a=Ce:(a=de,n=void 0);const S=a===de&&i[o+1].startsWith("/>")?" ":"";s+=a===Ce?l+qn:p>=0?(e.push(u),l.slice(0,p)+ln+l.slice(p)+he+S):l+he+(p===-2?o:S)}return[dn(i,s+(i[r]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),e]};class He{constructor({strings:t,_$litType$:r},e){let n;this.parts=[];let s=0,a=0;const o=t.length-1,l=this.parts,[u,d]=Un(t,r);if(this.el=He.createElement(u,e),ge.currentNode=this.el.content,r===2||r===3){const p=this.el.content.firstChild;p.replaceWith(...p.childNodes)}for(;(n=ge.nextNode())!==null&&l.length<o;){if(n.nodeType===1){if(n.hasAttributes())for(const p of n.getAttributeNames())if(p.endsWith(ln)){const f=d[a++],S=n.getAttribute(p).split(he),x=/([.?@])?(.*)/.exec(f);l.push({type:1,index:s,name:x[2],strings:S,ctor:x[1]==="."?Kn:x[1]==="?"?jn:x[1]==="@"?Jn:it}),n.removeAttribute(p)}else p.startsWith(he)&&(l.push({type:6,index:s}),n.removeAttribute(p));if(hn.test(n.tagName)){const p=n.textContent.split(he),f=p.length-1;if(f>0){n.textContent=je?je.emptyScript:"";for(let S=0;S<f;S++)n.append(p[S],Ne()),ge.nextNode(),l.push({type:2,index:++s});n.append(p[f],Ne())}}}else if(n.nodeType===8)if(n.data===cn)l.push({type:2,index:s});else{let p=-1;for(;(p=n.data.indexOf(he,p+1))!==-1;)l.push({type:7,index:s}),p+=he.length-1}s++}}static createElement(t,r){const e=ve.createElement("template");return e.innerHTML=t,e}}function Ee(i,t,r=i,e){var a,o;if(t===De)return t;let n=e!==void 0?(a=r.o)==null?void 0:a[e]:r.l;const s=Ie(t)?void 0:t._$litDirective$;return(n==null?void 0:n.constructor)!==s&&((o=n==null?void 0:n._$AO)==null||o.call(n,!1),s===void 0?n=void 0:(n=new s(i),n._$AT(i,r,e)),e!==void 0?(r.o??(r.o=[]))[e]=n:r.l=n),n!==void 0&&(t=Ee(i,n._$AS(i,t.values),n,e)),t}class Xn{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:r},parts:e}=this._$AD,n=((t==null?void 0:t.creationScope)??ve).importNode(r,!0);ge.currentNode=n;let s=ge.nextNode(),a=0,o=0,l=e[0];for(;l!==void 0;){if(a===l.index){let u;l.type===2?u=new We(s,s.nextSibling,this,t):l.type===1?u=new l.ctor(s,l.name,l.strings,this,t):l.type===6&&(u=new Zn(s,this,t)),this._$AV.push(u),l=e[++o]}a!==(l==null?void 0:l.index)&&(s=ge.nextNode(),a++)}return ge.currentNode=ve,n}p(t){let r=0;for(const e of this._$AV)e!==void 0&&(e.strings!==void 0?(e._$AI(t,e,r),r+=e.strings.length-2):e._$AI(t[r])),r++}}class We{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this.v}constructor(t,r,e,n){this.type=2,this._$AH=Y,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=e,this.options=n,this.v=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=Ee(this,t,r),Ie(t)?t===Y||t==null||t===""?(this._$AH!==Y&&this._$AR(),this._$AH=Y):t!==this._$AH&&t!==De&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Gn(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Y&&Ie(this._$AH)?this._$AA.nextSibling.data=t:this.T(ve.createTextNode(t)),this._$AH=t}$(t){var s;const{values:r,_$litType$:e}=t,n=typeof e=="number"?this._$AC(t):(e.el===void 0&&(e.el=He.createElement(dn(e.h,e.h[0]),this.options)),e);if(((s=this._$AH)==null?void 0:s._$AD)===n)this._$AH.p(r);else{const a=new Xn(n,this),o=a.u(this.options);a.p(r),this.T(o),this._$AH=a}}_$AC(t){let r=Vt.get(t.strings);return r===void 0&&Vt.set(t.strings,r=new He(t)),r}k(t){kt(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let e,n=0;for(const s of t)n===r.length?r.push(e=new We(this.O(Ne()),this.O(Ne()),this,this.options)):e=r[n],e._$AI(s),n++;n<r.length&&(this._$AR(e&&e._$AB.nextSibling,n),r.length=n)}_$AR(t=this._$AA.nextSibling,r){var e;for((e=this._$AP)==null?void 0:e.call(this,!1,!0,r);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var r;this._$AM===void 0&&(this.v=t,(r=this._$AP)==null||r.call(this,t))}}class it{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,r,e,n,s){this.type=1,this._$AH=Y,this._$AN=void 0,this.element=t,this.name=r,this._$AM=n,this.options=s,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=Y}_$AI(t,r=this,e,n){const s=this.strings;let a=!1;if(s===void 0)t=Ee(this,t,r,0),a=!Ie(t)||t!==this._$AH&&t!==De,a&&(this._$AH=t);else{const o=t;let l,u;for(t=s[0],l=0;l<s.length-1;l++)u=Ee(this,o[e+l],r,l),u===De&&(u=this._$AH[l]),a||(a=!Ie(u)||u!==this._$AH[l]),u===Y?t=Y:t!==Y&&(t+=(u??"")+s[l+1]),this._$AH[l]=u}a&&!n&&this.j(t)}j(t){t===Y?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Kn extends it{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Y?void 0:t}}class jn extends it{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Y)}}class Jn extends it{constructor(t,r,e,n,s){super(t,r,e,n,s),this.type=5}_$AI(t,r=this){if((t=Ee(this,t,r,0)??Y)===De)return;const e=this._$AH,n=t===Y&&e!==Y||t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive,s=t!==Y&&(e===Y||n);n&&this.element.removeEventListener(this.name,this,e),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var r;typeof this._$AH=="function"?this._$AH.call(((r=this.options)==null?void 0:r.host)??this.element,t):this._$AH.handleEvent(t)}}class Zn{constructor(t,r,e){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(t){Ee(this,t)}}const ot=ze.litHtmlPolyfillSupport;ot==null||ot(He,We),(ze.litHtmlVersions??(ze.litHtmlVersions=[])).push("3.2.0");const Qn=(i,t,r)=>{const e=t;let n=e._$litPart$;return n===void 0&&(e._$litPart$=n=new We(t.insertBefore(Ne(),null),null,void 0,{})),n._$AI(i),n};var Q=typeof window<"u"?window:null,Pt=Q===null,Ve=Pt?void 0:Q.document,te="addEventListener",ne="removeEventListener",lt="getBoundingClientRect",$e="_a",ie="_b",se="_c",Ye="horizontal",re=function(){return!1},ei=Pt?"calc":["","-webkit-","-moz-","-o-"].filter(function(i){var t=Ve.createElement("div");return t.style.cssText="width:"+i+"calc(9px)",!!t.style.length}).shift()+"calc",pn=function(i){return typeof i=="string"||i instanceof String},Ot=function(i){if(pn(i)){var t=Ve.querySelector(i);if(!t)throw new Error("Selector "+i+" did not match a DOM element");return t}return i},K=function(i,t,r){var e=i[t];return e!==void 0?e:r},Ue=function(i,t,r,e){if(t){if(e==="end")return 0;if(e==="center")return i/2}else if(r){if(e==="start")return 0;if(e==="center")return i/2}return i},ti=function(i,t){var r=Ve.createElement("div");return r.className="gutter gutter-"+t,r},ni=function(i,t,r){var e={};return pn(t)?e[i]=t:e[i]=ei+"("+t+"% - "+r+"px)",e},ii=function(i,t){var r;return r={},r[i]=t+"px",r},ri=function(i,t){if(t===void 0&&(t={}),Pt)return{};var r=i,e,n,s,a,o,l;Array.from&&(r=Array.from(r));var u=Ot(r[0]),d=u.parentNode,p=getComputedStyle?getComputedStyle(d):null,f=p?p.flexDirection:null,S=K(t,"sizes")||r.map(function(){return 100/r.length}),x=K(t,"minSize",100),v=Array.isArray(x)?x:r.map(function(){return x}),w=K(t,"maxSize",1/0),$=Array.isArray(w)?w:r.map(function(){return w}),M=K(t,"expandToMin",!1),z=K(t,"gutterSize",10),R=K(t,"gutterAlign","center"),T=K(t,"snapOffset",30),O=Array.isArray(T)?T:r.map(function(){return T}),W=K(t,"dragInterval",1),D=K(t,"direction",Ye),H=K(t,"cursor",D===Ye?"col-resize":"row-resize"),U=K(t,"gutter",ti),be=K(t,"elementStyle",ni),Pe=K(t,"gutterStyle",ii);D===Ye?(e="width",n="clientX",s="left",a="right",o="clientWidth"):D==="vertical"&&(e="height",n="clientY",s="top",a="bottom",o="clientHeight");function ae(k,g,_,C){var N=be(e,g,_,C);Object.keys(N).forEach(function(q){k.style[q]=N[q]})}function le(k,g,_){var C=Pe(e,g,_);Object.keys(C).forEach(function(N){k.style[N]=C[N]})}function Z(){return l.map(function(k){return k.size})}function ce(k){return"touches"in k?k.touches[0][n]:k[n]}function h(k){var g=l[this.a],_=l[this.b],C=g.size+_.size;g.size=k/this.size*C,_.size=C-k/this.size*C,ae(g.element,g.size,this[ie],g.i),ae(_.element,_.size,this[se],_.i)}function y(k){var g,_=l[this.a],C=l[this.b];this.dragging&&(g=ce(k)-this.start+(this[ie]-this.dragOffset),W>1&&(g=Math.round(g/W)*W),g<=_.minSize+_.snapOffset+this[ie]?g=_.minSize+this[ie]:g>=this.size-(C.minSize+C.snapOffset+this[se])&&(g=this.size-(C.minSize+this[se])),g>=_.maxSize-_.snapOffset+this[ie]?g=_.maxSize+this[ie]:g<=this.size-(C.maxSize-C.snapOffset+this[se])&&(g=this.size-(C.maxSize+this[se])),h.call(this,g),K(t,"onDrag",re)(Z()))}function P(){var k=l[this.a].element,g=l[this.b].element,_=k[lt](),C=g[lt]();this.size=_[e]+C[e]+this[ie]+this[se],this.start=_[s],this.end=_[a]}function E(k){if(!getComputedStyle)return null;var g=getComputedStyle(k);if(!g)return null;var _=k[o];return _===0?null:(D===Ye?_-=parseFloat(g.paddingLeft)+parseFloat(g.paddingRight):_-=parseFloat(g.paddingTop)+parseFloat(g.paddingBottom),_)}function L(k){var g=E(d);if(g===null||v.reduce(function(q,X){return q+X},0)>g)return k;var _=0,C=[],N=k.map(function(q,X){var J=g*q/100,we=Ue(z,X===0,X===k.length-1,R),Ge=v[X]+we;return J<Ge?(_+=Ge-J,C.push(0),Ge):(C.push(J-Ge),J)});return _===0?k:N.map(function(q,X){var J=q;if(_>0&&C[X]-_>0){var we=Math.min(_,C[X]-_);_-=we,J=q-we}return J/g*100})}function B(){var k=this,g=l[k.a].element,_=l[k.b].element;k.dragging&&K(t,"onDragEnd",re)(Z()),k.dragging=!1,Q[ne]("mouseup",k.stop),Q[ne]("touchend",k.stop),Q[ne]("touchcancel",k.stop),Q[ne]("mousemove",k.move),Q[ne]("touchmove",k.move),k.stop=null,k.move=null,g[ne]("selectstart",re),g[ne]("dragstart",re),_[ne]("selectstart",re),_[ne]("dragstart",re),g.style.userSelect="",g.style.webkitUserSelect="",g.style.MozUserSelect="",g.style.pointerEvents="",_.style.userSelect="",_.style.webkitUserSelect="",_.style.MozUserSelect="",_.style.pointerEvents="",k.gutter.style.cursor="",k.parent.style.cursor="",Ve.body.style.cursor=""}function b(k){if(!("button"in k&&k.button!==0)){var g=this,_=l[g.a].element,C=l[g.b].element;g.dragging||K(t,"onDragStart",re)(Z()),k.preventDefault(),g.dragging=!0,g.move=y.bind(g),g.stop=B.bind(g),Q[te]("mouseup",g.stop),Q[te]("touchend",g.stop),Q[te]("touchcancel",g.stop),Q[te]("mousemove",g.move),Q[te]("touchmove",g.move),_[te]("selectstart",re),_[te]("dragstart",re),C[te]("selectstart",re),C[te]("dragstart",re),_.style.userSelect="none",_.style.webkitUserSelect="none",_.style.MozUserSelect="none",_.style.pointerEvents="none",C.style.userSelect="none",C.style.webkitUserSelect="none",C.style.MozUserSelect="none",C.style.pointerEvents="none",g.gutter.style.cursor=H,g.parent.style.cursor=H,Ve.body.style.cursor=H,P.call(g),g.dragOffset=ce(k)-g.end}}S=L(S);var A=[];l=r.map(function(k,g){var _={element:Ot(k),size:S[g],minSize:v[g],maxSize:$[g],snapOffset:O[g],i:g},C;if(g>0&&(C={a:g-1,b:g,dragging:!1,direction:D,parent:d},C[ie]=Ue(z,g-1===0,!1,R),C[se]=Ue(z,!1,g===r.length-1,R),f==="row-reverse"||f==="column-reverse")){var N=C.a;C.a=C.b,C.b=N}if(g>0){var q=U(g,D,_.element);le(q,z,g),C[$e]=b.bind(C),q[te]("mousedown",C[$e]),q[te]("touchstart",C[$e]),d.insertBefore(q,_.element),C.gutter=q}return ae(_.element,_.size,Ue(z,g===0,g===r.length-1,R),g),g>0&&A.push(C),_});function I(k){var g=k.i===A.length,_=g?A[k.i-1]:A[k.i];P.call(_);var C=g?_.size-k.minSize-_[se]:k.minSize+_[ie];h.call(_,C)}l.forEach(function(k){var g=k.element[lt]()[e];g<k.minSize&&(M?I(k):k.minSize=g)});function G(k){var g=L(k);g.forEach(function(_,C){if(C>0){var N=A[C-1],q=l[N.a],X=l[N.b];q.size=g[C-1],X.size=_,ae(q.element,q.size,N[ie],q.i),ae(X.element,X.size,N[se],X.i)}})}function ee(k,g){A.forEach(function(_){if(g!==!0?_.parent.removeChild(_.gutter):(_.gutter[ne]("mousedown",_[$e]),_.gutter[ne]("touchstart",_[$e])),k!==!0){var C=be(e,_.a.size,_[ie]);Object.keys(C).forEach(function(N){l[_.a].element.style[N]="",l[_.b].element.style[N]=""})}})}return{setSizes:G,getSizes:Z,collapse:function(g){I(l[g])},destroy:ee,parent:d,pairs:A}};class F{constructor(t,r,e){this.width=t,this.height=r,this.pixels=new Uint8ClampedArray(e)}static fromJSON(t){return new F(t.width,t.height,t.pixels)}static empty(t,r,e){let n=new Array(t*r).fill(e);return new F(t,r,n)}static fromTile(t,r,e){let n=[];for(let s=0;s<r;s++)for(let a=0;a<t;a++)n.push(e.pixel(a%e.width,s%e.height));return new F(t,r,n)}overlay(t,r){const e=[];for(let n=0;n<t.height;n++)for(let s=0;s<t.width;s++)e.push({x:r[0]+s,y:r[1]+t.height-n-1,color:t.pixel(s,n)});return this.draw(e)}toJSON(){return{pixels:Array.from(this.pixels),width:this.width,height:this.height}}pad(t,r,e){const n=Array(r*(this.width+2*t)).fill(e),s=Array(t).fill(e);let a=this.make2d();return new F(this.width+2*t,this.height+2*r,[...a.reduce((o,l)=>[...o,...s,...l,...s],[...n]),...n])}resize(t,r,e=0){let n=[];for(let s=0;s<r;s++)for(let a=0;a<t;a++)s>=this.height||a>=this.width?n.push(e):n.push(this.pixel(a,s));return new F(t,r,n)}make2d(){let t=Array.from(this.pixels).slice(),r=[];for(;t.length>0;)r.push(t.splice(0,this.width));return r}vMirror(){return new F(this.width,this.height,this.make2d().toReversed().flat())}vFlip(){return new F(this.width,this.height,this.make2d().toReversed().flat())}pixel(t,r){return t>this.width-1||t<0||r>this.height-1||r<0?-1:this.pixels.at(t+r*this.width)}draw(t){let r=this.pixels.slice();for(let{x:e,y:n,color:s}of t)e<0||n<0||e>=this.width||n>=this.height||(r[e+n*this.width]=s);return new F(this.width,this.height,r)}brush({x:t,y:r},e){let n={x:t,y:r,color:e};return this.draw([n])}flood({x:t,y:r},e){const n=this.pixel(t,r);if(n===e)return this.draw([]);const s=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];let a=[{x:t,y:r,color:e}];for(let o=0;o<a.length;o++)for(let{dx:l,dy:u}of s){let d=a[o].x+l,p=a[o].y+u;d>=0&&d<this.width&&p>=0&&p<this.height&&this.pixel(d,p)==n&&!a.some(f=>f.x==d&&f.y==p)&&a.push({x:d,y:p,color:e})}return this.draw(a)}shift(t,r){let e=[];for(let n=0;n<this.height;n++)for(let s=0;s<this.width;s++)e.push({x:(s-t%this.width+this.width)%this.width,y:(n-r%this.height+this.height)%this.height,color:this.pixel(s,n)});return this.draw(e)}rect(t,r,e){let n=Math.min(t.x,r.x),s=Math.min(t.y,r.y),a=Math.max(t.x,r.x),o=Math.max(t.y,r.y),l=[];for(let u=s;u<=o;u++)for(let d=n;d<=a;d++)l.push({x:d,y:u,color:e});return this.draw(l)}line(t,r,e){let n=[];if(Math.abs(t.x-r.x)>Math.abs(t.y-r.y)){t.x>r.x&&([t,r]=[r,t]);let s=(r.y-t.y)/(r.x-t.x);for(let{x:a,y:o}=t;a<=r.x;a++)n.push({x:a,y:Math.round(o),color:e}),o+=s}else{t.y>r.y&&([t,r]=[r,t]);let s=(r.x-t.x)/(r.y-t.y);for(let{x:a,y:o}=t;o<=r.y;o++)n.push({x:Math.round(a),y:o,color:e}),a+=s}return this.draw(n)}}const ai="modulepreload",si=function(i){return"/"+i},Ft={},j=function(t,r,e){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));n=Promise.all(r.map(o=>{if(o=si(o),o in Ft)return;Ft[o]=!0;const l=o.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":ai,l||(d.as="script"),d.crossOrigin="",d.href=o,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((p,f)=>{d.addEventListener("load",p),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})}))}return n.then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},fn=100,gn=5,vn=6,mn=.6,oi=1e3,yn=["yarnPalette","yarnSequence","repeats"],Ct={knit:new Path2D("M 0 0.5 L 0.4 0.5 C 0.7 0.5 0.7 0.2 0.5 0.2 C 0.3 0.2 0.3 0.5 0.6 0.5 L 1 0.5"),purl:new Path2D("M 1 0.5 L 0.6 0.5 C 0.3 0.5 0.3 0.8 0.5 0.8 C 0.7 0.8 0.7 0.5 0.4 0.5 L 0 0.5"),slip:new Path2D("M 0 0.5 L 1 0.5"),tuck:new Path2D("M 0 0.5 L 0.2 0.5 C 0.3 0.5 0.35 0.5 0.4 0.45 C 0.45 0.4 0.4 0.2 0.5 0.2 C 0.6 0.2 0.55 0.4 0.6 0.45 C 0.65 0.5 0.7 0.5 0.8 0.5 L 1 0.5")},bn={knit:!1,purl:!1,slip:!0,tuck:!0},li=[{opName:"knit",color:"#000000",path:new Path2D("M 0 0.5 L 0.4 0.5 C 0.7 0.5 0.7 0.2 0.5 0.2 C 0.3 0.2 0.3 0.5 0.6 0.5 L 1 0.5")},{opName:"purl",color:"#333333",path:new Path2D("M 1 0.5 L 0.6 0.5 C 0.3 0.5 0.3 0.8 0.5 0.8 C 0.7 0.8 0.7 0.5 0.4 0.5 L 0 0.5")},{opName:"slip",color:"#ffffff",path:new Path2D("M 0 0.5 L 1 0.5")},{opName:"tuck",color:"#cccccc",path:new Path2D("M 0 0.5 L 0.2 0.5 C 0.3 0.5 0.35 0.5 0.4 0.45 C 0.45 0.4 0.4 0.2 0.5 0.2 C 0.6 0.2 0.55 0.4 0.6 0.45 C 0.65 0.5 0.7 0.5 0.8 0.5 L 1 0.5")}],ci=["knit","purl","slip","tuck"],hi=Object.assign({"../examples/basketweave.json":()=>j(()=>import("./basketweave-hKyJLA9q.js"),[]),"../examples/beetles.json":()=>j(()=>import("./beetles-BPssPfT6.js"),[]),"../examples/birds.json":()=>j(()=>import("./birds-DmdOULOk.js"),[]),"../examples/ells.json":()=>j(()=>import("./ells-B9mCPQfL.js"),[]),"../examples/hat mosaic.json":()=>j(()=>import("./hat mosaic-BTINFtu1.js"),[]),"../examples/hex quilt.json":()=>j(()=>import("./hex quilt-BsuDD9VA.js"),[]),"../examples/hourglass.json":()=>j(()=>import("./hourglass-CKa4yPZV.js"),[]),"../examples/interblocks.json":()=>j(()=>import("./interblocks-ChFd_WOU.js"),[]),"../examples/pseudoweave.json":()=>j(()=>import("./pseudoweave-DDCG01YT.js"),[]),"../examples/pseudoweave_wool.json":()=>j(()=>import("./pseudoweave_wool-B6meBy1F.js"),[]),"../examples/pyramids (slip).json":()=>j(()=>import("./pyramids (slip)-aGDcl6SJ.js"),[]),"../examples/pyramids (tuck).json":()=>j(()=>import("./pyramids (tuck)-6gPqbf5X.js"),[]),"../examples/scrunched ovals.json":()=>j(()=>import("./scrunched ovals-B1_SnACF.js"),[]),"../examples/squargets.json":()=>j(()=>import("./squargets-BKcsvc1I.js"),[]),"../examples/sunset dots.json":()=>j(()=>import("./sunset dots-DBi8ESHE.js"),[]),"../examples/teardown.json":()=>j(()=>import("./teardown-D2-FWyzY.js"),[])}),wn={brush:{icon:"fa-solid fa-paintbrush",hotkey:"b"},flood:{icon:"fa-solid fa-fill-drip fa-flip-horizontal",hotkey:"f"},rect:{icon:"fa-solid fa-vector-square",hotkey:"r"},line:{icon:"fa-solid fa-minus",hotkey:"l"},shift:{icon:"fa-solid fa-right-left",hotkey:"s"},move:{hotkey:"h"}};let c={editingPalette:!1,transforming:!1,activeTool:"brush",activeSymbol:0,chartBackground:"#ffffff",symbolPalette:{},symbolMap:ci,patternLibrary:hi,scale:15,pos:{x:-1,y:-1},chartPan:{x:0,y:0},simScale:1,simPan:{x:0,y:0},activeYarn:0,yarnPalette:["rgba(16,18,189,1)","rgba(235,233,187,1)","rgba(247,85,0,1)"],yarnSequence:new F(1,8,[1,1,1,1,2,2,0,0]),editingRepeat:0,repeatPos:[-1,-1],repeats:[{bitmap:new F(4,8,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0]),pos:[0,0],area:[48,60]}],repeatLibrary:[{title:"blank",bitmap:new F(2,2,[0,0,0,0])},{title:"checks",bitmap:new F(2,2,[0,2,2,0])},{title:"stripe",bitmap:new F(2,2,[0,2,0,2])}],chart:F.empty(48,60,0),reverseScroll:!1,grid:!0,symbolLineWidth:3,flipped:!1,punchcardMode:!1,machine:"th860",punchVerticalRepeats:5,rows:40,numSides:8,showLibrary:!1,showSettings:!1,showDownload:!1,showRepeatLibrary:!1,debug:!1,snapshots:[],lastSnapshot:0,heldKeys:new Set};function ui(i){if(!(c.lastSnapshot<Date.now()-oi))return!1;for(const t of yn)if(t in i)return!0;return!1}function di(i){return c={...c,...i,snapshots:[Object.fromEntries(yn.map(t=>[t,c[t]])),...c.snapshots],lastSnapshot:Date.now()},c}function pi(i){return c={...c,...i},c}function fi(i){return ui(i)?di(i):pi(i)}function xn(){if(c.snapshots.length<1)return;const i=Object.keys(c.snapshots[0]);c={...c,...c.snapshots[0],lastSnapshot:0,snapshots:c.snapshots.slice(1)},$t.syncState(c,i)}function m(i){const t=Object.keys(i);$t.syncState(fi(i),t)}const $t=(()=>{const i=[];function t(e,n){i.forEach(s=>{s.syncState(e,n)})}function r(e){e.forEach(n=>i.push(n({state:c,dispatch:m})))}return{register:r,syncState:t}})();function gi(i){const t=i.getBoundingClientRect();return{width:t.width*devicePixelRatio,height:t.height*devicePixelRatio}}function Je(i,t){const r=t.getBoundingClientRect(),e=Math.floor((i.clientX-r.x)/c.scale*devicePixelRatio),n=Math.floor((i.clientY-r.y)/c.scale*devicePixelRatio);return{x:e,y:c.yarnSequence.height-n-1}}function ue(i,t){const r=t.getBoundingClientRect(),e=Math.floor((i.clientX-r.x)/c.scale*devicePixelRatio),n=Math.floor((i.clientY-r.y)/c.scale*devicePixelRatio);return{x:e,y:n}}function Ze(){const i="0123456789ABCDEF";let t="#";for(let r=0;r<6;r++)t+=i[Math.floor(Math.random()*16)];return t}function rt(i,t){const r=document.createElement("a");r.setAttribute("href",i),r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove()}function vi(){let i=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0)}(navigator.userAgent||navigator.vendor||window.opera),i}function mi(i){const t=new ImageData(i.width,i.height);for(let r=0;r<i.pixels.length;r++){const e=i.pixels[r],n=yi(li[e].color);t.data[r*4]=n[0],t.data[r*4+1]=n[1],t.data[r*4+2]=n[2],t.data[r*4+3]=255}return t}function yi(i){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function bi(i){return i.sort(()=>Math.random()>.5?1:-1)}function wi(){var i=window.document,t=i.documentElement,r=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,e=i.exitFullscreen||i.mozCancelFullScreen||i.webkitExitFullscreen||i.msExitFullscreen;!i.fullscreenElement&&!i.mozFullScreenElement&&!i.webkitFullscreenElement&&!i.msFullscreenElement?r.call(t):e.call(i)}function ct(i){let t=document.getElementById("desktop").getBoundingClientRect();En({x:t.width/2,y:t.height/2},i)}function ht(i){let t=document.getElementById("sim-container").getBoundingClientRect();_n({x:t.width/2,y:t.height/2},i)}function _n(i,t){if(t<mn||t>vn)return;const r={x:(i.x-c.simPan.x)/c.simScale,y:(i.y-c.simPan.y)/c.simScale};m({simScale:t,simPan:{x:i.x-r.x*t,y:i.y-r.y*t}})}function En(i,t){if(t<gn||t>fn)return;const r={x:(i.x-c.chartPan.x)/c.scale,y:(i.y-c.chartPan.y)/c.scale};m({scale:t,chartPan:{x:i.x-r.x*t,y:i.y-r.y*t}})}function ke(){const{width:i,height:t}=gi(document.getElementById("desktop")),r=Math.floor(.9*Math.min(Math.floor(i/c.chart.width),Math.floor(t/c.chart.height)));m({scale:r,chartPan:{x:(i-r*c.chart.width)/2/devicePixelRatio,y:(t-r*c.chart.height)/2/devicePixelRatio}})}function Qe(i,t,r){i.width=c.scale*t,i.height=c.scale*r,i.style.width=`${c.scale*t/devicePixelRatio}px`,i.style.height=`${c.scale*r/devicePixelRatio}px`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function _e(i,t,r){return i?t(i):r==null?void 0:r(i)}function Sn(i){let{yarnSequence:t,yarnPalette:r,repeats:e,width:n,height:s}=i;m({yarnPalette:r,width:n,height:s,yarnSequence:F.fromJSON(t),chart:F.empty(n,s,0),repeats:e.map(({bitmap:a,pos:o,area:l})=>({bitmap:F.fromJSON(a),pos:o,area:l}))}),ke()}function xi(){m({repeats:[],yarnSequence:new F(1,4,[0,0,1,1]),yarnPalette:[Ze(),Ze()],chart:F.empty(30,40,0),repeats:[{bitmap:new F(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),area:[30,40],pos:[0,0]}]}),ke()}function _i(i){m({showLibrary:!1}),c.patternLibrary[i]().then(t=>Sn(t))}function Ei(){let i=document.createElement("input");i.setAttribute("type","file"),i.style.display="none",document.body.appendChild(i),i.click(),i.onchange=t=>{let r=t.target.files[0];const e=new FileReader;e.readAsText(r),e.onload=()=>{Sn(JSON.parse(e.result))}},document.body.removeChild(i)}function Si(i){i=i>500?500:i,m({chart:c.chart.resize(i,c.chart.height)}),ke()}function ki(i){i=i>500?500:i,m({chart:c.chart.resize(c.chart.width,i)}),ke()}function Pi(){return V`<div id="taskbar">
    <h1 class="site-title">KnitScape-2024</h1>
    <div id="chart-size-controls">
      <label>Width</label>
      <input
        class="input"
        type="number"
        .value=${c.chart.width}
        @change=${i=>Si(Number(i.target.value))}
        min="5"
        max="1000" />
      <label>Height</label>
      <input
        class="input"
        type="number"
        .value=${c.chart.height}
        @change=${i=>ki(Number(i.target.value))}
        min="5"
        max="1000" />
    </div>
    <div class="taskbar-buttons">
      <button class="btn icon" @click=${()=>xn()}>
        <i class="fa-solid fa-rotate-left"></i>
      </button>
      <button class="btn icon" @click=${()=>xi()}>
        <i class="fa-solid fa-file"></i>
      </button>
      <button class="btn icon" @click=${()=>Ei()}>
        <i class="fa-solid fa-upload"></i>
      </button>
      <button class="btn icon" @click=${()=>m({showDownload:!0})}>
        <i class="fa-solid fa-download"></i>
      </button>
      <button
        class="btn icon ${c.showLibrary?"open":""}"
        @click=${()=>m({showLibrary:!c.showLibrary})}>
        <i class="fa-solid fa-book"></i>
      </button>
      <button
        class="btn icon ${c.showSettings?"open":""}"
        @click=${()=>m({showSettings:!c.showSettings})}>
        <i class="fa-solid fa-gear"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>window.open("https://github.com/branchwelder/knitscape")}>
        <i class="fa-brands fa-github"></i>
      </button>

      <button class="btn icon" @click=${()=>wi()}>
        <i
          class="fa-solid fa-${!window.document.fullscreenElement&&!window.document.mozFullScreenElement&&!window.document.webkitFullscreenElement&&!window.document.msFullscreenElement?"up-right-and-down-left-from-center":"down-left-and-up-right-to-center"}"></i>
      </button>
    </div>
  </div>`}function Ci(){const i=document.getElementById("punchcard");let r=new XMLSerializer().serializeToString(i);r.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(r=r.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),r.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(r=r.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),r=`<?xml version="1.0" standalone="no"?>\r
`+r,rt("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r),"punchcard.svg")}function $i(){const i=`SilverKnit
`+c.repeats[0].bitmap.make2d().map(t=>t.map(r=>r==0||r==1?7:8).join("")).join(`
`);rt("data:text/plain;charset=utf-8,"+encodeURIComponent(i),"pattern.txt")}function Ai(){const i=c.chart.width,t=c.chart.height,r=[];for(let n=0;n<t;n++){let s=c.yarnSequence.pixel(0,(t-n-1)%c.yarnSequence.height);r.push(new Array(i).fill(s).join(""))}const e=`FILE FORMAT : DAK
YARNS
`+r.join(`
`)+`
YARN PALETTE
STITCH SYMBOLS
`+c.chart.make2d().map(n=>n.map(s=>s==0||s==1?".":"-").join("")).join(`
`)+`
END`;rt("data:text/plain;charset=utf-8,"+encodeURIComponent(e),"pattern.txt")}function Li(){const i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({width:c.chart.width,height:c.chart.height,repeats:c.repeats.map(({bitmap:t,pos:r,area:e})=>({bitmap:t.toJSON(),pos:r,area:e})),yarnPalette:c.yarnPalette,yarnSequence:c.yarnSequence.toJSON()}));rt(i,"pattern.json")}const ye={th860:{cardWidth:144,holeSize:5,cols:24,punchRadius:3.75/2,h:4.5,v:5,b:16,c:11}};function oe(i,t,r=ye[c.machine].punchRadius){const e=[],n=2*Math.PI/c.numSides;for(let s=0;s<c.numSides;s++)e.push([i+r*Math.sin(s*n),t+r*Math.cos(s*n)]);return Yn`<polygon points="${e.map(s=>`${s[0]},${s[1]}`)}" />`}function Mi(){const{b:i,c:t,h:r,v:e,cols:n}=ye[c.machine],s=[];for(let a=0;a<n;a++)s.push(oe(i+r/2+a*r,t+e/2-e)),s.push(oe(i+r/2+a*r,t+e/2-2*e)),s.push(oe(i+r/2+a*r,t+e/2+c.rows*e)),s.push(oe(i+r/2+a*r,t+e/2+(c.rows+1)*e));return s}function Bi(){const{b:i,h:t,c:r,v:e,cols:n}=ye[c.machine],s=F.fromTile(n,c.rows,c.repeats[0].bitmap).make2d(),a=[];for(let o=0;o<s.length;o++)for(let l=0;l<s[0].length;l++)s[o][l]==0&&a.push(oe(t*l+i+t/2,e*o+r+e/2));return a}function Ri(){const{b:i,h:t,c:r,v:e,cols:n,punchRadius:s}=ye[c.machine],a=[];for(let o=-2;o<c.rows+2;o++)a.push(oe(i+t/2-5.5,r+e/2+o*e,s-.25)),a.push(oe(i+t/2+(n-1)*t+5.5,r+e/2+o*e,s-.25));return a}function Ti(){const{b:i,c:t,v:r,h:e,cols:n}=ye[c.machine],s=[];for(const a of[-1,0,c.rows/2-1,c.rows/2])s.push(oe(i-10.5,t+r+a*2*r)),s.push(oe(i+n*e+10.5,t+(a*2+1)*r));return s}function ut(){const{v:i,c:t}=ye[c.machine];return c.rows*i+2*t}function dt(){const{cols:i,h:t,b:r}=ye[c.machine];return i*t+2*r}function zi(){return V` <div class="punchcard-preview">
    
    <svg
      id="punchcard"
      viewBox="0 0 ${dt()} ${ut()}"
      width="${dt()}mm"
      height="${ut()}mm">
      <g stroke="black" stroke-width="0.5" fill="none">
        <rect width="${dt()}" height="${ut()}" />
        ${Mi()}${Ri()}${Ti()}${Bi()}
      </g>
    </svg>
  </div>
</div>`}function Ni(){document.getElementById("preview-canvas").toBlob(t=>{const r=document.createElement("a");r.href=URL.createObjectURL(t),r.download="output.bmp",r.click()},"image/bmp")}function Ii(i){const t=document.getElementById("preview-canvas");if(!t)return;const r=t.parentNode;t.width=i.width,t.height=i.height;const e=r.clientHeight,n=e/i.height;t.style.width=`${i.width*n}px`,t.style.height=`${e}px`,t.style.imageRendering="pixelated",t.style.imageRendering="crisp-edges";const s=t.getContext("2d"),a=mi(i);s.putImageData(a,0,0)}function Di(){return Ii(c.repeats[0].bitmap),V`<div class="modal">
    <div class="modal-content">
      <h2>Export Workspace</h2>
      <div style="display: flex; gap: 5px;">
        <button class="btn solid" @click=${()=>Li()}>
          Workspace JSON
        </button>
      </div>

      <h2>Export Repeat</h2>
      <div style="display: flex; gap: 15px;">
        <canvas id="preview-canvas"> </canvas>
        <div style="display: flex; flex-direction: column; gap: 5px;">
          <button class="btn solid" @click=${()=>Ni()}>BMP</button>
          <button class="btn solid" @click=${()=>$i()}>
            TXT (SilverKnit)
          </button>
          <button class="btn solid" @click=${()=>Ai()}>
            TXT (Kniterate)
          </button>
        </div>
      </div>

      <h2>Punchcard</h2>
      <p>Supports Brother/Taitexma 24-stitch punchcards.</p>
      <label class="form-control range">
        Vertical Repeats
        <input
          type="range"
          name="line-width"
          min="1"
          max="10"
          .value=${String(c.punchVerticalRepeats)}
          @input=${i=>m({punchVerticalRepeats:Number(i.target.value),rows:Number(i.target.value)*c.repeats[0].bitmap.height})} />
      </label>

      ${zi()}
      <button class="btn solid" @click=${()=>Ci()}>
        Download Punchcard SVG
      </button>
    </div>
  </div>`}function Hi(){return V` <div id="library-modal" class="modal">
    <h2>Pattern Library</h2>
    <div class="modal-content">
      ${Object.entries(c.patternLibrary).map(([i,t])=>V`<div class="library-item">
            <span>${i.split("/").at(-1).split(".")[0]}</span>
            <button class="btn solid" @click=${()=>_i(i)}>
              <i class="fa-solid fa-upload"></i>
            </button>
          </div>`)}
    </div>
  </div>`}var Vi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var kn={exports:{}};/**
 * jscolor - JavaScript Color Picker
 *
 * @link    http://jscolor.com
 * @license For open source use: GPLv3
 *          For commercial use: JSColor Commercial License
 * @author  Jan Odvarko - East Desire
 *
 * See usage examples at http://jscolor.com/examples/
 */(function(i){(function(t,r){{i.exports=t.document?r(t):function(e){if(!e.document)throw new Error("jscolor needs a window with document");return r(e)};return}})(typeof window<"u"?window:Vi,function(t){var r=function(){var e={initialized:!1,instances:[],readyQueue:[],register:function(){typeof t<"u"&&t.document&&(t.document.readyState!=="loading"?e.pub.init():t.document.addEventListener("DOMContentLoaded",e.pub.init,!1))},installBySelector:function(n,s){if(s=s?e.node(s):t.document,!s)throw new Error("Missing root node");for(var a=s.querySelectorAll(n),o=new RegExp("(^|\\s)("+e.pub.lookupClass+")(\\s*(\\{[^}]*\\})|\\s|$)","i"),l=0;l<a.length;l+=1)if(!(a[l].jscolor&&a[l].jscolor instanceof e.pub)&&!(a[l].type!==void 0&&a[l].type.toLowerCase()=="color"&&e.isColorAttrSupported)){var u,d;if((u=e.getDataAttr(a[l],"jscolor"))!==null||a[l].className&&(d=a[l].className.match(o))){var p=a[l],f="";u!==null?f=u:d&&(console.warn('Installation using class name is DEPRECATED. Use data-jscolor="" attribute instead.'+e.docsRef),d[4]&&(f=d[4]));var S=null;if(f.trim())try{S=e.parseOptionsStr(f)}catch(x){console.warn(x+`
`+f)}try{new e.pub(p,S)}catch(x){console.warn(x)}}}},parseOptionsStr:function(n){var s=null;try{s=JSON.parse(n)}catch(a){if(e.pub.looseJSON)try{s=new Function("var opts = ("+n+'); return typeof opts === "object" ? opts : {};')()}catch(o){throw new Error("Could not evaluate jscolor options: "+o)}else throw new Error("Could not parse jscolor options as JSON: "+a)}return s},getInstances:function(){for(var n=[],s=0;s<e.instances.length;s+=1)e.instances[s]&&e.instances[s].targetElement&&n.push(e.instances[s]);return n},createEl:function(n){var s=t.document.createElement(n);return e.setData(s,"gui",!0),s},node:function(n){if(!n)return null;if(typeof n=="string"){var s=n,a=null;try{a=t.document.querySelector(s)}catch(o){return console.warn(o),null}return a||console.warn("No element matches the selector: %s",s),a}return e.isNode(n)?n:(console.warn("Invalid node of type %s: %s",typeof n,n),null)},isNode:function(n){return typeof Node=="object"?n instanceof Node:n&&typeof n=="object"&&typeof n.nodeType=="number"&&typeof n.nodeName=="string"},nodeName:function(n){return n&&n.nodeName?n.nodeName.toLowerCase():!1},removeChildren:function(n){for(;n.firstChild;)n.removeChild(n.firstChild)},isTextInput:function(n){return n&&e.nodeName(n)==="input"&&n.type.toLowerCase()==="text"},isButton:function(n){if(!n)return!1;var s=e.nodeName(n);return s==="button"||s==="input"&&["button","submit","reset"].indexOf(n.type.toLowerCase())>-1},isButtonEmpty:function(n){switch(e.nodeName(n)){case"input":return!n.value||n.value.trim()==="";case"button":return n.textContent.trim()===""}return null},isPassiveEventSupported:function(){var n=!1;try{var s=Object.defineProperty({},"passive",{get:function(){n=!0}});t.addEventListener("testPassive",null,s),t.removeEventListener("testPassive",null,s)}catch{}return n}(),isColorAttrSupported:function(){var n=t.document.createElement("input");return!!(n.setAttribute&&(n.setAttribute("type","color"),n.type.toLowerCase()=="color"))}(),dataProp:"_data_jscolor",setData:function(){var n=arguments[0];if(arguments.length===3){var s=n.hasOwnProperty(e.dataProp)?n[e.dataProp]:n[e.dataProp]={},a=arguments[1],o=arguments[2];return s[a]=o,!0}else if(arguments.length===2&&typeof arguments[1]=="object"){var s=n.hasOwnProperty(e.dataProp)?n[e.dataProp]:n[e.dataProp]={},l=arguments[1];for(var a in l)l.hasOwnProperty(a)&&(s[a]=l[a]);return!0}throw new Error("Invalid arguments")},removeData:function(){var n=arguments[0];if(!n.hasOwnProperty(e.dataProp))return!0;for(var s=1;s<arguments.length;s+=1){var a=arguments[s];delete n[e.dataProp][a]}return!0},getData:function(n,s,a){if(!n.hasOwnProperty(e.dataProp))if(a!==void 0)n[e.dataProp]={};else return;var o=n[e.dataProp];return!o.hasOwnProperty(s)&&a!==void 0&&(o[s]=a),o[s]},getDataAttr:function(n,s){var a="data-"+s,o=n.getAttribute(a);return o},setDataAttr:function(n,s,a){var o="data-"+s;n.setAttribute(o,a)},_attachedGroupEvents:{},attachGroupEvent:function(n,s,a,o){e._attachedGroupEvents.hasOwnProperty(n)||(e._attachedGroupEvents[n]=[]),e._attachedGroupEvents[n].push([s,a,o]),s.addEventListener(a,o,!1)},detachGroupEvents:function(n){if(e._attachedGroupEvents.hasOwnProperty(n)){for(var s=0;s<e._attachedGroupEvents[n].length;s+=1){var a=e._attachedGroupEvents[n][s];a[0].removeEventListener(a[1],a[2],!1)}delete e._attachedGroupEvents[n]}},preventDefault:function(n){n.preventDefault&&n.preventDefault(),n.returnValue=!1},triggerEvent:function(n,s,a,o){if(n){var l=null;return typeof Event=="function"?l=new Event(s,{bubbles:a,cancelable:o}):(l=t.document.createEvent("Event"),l.initEvent(s,a,o)),l?(e.setData(l,"internal",!0),n.dispatchEvent(l),!0):!1}},triggerInputEvent:function(n,s,a,o){n&&e.isTextInput(n)&&e.triggerEvent(n,s,a,o)},eventKey:function(n){var s={9:"Tab",13:"Enter",27:"Escape"};return typeof n.code=="string"?n.code:n.keyCode!==void 0&&s.hasOwnProperty(n.keyCode)?s[n.keyCode]:null},strList:function(n){return n?n.replace(/^\s+|\s+$/g,"").split(/\s+/):[]},hasClass:function(n,s){return s?n.classList!==void 0?n.classList.contains(s):(" "+n.className.replace(/\s+/g," ")+" ").indexOf(" "+s+" ")!=-1:!1},addClass:function(n,s){var a=e.strList(s);if(n.classList!==void 0){for(var o=0;o<a.length;o+=1)n.classList.add(a[o]);return}for(var o=0;o<a.length;o+=1)e.hasClass(n,a[o])||(n.className+=(n.className?" ":"")+a[o])},removeClass:function(n,s){var a=e.strList(s);if(n.classList!==void 0){for(var o=0;o<a.length;o+=1)n.classList.remove(a[o]);return}for(var o=0;o<a.length;o+=1){var l=new RegExp("^\\s*"+a[o]+"\\s*|\\s*"+a[o]+"\\s*$|\\s+"+a[o]+"(\\s+)","g");n.className=n.className.replace(l,"$1")}},getCompStyle:function(n){var s=t.getComputedStyle?t.getComputedStyle(n):n.currentStyle;return s||{}},setStyle:function(n,s,a,o){var l=a?"important":"",u=null;for(var d in s)if(s.hasOwnProperty(d)){var p=null;s[d]===null?(u||(u=e.getData(n,"origStyle")),u&&u.hasOwnProperty(d)&&(p=u[d])):(o&&(u||(u=e.getData(n,"origStyle",{})),u.hasOwnProperty(d)||(u[d]=n.style[d])),p=s[d]),p!==null&&n.style.setProperty(d,p,l)}},appendCss:function(n){var s=document.querySelector("head"),a=document.createElement("style");a.innerText=n,s.appendChild(a)},appendDefaultCss:function(n){e.appendCss([".jscolor-wrap, .jscolor-wrap div, .jscolor-wrap canvas { position:static; display:block; visibility:visible; overflow:visible; margin:0; padding:0; border:none; border-radius:0; outline:none; z-index:auto; float:none; width:auto; height:auto; left:auto; right:auto; top:auto; bottom:auto; min-width:0; min-height:0; max-width:none; max-height:none; background:none; clip:auto; opacity:1; transform:none; box-shadow:none; box-sizing:content-box; }",".jscolor-wrap { clear:both; }",".jscolor-wrap .jscolor-picker { position:relative; }",".jscolor-wrap .jscolor-shadow { position:absolute; left:0; top:0; width:100%; height:100%; }",".jscolor-wrap .jscolor-border { position:relative; }",".jscolor-wrap .jscolor-palette { position:absolute; }",".jscolor-wrap .jscolor-palette-sw { position:absolute; display:block; cursor:pointer; }",".jscolor-wrap .jscolor-btn { position:absolute; overflow:hidden; white-space:nowrap; font:13px sans-serif; text-align:center; cursor:pointer; }"].join(`
`))},hexColor:function(n,s,a){return"#"+(("0"+Math.round(n).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)).toUpperCase()},hexaColor:function(n,s,a,o){return"#"+(("0"+Math.round(n).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)+("0"+Math.round(o*255).toString(16)).slice(-2)).toUpperCase()},rgbColor:function(n,s,a){return"rgb("+Math.round(n)+","+Math.round(s)+","+Math.round(a)+")"},rgbaColor:function(n,s,a,o){return"rgba("+Math.round(n)+","+Math.round(s)+","+Math.round(a)+","+Math.round((o??1)*100)/100+")"},linearGradient:function(){function n(){for(var a="linear-gradient",o=["","-webkit-","-moz-","-o-","-ms-"],l=t.document.createElement("div"),u=0;u<o.length;u+=1){var d=o[u]+a,p=d+"(to right, rgba(0,0,0,0), rgba(0,0,0,0))";if(l.style.background=p,l.style.background)return d}return a}var s=n();return function(){return s+"("+Array.prototype.join.call(arguments,", ")+")"}}(),setBorderRadius:function(n,s){e.setStyle(n,{"border-radius":s||"0"})},setBoxShadow:function(n,s){e.setStyle(n,{"box-shadow":s||"none"})},getElementPos:function(n,s){var a=0,o=0,l=n.getBoundingClientRect();if(a=l.left,o=l.top,!s){var u=e.getViewPos();a+=u[0],o+=u[1]}return[a,o]},getElementSize:function(n){return[n.offsetWidth,n.offsetHeight]},getAbsPointerPos:function(n){var s=0,a=0;return typeof n.changedTouches<"u"&&n.changedTouches.length?(s=n.changedTouches[0].clientX,a=n.changedTouches[0].clientY):typeof n.clientX=="number"&&(s=n.clientX,a=n.clientY),{x:s,y:a}},getRelPointerPos:function(n){var s=n.target||n.srcElement,a=s.getBoundingClientRect(),o=0,l=0,u=0,d=0;return typeof n.changedTouches<"u"&&n.changedTouches.length?(u=n.changedTouches[0].clientX,d=n.changedTouches[0].clientY):typeof n.clientX=="number"&&(u=n.clientX,d=n.clientY),o=u-a.left,l=d-a.top,{x:o,y:l}},getViewPos:function(){var n=t.document.documentElement;return[(t.pageXOffset||n.scrollLeft)-(n.clientLeft||0),(t.pageYOffset||n.scrollTop)-(n.clientTop||0)]},getViewSize:function(){var n=t.document.documentElement;return[t.innerWidth||n.clientWidth,t.innerHeight||n.clientHeight]},RGB_HSV:function(n,s,a){n/=255,s/=255,a/=255;var o=Math.min(Math.min(n,s),a),l=Math.max(Math.max(n,s),a),u=l-o;if(u===0)return[null,0,100*l];var d=n===o?3+(a-s)/u:s===o?5+(n-a)/u:1+(s-n)/u;return[60*(d===6?0:d),100*(u/l),100*l]},HSV_RGB:function(n,s,a){var o=255*(a/100);if(n===null)return[o,o,o];n/=60,s/=100;var l=Math.floor(n),u=l%2?n-l:1-(n-l),d=o*(1-s),p=o*(1-s*u);switch(l){case 6:case 0:return[o,p,d];case 1:return[p,o,d];case 2:return[d,o,p];case 3:return[d,p,o];case 4:return[p,d,o];case 5:return[o,d,p]}},parseColorString:function(n){var s={rgba:null,format:null},a;if(a=n.match(/^\W*([0-9A-F]{3,8})\W*$/i)){if(a[1].length===8)s.format="hexa",s.rgba=[parseInt(a[1].slice(0,2),16),parseInt(a[1].slice(2,4),16),parseInt(a[1].slice(4,6),16),parseInt(a[1].slice(6,8),16)/255];else if(a[1].length===6)s.format="hex",s.rgba=[parseInt(a[1].slice(0,2),16),parseInt(a[1].slice(2,4),16),parseInt(a[1].slice(4,6),16),null];else if(a[1].length===3)s.format="hex",s.rgba=[parseInt(a[1].charAt(0)+a[1].charAt(0),16),parseInt(a[1].charAt(1)+a[1].charAt(1),16),parseInt(a[1].charAt(2)+a[1].charAt(2),16),null];else return!1;return s}if(a=n.match(/^\W*rgba?\(([^)]*)\)\W*$/i)){var o=a[1].split(","),l=/^\s*(\d+|\d*\.\d+|\d+\.\d*)\s*$/,u,d,p,f;if(o.length>=3&&(u=o[0].match(l))&&(d=o[1].match(l))&&(p=o[2].match(l)))return s.format="rgb",s.rgba=[parseFloat(u[1])||0,parseFloat(d[1])||0,parseFloat(p[1])||0,null],o.length>=4&&(f=o[3].match(l))&&(s.format="rgba",s.rgba[3]=parseFloat(f[1])||0),s}return!1},parsePaletteValue:function(n){var s=[];typeof n=="string"?n.replace(/#[0-9A-F]{3}\b|#[0-9A-F]{6}([0-9A-F]{2})?\b|rgba?\(([^)]*)\)/ig,function(u){s.push(u)}):Array.isArray(n)&&(s=n);for(var a=[],o=0;o<s.length;o++){var l=e.parseColorString(s[o]);l&&a.push(l)}return a},containsTranparentColor:function(n){for(var s=0;s<n.length;s++){var a=n[s].rgba[3];if(a!==null&&a<1)return!0}return!1},isAlphaFormat:function(n){switch(n.toLowerCase()){case"hexa":case"rgba":return!0}return!1},scaleCanvasForHighDPR:function(n){var s=t.devicePixelRatio||1;n.width*=s,n.height*=s;var a=n.getContext("2d");a.scale(s,s)},genColorPreviewCanvas:function(n,s,a,o){var l=Math.round(e.pub.previewSeparator.length),u=e.pub.chessboardSize,d=e.pub.chessboardColor1,p=e.pub.chessboardColor2,f=a||u*2,S=u*2,x=e.createEl("canvas"),v=x.getContext("2d");x.width=f,x.height=S,o&&e.scaleCanvasForHighDPR(x),v.fillStyle=d,v.fillRect(0,0,f,S),v.fillStyle=p;for(var w=0;w<f;w+=u*2)v.fillRect(w,0,u,u),v.fillRect(w+u,u,u,u);n&&(v.fillStyle=n,v.fillRect(0,0,f,S));var $=null;switch(s){case"left":$=0,v.clearRect(0,0,l/2,S);break;case"right":$=f-l,v.clearRect(f-l/2,0,l/2,S);break}if($!==null){v.lineWidth=1;for(var M=0;M<e.pub.previewSeparator.length;M+=1)v.beginPath(),v.strokeStyle=e.pub.previewSeparator[M],v.moveTo(.5+$+M,0),v.lineTo(.5+$+M,S),v.stroke()}return{canvas:x,width:f,height:S}},genColorPreviewGradient:function(n,s,a){var o=[];return s&&a?o=["to "+{left:"right",right:"left"}[s],n+" 0%",n+" "+a+"px","rgba(0,0,0,0) "+(a+1)+"px","rgba(0,0,0,0) 100%"]:o=["to right",n+" 0%",n+" 100%"],e.linearGradient.apply(this,o)},redrawPosition:function(){if(!(!e.picker||!e.picker.owner)){var n=e.picker.owner;if(n.container!==t.document.body)e._drawPosition(n,0,0,"relative",!1);else{var s,a;n.fixed?(s=e.getElementPos(n.targetElement,!0),a=[0,0]):(s=e.getElementPos(n.targetElement),a=e.getViewPos());var o=e.getElementSize(n.targetElement),l=e.getViewSize(),u=e.getPickerDims(n),d=[u.borderW,u.borderH],p,f,S;switch(n.position.toLowerCase()){case"left":p=1,f=0,S=-1;break;case"right":p=1,f=0,S=1;break;case"top":p=0,f=1,S=-1;break;default:p=0,f=1,S=1;break}var x=(o[f]+d[f])/2;if(n.smartPosition)var v=[-a[p]+s[p]+d[p]>l[p]&&-a[p]+s[p]+o[p]/2>l[p]/2&&s[p]+o[p]-d[p]>=0?s[p]+o[p]-d[p]:s[p],-a[f]+s[f]+o[f]+d[f]-x+x*S>l[f]?-a[f]+s[f]+o[f]/2>l[f]/2&&s[f]+o[f]-x-x*S>=0?s[f]+o[f]-x-x*S:s[f]+o[f]-x+x*S:s[f]+o[f]-x+x*S>=0?s[f]+o[f]-x+x*S:s[f]+o[f]-x-x*S];else var v=[s[p],s[f]+o[f]-x+x*S];var w=v[p],$=v[f],M=n.fixed?"fixed":"absolute",z=(v[0]+d[0]>s[0]||v[0]<s[0]+o[0])&&v[1]+d[1]<s[1]+o[1];e._drawPosition(n,w,$,M,z)}}},_drawPosition:function(n,s,a,o,l){var u=l?0:n.shadowBlur;e.picker.wrap.style.position=o,(Math.round(parseFloat(e.picker.wrap.style.left))!==Math.round(s)||Math.round(parseFloat(e.picker.wrap.style.top))!==Math.round(a))&&(e.picker.wrap.style.left=s+"px",e.picker.wrap.style.top=a+"px"),e.setBoxShadow(e.picker.boxS,n.shadow?new e.BoxShadow(0,u,n.shadowBlur,0,n.shadowColor):null)},getPickerDims:function(n){var s=2*n.controlBorderWidth+n.width,a=2*n.controlBorderWidth+n.height,o=2*n.controlBorderWidth+2*e.getControlPadding(n)+n.sliderSize;e.getSliderChannel(n)&&(s+=o),n.hasAlphaChannel()&&(s+=o);var l=e.getPaletteDims(n,s);l.height&&(a+=l.height+n.padding),n.closeButton&&(a+=2*n.controlBorderWidth+n.padding+n.buttonHeight);var u=s+2*n.padding,d=a+2*n.padding;return{contentW:s,contentH:a,paddedW:u,paddedH:d,borderW:u+2*n.borderWidth,borderH:d+2*n.borderWidth,palette:l}},getPaletteDims:function(n,s){var a=0,o=0,l=0,u=0,d=0,p=n._palette?n._palette.length:0;return p&&(a=n.paletteCols,o=a>0?Math.ceil(p/a):0,l=Math.max(1,Math.floor((s-(a-1)*n.paletteSpacing)/a)),u=n.paletteHeight?Math.min(n.paletteHeight,l):l),o&&(d=o*u+(o-1)*n.paletteSpacing),{cols:a,rows:o,cellW:l,cellH:u,width:s,height:d}},getControlPadding:function(n){return Math.max(n.padding/2,2*n.pointerBorderWidth+n.pointerThickness-n.controlBorderWidth)},getPadYChannel:function(n){switch(n.mode.charAt(1).toLowerCase()){case"v":return"v"}return"s"},getSliderChannel:function(n){if(n.mode.length>2)switch(n.mode.charAt(2).toLowerCase()){case"s":return"s";case"v":return"v"}return null},triggerCallback:function(n,s){if(n[s]){var a=null;if(typeof n[s]=="string")try{a=new Function(n[s])}catch(o){console.error(o)}else a=n[s];a&&a.call(n)}},triggerGlobal:function(n){for(var s=e.getInstances(),a=0;a<s.length;a+=1)s[a].trigger(n)},_pointerMoveEvent:{mouse:"mousemove",touch:"touchmove"},_pointerEndEvent:{mouse:"mouseup",touch:"touchend"},_pointerOrigin:null,onDocumentKeyUp:function(n){["Tab","Escape"].indexOf(e.eventKey(n))!==-1&&e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onWindowResize:function(n){e.redrawPosition()},onWindowScroll:function(n){e.redrawPosition()},onParentScroll:function(n){e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onDocumentMouseDown:function(n){var s=n.target||n.srcElement;if(s.jscolor&&s.jscolor instanceof e.pub)s.jscolor.showOnClick&&!s.disabled&&s.jscolor.show();else if(e.getData(s,"gui")){var a=e.getData(s,"control");a&&e.onControlPointerStart(n,s,e.getData(s,"control"),"mouse")}else e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onPickerTouchStart:function(n){var s=n.target||n.srcElement;e.getData(s,"control")&&e.onControlPointerStart(n,s,e.getData(s,"control"),"touch")},onControlPointerStart:function(n,s,a,o){var l=e.getData(s,"instance");e.preventDefault(n);var u=function(x,v){e.attachGroupEvent("drag",x,e._pointerMoveEvent[o],e.onDocumentPointerMove(n,s,a,o,v)),e.attachGroupEvent("drag",x,e._pointerEndEvent[o],e.onDocumentPointerEnd(n,s,a,o))};if(u(t.document,[0,0]),t.parent&&t.frameElement){var d=t.frameElement.getBoundingClientRect(),p=[-d.left,-d.top];u(t.parent.window.document,p)}var f=e.getAbsPointerPos(n),S=e.getRelPointerPos(n);switch(e._pointerOrigin={x:f.x-S.x,y:f.y-S.y},a){case"pad":e.getSliderChannel(l)==="v"&&l.channels.v===0&&l.fromHSVA(null,null,100,null),e.setPad(l,n,0,0);break;case"sld":e.setSld(l,n,0);break;case"asld":e.setASld(l,n,0);break}l.trigger("input")},onDocumentPointerMove:function(n,s,a,o,l){return function(u){var d=e.getData(s,"instance");switch(a){case"pad":e.setPad(d,u,l[0],l[1]);break;case"sld":e.setSld(d,u,l[1]);break;case"asld":e.setASld(d,u,l[1]);break}d.trigger("input")}},onDocumentPointerEnd:function(n,s,a,o){return function(l){var u=e.getData(s,"instance");e.detachGroupEvents("drag"),u.trigger("input"),u.trigger("change")}},onPaletteSampleClick:function(n){var s=n.currentTarget,a=e.getData(s,"instance"),o=e.getData(s,"color");a.format.toLowerCase()==="any"&&(a._setFormat(o.format),e.isAlphaFormat(a.getFormat())||(o.rgba[3]=1)),o.rgba[3]===null&&(a.paletteSetsAlpha===!0||a.paletteSetsAlpha==="auto"&&a._paletteHasTransparency)&&(o.rgba[3]=1),a.fromRGBA.apply(a,o.rgba),a.trigger("input"),a.trigger("change"),a.hideOnPaletteClick&&a.hide()},setPad:function(n,s,a,o){var l=e.getAbsPointerPos(s),u=a+l.x-e._pointerOrigin.x-n.padding-n.controlBorderWidth,d=o+l.y-e._pointerOrigin.y-n.padding-n.controlBorderWidth,p=u*(360/(n.width-1)),f=100-d*(100/(n.height-1));switch(e.getPadYChannel(n)){case"s":n.fromHSVA(p,f,null,null);break;case"v":n.fromHSVA(p,null,f,null);break}},setSld:function(n,s,a){var o=e.getAbsPointerPos(s),l=a+o.y-e._pointerOrigin.y-n.padding-n.controlBorderWidth,u=100-l*(100/(n.height-1));switch(e.getSliderChannel(n)){case"s":n.fromHSVA(null,u,null,null);break;case"v":n.fromHSVA(null,null,u,null);break}},setASld:function(n,s,a){var o=e.getAbsPointerPos(s),l=a+o.y-e._pointerOrigin.y-n.padding-n.controlBorderWidth,u=1-l*(1/(n.height-1));if(u<1){var d=n.getFormat();n.format.toLowerCase()==="any"&&!e.isAlphaFormat(d)&&n._setFormat(d==="hex"?"hexa":"rgba")}n.fromHSVA(null,null,null,u)},createPadCanvas:function(){var n={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,u,d){s.width=l,s.height=u,a.clearRect(0,0,s.width,s.height);var p=a.createLinearGradient(0,0,s.width,0);p.addColorStop(0/6,"#F00"),p.addColorStop(1/6,"#FF0"),p.addColorStop(2/6,"#0F0"),p.addColorStop(3/6,"#0FF"),p.addColorStop(4/6,"#00F"),p.addColorStop(5/6,"#F0F"),p.addColorStop(6/6,"#F00"),a.fillStyle=p,a.fillRect(0,0,s.width,s.height);var f=a.createLinearGradient(0,0,0,s.height);switch(d.toLowerCase()){case"s":f.addColorStop(0,"rgba(255,255,255,0)"),f.addColorStop(1,"rgba(255,255,255,1)");break;case"v":f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,1)");break}a.fillStyle=f,a.fillRect(0,0,s.width,s.height)};return n.elm=s,n.draw=o,n},createSliderGradient:function(){var n={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,u,d,p){s.width=l,s.height=u,a.clearRect(0,0,s.width,s.height);var f=a.createLinearGradient(0,0,0,s.height);f.addColorStop(0,d),f.addColorStop(1,p),a.fillStyle=f,a.fillRect(0,0,s.width,s.height)};return n.elm=s,n.draw=o,n},createASliderGradient:function(){var n={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,u,d){s.width=l,s.height=u,a.clearRect(0,0,s.width,s.height);var p=s.width/2,f=e.pub.chessboardColor1,S=e.pub.chessboardColor2;if(a.fillStyle=f,a.fillRect(0,0,s.width,s.height),p>0)for(var x=0;x<s.height;x+=p*2)a.fillStyle=S,a.fillRect(0,x,p,p),a.fillRect(p,x+p,p,p);var v=a.createLinearGradient(0,0,0,s.height);v.addColorStop(0,d),v.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=v,a.fillRect(0,0,s.width,s.height)};return n.elm=s,n.draw=o,n},BoxShadow:function(){var n=function(s,a,o,l,u,d){this.hShadow=s,this.vShadow=a,this.blur=o,this.spread=l,this.color=u,this.inset=!!d};return n.prototype.toString=function(){var s=[Math.round(this.hShadow)+"px",Math.round(this.vShadow)+"px",Math.round(this.blur)+"px",Math.round(this.spread)+"px",this.color];return this.inset&&s.push("inset"),s.join(" ")},n}(),flags:{leaveValue:1,leaveAlpha:2,leavePreview:4},enumOpts:{format:["auto","any","hex","hexa","rgb","rgba"],previewPosition:["left","right"],mode:["hsv","hvs","hs","hv"],position:["left","right","top","bottom"],alphaChannel:["auto",!0,!1],paletteSetsAlpha:["auto",!0,!1]},deprecatedOpts:{styleElement:"previewElement",onFineChange:"onInput",overwriteImportant:"forceStyle",closable:"closeButton",insetWidth:"controlBorderWidth",insetColor:"controlBorderColor",refine:null},docsRef:" See https://jscolor.com/docs/",pub:function(n,s){var a=this;s||(s={}),this.channels={r:255,g:255,b:255,h:0,s:0,v:100,a:1},this.format="auto",this.value=void 0,this.alpha=void 0,this.random=!1,this.onChange=void 0,this.onInput=void 0,this.valueElement=void 0,this.alphaElement=void 0,this.previewElement=void 0,this.previewPosition="left",this.previewSize=32,this.previewPadding=8,this.required=!0,this.hash=!0,this.uppercase=!0,this.forceStyle=!0,this.width=181,this.height=101,this.mode="HSV",this.alphaChannel="auto",this.position="bottom",this.smartPosition=!0,this.showOnClick=!0,this.hideOnLeave=!0,this.palette=[],this.paletteCols=10,this.paletteSetsAlpha="auto",this.paletteHeight=16,this.paletteSpacing=4,this.hideOnPaletteClick=!1,this.sliderSize=16,this.crossSize=8,this.closeButton=!1,this.closeText="Close",this.buttonColor="rgba(0,0,0,1)",this.buttonHeight=18,this.padding=12,this.backgroundColor="rgba(255,255,255,1)",this.borderWidth=1,this.borderColor="rgba(187,187,187,1)",this.borderRadius=8,this.controlBorderWidth=1,this.controlBorderColor="rgba(187,187,187,1)",this.shadow=!0,this.shadowBlur=15,this.shadowColor="rgba(0,0,0,0.2)",this.pointerColor="rgba(76,76,76,1)",this.pointerBorderWidth=1,this.pointerBorderColor="rgba(255,255,255,1)",this.pointerThickness=2,this.zIndex=5e3,this.container=void 0,this.minS=0,this.maxS=100,this.minV=0,this.maxV=100,this.minA=0,this.maxA=1,this.option=function(){if(!arguments.length)throw new Error("No option specified");if(arguments.length===1&&typeof arguments[0]=="string"){try{return l(arguments[0])}catch(E){console.warn(E)}return!1}else if(arguments.length>=2&&typeof arguments[0]=="string"){try{if(!o(arguments[0],arguments[1]))return!1}catch(E){return console.warn(E),!1}return this.redraw(),this.exposeColor(),!0}else if(arguments.length===1&&typeof arguments[0]=="object"){var h=arguments[0],y=!0;for(var P in h)if(h.hasOwnProperty(P))try{o(P,h[P])||(y=!1)}catch(E){console.warn(E),y=!1}return this.redraw(),this.exposeColor(),y}throw new Error("Invalid arguments")},this.channel=function(h,y){if(typeof h!="string")throw new Error("Invalid value for channel name: "+h);if(y===void 0)return this.channels.hasOwnProperty(h.toLowerCase())?this.channels[h.toLowerCase()]:(console.warn("Getting unknown channel: "+h),!1);var P=!1;switch(h.toLowerCase()){case"r":P=this.fromRGBA(y,null,null,null);break;case"g":P=this.fromRGBA(null,y,null,null);break;case"b":P=this.fromRGBA(null,null,y,null);break;case"h":P=this.fromHSVA(y,null,null,null);break;case"s":P=this.fromHSVA(null,y,null,null);break;case"v":P=this.fromHSVA(null,null,y,null);break;case"a":P=this.fromHSVA(null,null,null,y);break;default:return console.warn("Setting unknown channel: "+h),!1}return P?(this.redraw(),!0):!1},this.trigger=function(h){for(var y=e.strList(h),P=0;P<y.length;P+=1){var E=y[P].toLowerCase(),L=null;switch(E){case"input":L="onInput";break;case"change":L="onChange";break}L&&e.triggerCallback(this,L),e.triggerInputEvent(this.valueElement,E,!0,!0)}},this.fromHSVA=function(h,y,P,E,L){if(h===void 0&&(h=null),y===void 0&&(y=null),P===void 0&&(P=null),E===void 0&&(E=null),h!==null){if(isNaN(h))return!1;this.channels.h=Math.max(0,Math.min(360,h))}if(y!==null){if(isNaN(y))return!1;this.channels.s=Math.max(0,Math.min(100,this.maxS,y),this.minS)}if(P!==null){if(isNaN(P))return!1;this.channels.v=Math.max(0,Math.min(100,this.maxV,P),this.minV)}if(E!==null){if(isNaN(E))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,E),this.minA):1}var B=e.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=B[0],this.channels.g=B[1],this.channels.b=B[2],this.exposeColor(L),!0},this.fromRGBA=function(h,y,P,E,L){if(h===void 0&&(h=null),y===void 0&&(y=null),P===void 0&&(P=null),E===void 0&&(E=null),h!==null){if(isNaN(h))return!1;h=Math.max(0,Math.min(255,h))}if(y!==null){if(isNaN(y))return!1;y=Math.max(0,Math.min(255,y))}if(P!==null){if(isNaN(P))return!1;P=Math.max(0,Math.min(255,P))}if(E!==null){if(isNaN(E))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,E),this.minA):1}var B=e.RGB_HSV(h===null?this.channels.r:h,y===null?this.channels.g:y,P===null?this.channels.b:P);B[0]!==null&&(this.channels.h=Math.max(0,Math.min(360,B[0]))),B[2]!==0&&(this.channels.s=Math.max(0,this.minS,Math.min(100,this.maxS,B[1]))),this.channels.v=Math.max(0,this.minV,Math.min(100,this.maxV,B[2]));var b=e.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=b[0],this.channels.g=b[1],this.channels.b=b[2],this.exposeColor(L),!0},this.fromHSV=function(h,y,P,E){return console.warn("fromHSV() method is DEPRECATED. Using fromHSVA() instead."+e.docsRef),this.fromHSVA(h,y,P,null,E)},this.fromRGB=function(h,y,P,E){return console.warn("fromRGB() method is DEPRECATED. Using fromRGBA() instead."+e.docsRef),this.fromRGBA(h,y,P,null,E)},this.fromString=function(h,y){if(!this.required&&h.trim()==="")return this.setPreviewElementBg(null),this.setValueElementValue(""),!0;var P=e.parseColorString(h);return P?(this.format.toLowerCase()==="any"&&(this._setFormat(P.format),e.isAlphaFormat(this.getFormat())||(P.rgba[3]=1)),this.fromRGBA(P.rgba[0],P.rgba[1],P.rgba[2],P.rgba[3],y),!0):!1},this.randomize=function(h,y,P,E,L,B,b,A){h===void 0&&(h=0),y===void 0&&(y=100),P===void 0&&(P=0),E===void 0&&(E=100),L===void 0&&(L=0),B===void 0&&(B=359),b===void 0&&(b=1),A===void 0&&(A=1),this.fromHSVA(L+Math.floor(Math.random()*(B-L+1)),P+Math.floor(Math.random()*(E-P+1)),h+Math.floor(Math.random()*(y-h+1)),(100*b+Math.floor(Math.random()*(100*(A-b)+1)))/100)},this.toString=function(h){switch(h===void 0&&(h=this.getFormat()),h.toLowerCase()){case"hex":return this.toHEXString();case"hexa":return this.toHEXAString();case"rgb":return this.toRGBString();case"rgba":return this.toRGBAString()}return!1},this.toHEXString=function(){return e.hexColor(this.channels.r,this.channels.g,this.channels.b)},this.toHEXAString=function(){return e.hexaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toRGBString=function(){return e.rgbColor(this.channels.r,this.channels.g,this.channels.b)},this.toRGBAString=function(){return e.rgbaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toGrayscale=function(){return .213*this.channels.r+.715*this.channels.g+.072*this.channels.b},this.toCanvas=function(){return e.genColorPreviewCanvas(this.toRGBAString()).canvas},this.toDataURL=function(){return this.toCanvas().toDataURL()},this.toBackground=function(){return e.pub.background(this.toRGBAString())},this.isLight=function(){return this.toGrayscale()>127.5},this.hide=function(){x()&&u()},this.show=function(){d()},this.redraw=function(){x()&&d()},this.getFormat=function(){return this._currentFormat},this._setFormat=function(h){this._currentFormat=h.toLowerCase()},this.hasAlphaChannel=function(){return this.alphaChannel==="auto"?this.format.toLowerCase()==="any"||e.isAlphaFormat(this.getFormat())||this.alpha!==void 0||this.alphaElement!==void 0:this.alphaChannel},this.processValueInput=function(h){this.fromString(h)||this.exposeColor()},this.processAlphaInput=function(h){this.fromHSVA(null,null,null,parseFloat(h))||this.exposeColor()},this.exposeColor=function(h){var y=this.toString(),P=this.getFormat();if(e.setDataAttr(this.targetElement,"current-color",y),!(h&e.flags.leaveValue)&&this.valueElement&&((P==="hex"||P==="hexa")&&(this.uppercase||(y=y.toLowerCase()),this.hash||(y=y.replace(/^#/,""))),this.setValueElementValue(y)),!(h&e.flags.leaveAlpha)&&this.alphaElement){var E=Math.round(this.channels.a*100)/100;this.setAlphaElementValue(E)}!(h&e.flags.leavePreview)&&this.previewElement&&((e.isTextInput(this.previewElement)||e.isButton(this.previewElement)&&!e.isButtonEmpty(this.previewElement))&&this.previewPosition,this.setPreviewElementBg(this.toRGBAString())),x()&&(p(),f(),S())},this.setPreviewElementBg=function(h){if(this.previewElement){var y=null,P=null;(e.isTextInput(this.previewElement)||e.isButton(this.previewElement)&&!e.isButtonEmpty(this.previewElement))&&(y=this.previewPosition,P=this.previewSize);var E=[];if(!h)E.push({image:"none",position:"left top",size:"auto",repeat:"no-repeat",origin:"padding-box"});else{E.push({image:e.genColorPreviewGradient(h,y,P?P-e.pub.previewSeparator.length:null),position:"left top",size:"auto",repeat:y?"repeat-y":"repeat",origin:"padding-box"});var L=e.genColorPreviewCanvas("rgba(0,0,0,0)",y?{left:"right",right:"left"}[y]:null,P,!0);E.push({image:"url('"+L.canvas.toDataURL()+"')",position:(y||"left")+" top",size:L.width+"px "+L.height+"px",repeat:y?"repeat-y":"repeat",origin:"padding-box"})}for(var B={image:[],position:[],size:[],repeat:[],origin:[]},b=0;b<E.length;b+=1)B.image.push(E[b].image),B.position.push(E[b].position),B.size.push(E[b].size),B.repeat.push(E[b].repeat),B.origin.push(E[b].origin);var I={"background-image":B.image.join(", "),"background-position":B.position.join(", "),"background-size":B.size.join(", "),"background-repeat":B.repeat.join(", "),"background-origin":B.origin.join(", ")};e.setStyle(this.previewElement,I,this.forceStyle);var A={left:null,right:null};y&&(A[y]=this.previewSize+this.previewPadding+"px");var I={"padding-left":A.left,"padding-right":A.right};e.setStyle(this.previewElement,I,this.forceStyle,!0)}},this.setValueElementValue=function(h){this.valueElement&&(e.nodeName(this.valueElement)==="input"?this.valueElement.value=h:this.valueElement.innerHTML=h)},this.setAlphaElementValue=function(h){this.alphaElement&&(e.nodeName(this.alphaElement)==="input"?this.alphaElement.value=h:this.alphaElement.innerHTML=h)},this._processParentElementsInDOM=function(){if(!this._parentElementsProcessed){this._parentElementsProcessed=!0;var h=this.targetElement;do{var y=e.getCompStyle(h);y.position&&y.position.toLowerCase()==="fixed"&&(this.fixed=!0),h!==this.targetElement&&(e.getData(h,"hasScrollListener")||(h.addEventListener("scroll",e.onParentScroll,!1),e.setData(h,"hasScrollListener",!0)))}while((h=h.parentNode)&&e.nodeName(h)!=="body")}},this.tryHide=function(){this.hideOnLeave&&this.hide()},this.set__palette=function(h){this.palette=h,this._palette=e.parsePaletteValue(h),this._paletteHasTransparency=e.containsTranparentColor(this._palette)};function o(h,y){if(typeof h!="string")throw new Error("Invalid value for option name: "+h);if(e.enumOpts.hasOwnProperty(h)&&(typeof y=="string"&&(y=y.toLowerCase()),e.enumOpts[h].indexOf(y)===-1))throw new Error("Option '"+h+"' has invalid value: "+y);if(e.deprecatedOpts.hasOwnProperty(h)){var P=h,E=e.deprecatedOpts[h];if(E)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+e.docsRef,P,E),h=E;else throw new Error("Option '"+h+"' is DEPRECATED")}var L="set__"+h;if(typeof a[L]=="function")return a[L](y),!0;if(h in a)return a[h]=y,!0;throw new Error("Unrecognized configuration option: "+h)}function l(h){if(typeof h!="string")throw new Error("Invalid value for option name: "+h);if(e.deprecatedOpts.hasOwnProperty(h)){var y=h,P=e.deprecatedOpts[h];if(P)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+e.docsRef,y,P),h=P;else throw new Error("Option '"+h+"' is DEPRECATED")}var E="get__"+h;if(typeof a[E]=="function")return a[E](value);if(h in a)return a[h];throw new Error("Unrecognized configuration option: "+h)}function u(){e.removeClass(a.targetElement,e.pub.activeClassName),e.picker.wrap.parentNode.removeChild(e.picker.wrap),delete e.picker.owner}function d(){a._processParentElementsInDOM(),e.picker||(e.picker={owner:null,wrap:e.createEl("div"),box:e.createEl("div"),boxS:e.createEl("div"),boxB:e.createEl("div"),pad:e.createEl("div"),padB:e.createEl("div"),padM:e.createEl("div"),padCanvas:e.createPadCanvas(),cross:e.createEl("div"),crossBY:e.createEl("div"),crossBX:e.createEl("div"),crossLY:e.createEl("div"),crossLX:e.createEl("div"),sld:e.createEl("div"),sldB:e.createEl("div"),sldM:e.createEl("div"),sldGrad:e.createSliderGradient(),sldPtrS:e.createEl("div"),sldPtrIB:e.createEl("div"),sldPtrMB:e.createEl("div"),sldPtrOB:e.createEl("div"),asld:e.createEl("div"),asldB:e.createEl("div"),asldM:e.createEl("div"),asldGrad:e.createASliderGradient(),asldPtrS:e.createEl("div"),asldPtrIB:e.createEl("div"),asldPtrMB:e.createEl("div"),asldPtrOB:e.createEl("div"),pal:e.createEl("div"),btn:e.createEl("div"),btnT:e.createEl("div")},e.picker.pad.appendChild(e.picker.padCanvas.elm),e.picker.padB.appendChild(e.picker.pad),e.picker.cross.appendChild(e.picker.crossBY),e.picker.cross.appendChild(e.picker.crossBX),e.picker.cross.appendChild(e.picker.crossLY),e.picker.cross.appendChild(e.picker.crossLX),e.picker.padB.appendChild(e.picker.cross),e.picker.box.appendChild(e.picker.padB),e.picker.box.appendChild(e.picker.padM),e.picker.sld.appendChild(e.picker.sldGrad.elm),e.picker.sldB.appendChild(e.picker.sld),e.picker.sldB.appendChild(e.picker.sldPtrOB),e.picker.sldPtrOB.appendChild(e.picker.sldPtrMB),e.picker.sldPtrMB.appendChild(e.picker.sldPtrIB),e.picker.sldPtrIB.appendChild(e.picker.sldPtrS),e.picker.box.appendChild(e.picker.sldB),e.picker.box.appendChild(e.picker.sldM),e.picker.asld.appendChild(e.picker.asldGrad.elm),e.picker.asldB.appendChild(e.picker.asld),e.picker.asldB.appendChild(e.picker.asldPtrOB),e.picker.asldPtrOB.appendChild(e.picker.asldPtrMB),e.picker.asldPtrMB.appendChild(e.picker.asldPtrIB),e.picker.asldPtrIB.appendChild(e.picker.asldPtrS),e.picker.box.appendChild(e.picker.asldB),e.picker.box.appendChild(e.picker.asldM),e.picker.box.appendChild(e.picker.pal),e.picker.btn.appendChild(e.picker.btnT),e.picker.box.appendChild(e.picker.btn),e.picker.boxB.appendChild(e.picker.box),e.picker.wrap.appendChild(e.picker.boxS),e.picker.wrap.appendChild(e.picker.boxB),e.picker.wrap.addEventListener("touchstart",e.onPickerTouchStart,e.isPassiveEventSupported?{passive:!1}:!1));var h=e.picker,y=!!e.getSliderChannel(a),P=a.hasAlphaChannel(),E=e.getPickerDims(a),L=2*a.pointerBorderWidth+a.pointerThickness+2*a.crossSize,B=e.getControlPadding(a),b=Math.min(a.borderRadius,Math.round(a.padding*Math.PI)),A="crosshair";h.wrap.className="jscolor-wrap",h.wrap.style.width=E.borderW+"px",h.wrap.style.height=E.borderH+"px",h.wrap.style.zIndex=a.zIndex,h.box.className="jscolor-picker",h.box.style.width=E.paddedW+"px",h.box.style.height=E.paddedH+"px",h.boxS.className="jscolor-shadow",e.setBorderRadius(h.boxS,b+"px"),h.boxB.className="jscolor-border",h.boxB.style.border=a.borderWidth+"px solid",h.boxB.style.borderColor=a.borderColor,h.boxB.style.background=a.backgroundColor,e.setBorderRadius(h.boxB,b+"px"),h.padM.style.background="rgba(255,0,0,.2)",h.sldM.style.background="rgba(0,255,0,.2)",h.asldM.style.background="rgba(0,0,255,.2)",h.padM.style.opacity=h.sldM.style.opacity=h.asldM.style.opacity="0",h.pad.style.position="relative",h.pad.style.width=a.width+"px",h.pad.style.height=a.height+"px",h.padCanvas.draw(a.width,a.height,e.getPadYChannel(a)),h.padB.style.position="absolute",h.padB.style.left=a.padding+"px",h.padB.style.top=a.padding+"px",h.padB.style.border=a.controlBorderWidth+"px solid",h.padB.style.borderColor=a.controlBorderColor,h.padM.style.position="absolute",h.padM.style.left="0px",h.padM.style.top="0px",h.padM.style.width=a.padding+2*a.controlBorderWidth+a.width+B+"px",h.padM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",h.padM.style.cursor=A,e.setData(h.padM,{instance:a,control:"pad"}),h.cross.style.position="absolute",h.cross.style.left=h.cross.style.top="0",h.cross.style.width=h.cross.style.height=L+"px",h.crossBY.style.position=h.crossBX.style.position="absolute",h.crossBY.style.background=h.crossBX.style.background=a.pointerBorderColor,h.crossBY.style.width=h.crossBX.style.height=2*a.pointerBorderWidth+a.pointerThickness+"px",h.crossBY.style.height=h.crossBX.style.width=L+"px",h.crossBY.style.left=h.crossBX.style.top=Math.floor(L/2)-Math.floor(a.pointerThickness/2)-a.pointerBorderWidth+"px",h.crossBY.style.top=h.crossBX.style.left="0",h.crossLY.style.position=h.crossLX.style.position="absolute",h.crossLY.style.background=h.crossLX.style.background=a.pointerColor,h.crossLY.style.height=h.crossLX.style.width=L-2*a.pointerBorderWidth+"px",h.crossLY.style.width=h.crossLX.style.height=a.pointerThickness+"px",h.crossLY.style.left=h.crossLX.style.top=Math.floor(L/2)-Math.floor(a.pointerThickness/2)+"px",h.crossLY.style.top=h.crossLX.style.left=a.pointerBorderWidth+"px",h.sld.style.overflow="hidden",h.sld.style.width=a.sliderSize+"px",h.sld.style.height=a.height+"px",h.sldGrad.draw(a.sliderSize,a.height,"#000","#000"),h.sldB.style.display=y?"block":"none",h.sldB.style.position="absolute",h.sldB.style.left=a.padding+a.width+2*a.controlBorderWidth+2*B+"px",h.sldB.style.top=a.padding+"px",h.sldB.style.border=a.controlBorderWidth+"px solid",h.sldB.style.borderColor=a.controlBorderColor,h.sldM.style.display=y?"block":"none",h.sldM.style.position="absolute",h.sldM.style.left=a.padding+a.width+2*a.controlBorderWidth+B+"px",h.sldM.style.top="0px",h.sldM.style.width=a.sliderSize+2*B+2*a.controlBorderWidth+(P?0:Math.max(0,a.padding-B))+"px",h.sldM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",h.sldM.style.cursor="default",e.setData(h.sldM,{instance:a,control:"sld"}),h.sldPtrIB.style.border=h.sldPtrOB.style.border=a.pointerBorderWidth+"px solid "+a.pointerBorderColor,h.sldPtrOB.style.position="absolute",h.sldPtrOB.style.left=-(2*a.pointerBorderWidth+a.pointerThickness)+"px",h.sldPtrOB.style.top="0",h.sldPtrMB.style.border=a.pointerThickness+"px solid "+a.pointerColor,h.sldPtrS.style.width=a.sliderSize+"px",h.sldPtrS.style.height=e.pub.sliderInnerSpace+"px",h.asld.style.overflow="hidden",h.asld.style.width=a.sliderSize+"px",h.asld.style.height=a.height+"px",h.asldGrad.draw(a.sliderSize,a.height,"#000"),h.asldB.style.display=P?"block":"none",h.asldB.style.position="absolute",h.asldB.style.left=a.padding+a.width+2*a.controlBorderWidth+B+(y?a.sliderSize+3*B+2*a.controlBorderWidth:0)+"px",h.asldB.style.top=a.padding+"px",h.asldB.style.border=a.controlBorderWidth+"px solid",h.asldB.style.borderColor=a.controlBorderColor,h.asldM.style.display=P?"block":"none",h.asldM.style.position="absolute",h.asldM.style.left=a.padding+a.width+2*a.controlBorderWidth+B+(y?a.sliderSize+2*B+2*a.controlBorderWidth:0)+"px",h.asldM.style.top="0px",h.asldM.style.width=a.sliderSize+2*B+2*a.controlBorderWidth+Math.max(0,a.padding-B)+"px",h.asldM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",h.asldM.style.cursor="default",e.setData(h.asldM,{instance:a,control:"asld"}),h.asldPtrIB.style.border=h.asldPtrOB.style.border=a.pointerBorderWidth+"px solid "+a.pointerBorderColor,h.asldPtrOB.style.position="absolute",h.asldPtrOB.style.left=-(2*a.pointerBorderWidth+a.pointerThickness)+"px",h.asldPtrOB.style.top="0",h.asldPtrMB.style.border=a.pointerThickness+"px solid "+a.pointerColor,h.asldPtrS.style.width=a.sliderSize+"px",h.asldPtrS.style.height=e.pub.sliderInnerSpace+"px",h.pal.className="jscolor-palette",h.pal.style.display=E.palette.rows?"block":"none",h.pal.style.left=a.padding+"px",h.pal.style.top=2*a.controlBorderWidth+2*a.padding+a.height+"px",h.pal.innerHTML="";for(var I=e.genColorPreviewCanvas("rgba(0,0,0,0)"),G=0,ee=0;ee<E.palette.rows;ee++)for(var k=0;k<E.palette.cols&&G<a._palette.length;k++,G++){var g=a._palette[G],_=e.rgbaColor.apply(null,g.rgba),C=e.createEl("div");C.style.width=E.palette.cellW-2*a.controlBorderWidth+"px",C.style.height=E.palette.cellH-2*a.controlBorderWidth+"px",C.style.backgroundColor=_;var N=e.createEl("div");N.className="jscolor-palette-sw",N.style.left=(E.palette.cols<=1?0:Math.round(10*(k*((E.contentW-E.palette.cellW)/(E.palette.cols-1))))/10)+"px",N.style.top=ee*(E.palette.cellH+a.paletteSpacing)+"px",N.style.border=a.controlBorderWidth+"px solid",N.style.borderColor=a.controlBorderColor,g.rgba[3]!==null&&g.rgba[3]<1&&(N.style.backgroundImage="url('"+I.canvas.toDataURL()+"')",N.style.backgroundRepeat="repeat",N.style.backgroundPosition="center center"),e.setData(N,{instance:a,control:"palette-sw",color:g}),N.addEventListener("click",e.onPaletteSampleClick,!1),N.appendChild(C),h.pal.appendChild(N)}function q(){var J=a.controlBorderColor.split(/\s+/),we=J.length<2?J[0]:J[1]+" "+J[0]+" "+J[0]+" "+J[1];h.btn.style.borderColor=we}var X=15;h.btn.className="jscolor-btn jscolor-btn-close",h.btn.style.display=a.closeButton?"block":"none",h.btn.style.left=a.padding+"px",h.btn.style.bottom=a.padding+"px",h.btn.style.padding="0 "+X+"px",h.btn.style.maxWidth=E.contentW-2*a.controlBorderWidth-2*X+"px",h.btn.style.height=a.buttonHeight+"px",h.btn.style.border=a.controlBorderWidth+"px solid",q(),h.btn.style.color=a.buttonColor,h.btn.onmousedown=function(){a.hide()},h.btnT.style.display="inline",h.btnT.style.lineHeight=a.buttonHeight+"px",h.btnT.innerText=a.closeText,p(),f(),S(),e.picker.owner&&e.picker.owner!==a&&e.removeClass(e.picker.owner.targetElement,e.pub.activeClassName),e.picker.owner=a,e.redrawPosition(),h.wrap.parentNode!==a.container&&a.container.appendChild(h.wrap),e.addClass(a.targetElement,e.pub.activeClassName)}function p(){var h=e.getPadYChannel(a),y=Math.round(a.channels.h/360*(a.width-1)),P=Math.round((1-a.channels[h]/100)*(a.height-1)),E=2*a.pointerBorderWidth+a.pointerThickness+2*a.crossSize,L=-Math.floor(E/2);switch(e.picker.cross.style.left=y+L+"px",e.picker.cross.style.top=P+L+"px",e.getSliderChannel(a)){case"s":var B=e.HSV_RGB(a.channels.h,100,a.channels.v),b=e.HSV_RGB(a.channels.h,0,a.channels.v),I="rgb("+Math.round(B[0])+","+Math.round(B[1])+","+Math.round(B[2])+")",G="rgb("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+")";e.picker.sldGrad.draw(a.sliderSize,a.height,I,G);break;case"v":var A=e.HSV_RGB(a.channels.h,a.channels.s,100),I="rgb("+Math.round(A[0])+","+Math.round(A[1])+","+Math.round(A[2])+")",G="#000";e.picker.sldGrad.draw(a.sliderSize,a.height,I,G);break}e.picker.asldGrad.draw(a.sliderSize,a.height,a.toHEXString())}function f(){var h=e.getSliderChannel(a);if(h){var y=Math.round((1-a.channels[h]/100)*(a.height-1));e.picker.sldPtrOB.style.top=y-(2*a.pointerBorderWidth+a.pointerThickness)-Math.floor(e.pub.sliderInnerSpace/2)+"px"}e.picker.asldGrad.draw(a.sliderSize,a.height,a.toHEXString())}function S(){var h=Math.round((1-a.channels.a)*(a.height-1));e.picker.asldPtrOB.style.top=h-(2*a.pointerBorderWidth+a.pointerThickness)-Math.floor(e.pub.sliderInnerSpace/2)+"px"}function x(){return e.picker&&e.picker.owner===a}function v(h){e.eventKey(h)==="Enter"&&(a.valueElement&&a.processValueInput(a.valueElement.value),a.tryHide())}function w(h){e.eventKey(h)==="Enter"&&(a.alphaElement&&a.processAlphaInput(a.alphaElement.value),a.tryHide())}function $(h){if(!e.getData(h,"internal")){var y=a.valueElement.value;a.processValueInput(a.valueElement.value),e.triggerCallback(a,"onChange"),a.valueElement.value!==y&&e.triggerInputEvent(a.valueElement,"change",!0,!0)}}function M(h){if(!e.getData(h,"internal")){var y=a.alphaElement.value;a.processAlphaInput(a.alphaElement.value),e.triggerCallback(a,"onChange"),e.triggerInputEvent(a.valueElement,"change",!0,!0),a.alphaElement.value!==y&&e.triggerInputEvent(a.alphaElement,"change",!0,!0)}}function z(h){e.getData(h,"internal")||(a.valueElement&&a.fromString(a.valueElement.value,e.flags.leaveValue),e.triggerCallback(a,"onInput"))}function R(h){e.getData(h,"internal")||(a.alphaElement&&a.fromHSVA(null,null,null,parseFloat(a.alphaElement.value),e.flags.leaveAlpha),e.triggerCallback(a,"onInput"),e.triggerInputEvent(a.valueElement,"input",!0,!0))}if(e.pub.options){for(var T in e.pub.options)if(e.pub.options.hasOwnProperty(T))try{o(T,e.pub.options[T])}catch(h){console.warn(h)}}var O=[];s.preset&&(typeof s.preset=="string"?O=s.preset.split(/\s+/):Array.isArray(s.preset)?O=s.preset.slice():console.warn("Unrecognized preset value")),O.indexOf("default")===-1&&O.push("default");for(var W=O.length-1;W>=0;W-=1){var D=O[W];if(D){if(!e.pub.presets.hasOwnProperty(D)){console.warn("Unknown preset: %s",D);continue}for(var T in e.pub.presets[D])if(e.pub.presets[D].hasOwnProperty(T))try{o(T,e.pub.presets[D][T])}catch(y){console.warn(y)}}}var H=["preset"];for(var T in s)if(s.hasOwnProperty(T)&&H.indexOf(T)===-1)try{o(T,s[T])}catch(y){console.warn(y)}if(this.container===void 0?this.container=t.document.body:this.container=e.node(this.container),!this.container)throw new Error("Cannot instantiate color picker without a container element");if(this.targetElement=e.node(n),!this.targetElement){if(typeof n=="string"&&/^[a-zA-Z][\w:.-]*$/.test(n)){var U=n;throw new Error("If '"+U+"' is supposed to be an ID, please use '#"+U+"' or any valid CSS selector.")}throw new Error("Cannot instantiate color picker without a target element")}if(this.targetElement.jscolor&&this.targetElement.jscolor instanceof e.pub)throw new Error("Color picker already installed on this element");if(this.targetElement.jscolor=this,e.addClass(this.targetElement,e.pub.className),e.instances.push(this),e.isButton(this.targetElement)&&(this.targetElement.type.toLowerCase()!=="button"&&(this.targetElement.type="button"),e.isButtonEmpty(this.targetElement))){e.removeChildren(this.targetElement),this.targetElement.appendChild(t.document.createTextNode(" "));var be=e.getCompStyle(this.targetElement),Pe=parseFloat(be["min-width"])||0;Pe<this.previewSize&&e.setStyle(this.targetElement,{"min-width":this.previewSize+"px"},this.forceStyle)}if(this.valueElement===void 0?e.isTextInput(this.targetElement)&&(this.valueElement=this.targetElement):this.valueElement===null||(this.valueElement=e.node(this.valueElement)),this.alphaElement&&(this.alphaElement=e.node(this.alphaElement)),this.previewElement===void 0?this.previewElement=this.targetElement:this.previewElement===null||(this.previewElement=e.node(this.previewElement)),this.valueElement&&e.isTextInput(this.valueElement)){var ae={onInput:this.valueElement.oninput};this.valueElement.oninput=null,this.valueElement.addEventListener("keydown",v,!1),this.valueElement.addEventListener("change",$,!1),this.valueElement.addEventListener("input",z,!1),ae.onInput&&this.valueElement.addEventListener("input",ae.onInput,!1),this.valueElement.setAttribute("autocomplete","off"),this.valueElement.setAttribute("autocorrect","off"),this.valueElement.setAttribute("autocapitalize","off"),this.valueElement.setAttribute("spellcheck",!1)}this.alphaElement&&e.isTextInput(this.alphaElement)&&(this.alphaElement.addEventListener("keydown",w,!1),this.alphaElement.addEventListener("change",M,!1),this.alphaElement.addEventListener("input",R,!1),this.alphaElement.setAttribute("autocomplete","off"),this.alphaElement.setAttribute("autocorrect","off"),this.alphaElement.setAttribute("autocapitalize","off"),this.alphaElement.setAttribute("spellcheck",!1));var le="FFFFFF";this.value!==void 0?le=this.value:this.valueElement&&this.valueElement.value!==void 0&&(le=this.valueElement.value);var Z=void 0;if(this.alpha!==void 0?Z=""+this.alpha:this.alphaElement&&this.alphaElement.value!==void 0&&(Z=this.alphaElement.value),this._currentFormat=null,["auto","any"].indexOf(this.format.toLowerCase())>-1){var ce=e.parseColorString(le);this._currentFormat=ce?ce.format:"hex"}else this._currentFormat=this.format.toLowerCase();this.processValueInput(le),Z!==void 0&&this.processAlphaInput(Z),this.random&&this.randomize.apply(this,Array.isArray(this.random)?this.random:[])}};return e.pub.className="jscolor",e.pub.activeClassName="jscolor-active",e.pub.looseJSON=!0,e.pub.presets={},e.pub.presets.default={},e.pub.presets.light={backgroundColor:"rgba(255,255,255,1)",controlBorderColor:"rgba(187,187,187,1)",buttonColor:"rgba(0,0,0,1)"},e.pub.presets.dark={backgroundColor:"rgba(51,51,51,1)",controlBorderColor:"rgba(153,153,153,1)",buttonColor:"rgba(240,240,240,1)"},e.pub.presets.small={width:101,height:101,padding:10,sliderSize:14,paletteCols:8},e.pub.presets.medium={width:181,height:101,padding:12,sliderSize:16,paletteCols:10},e.pub.presets.large={width:271,height:151,padding:12,sliderSize:24,paletteCols:15},e.pub.presets.thin={borderWidth:1,controlBorderWidth:1,pointerBorderWidth:1},e.pub.presets.thick={borderWidth:2,controlBorderWidth:2,pointerBorderWidth:2},e.pub.sliderInnerSpace=3,e.pub.chessboardSize=8,e.pub.chessboardColor1="#666666",e.pub.chessboardColor2="#999999",e.pub.previewSeparator=["rgba(255,255,255,.65)","rgba(128,128,128,.65)"],e.pub.init=function(){if(!e.initialized)for(t.document.addEventListener("mousedown",e.onDocumentMouseDown,!1),t.document.addEventListener("keyup",e.onDocumentKeyUp,!1),t.addEventListener("resize",e.onWindowResize,!1),t.addEventListener("scroll",e.onWindowScroll,!1),e.appendDefaultCss(),e.pub.install(),e.initialized=!0;e.readyQueue.length;){var n=e.readyQueue.shift();n()}},e.pub.install=function(n){var s=!0;try{e.installBySelector("[data-jscolor]",n)}catch(a){s=!1,console.warn(a)}if(e.pub.lookupClass)try{e.installBySelector("input."+e.pub.lookupClass+", button."+e.pub.lookupClass,n)}catch{}return s},e.pub.ready=function(n){return typeof n!="function"?(console.warn("Passed value is not a function"),!1):(e.initialized?n():e.readyQueue.push(n),!0)},e.pub.trigger=function(n){var s=function(){e.triggerGlobal(n)};e.initialized?s():e.pub.ready(s)},e.pub.hide=function(){e.picker&&e.picker.owner&&e.picker.owner.hide()},e.pub.chessboard=function(n){n||(n="rgba(0,0,0,0)");var s=e.genColorPreviewCanvas(n);return s.canvas.toDataURL()},e.pub.background=function(n){var s=[];s.push(e.genColorPreviewGradient(n));var a=e.genColorPreviewCanvas();return s.push(["url('"+a.canvas.toDataURL()+"')","left top","repeat"].join(" ")),s.join(", ")},e.pub.options={},e.pub.lookupClass="jscolor",e.pub.installByClassName=function(){return console.error('jscolor.installByClassName() is DEPRECATED. Use data-jscolor="" attribute instead of a class name.'+e.docsRef),!1},e.register(),e.pub}();return typeof t.jscolor>"u"&&(t.jscolor=t.JSColor=r),r})})(kn);var Fi=kn.exports;const Wi=Oi(Fi);function qi(){return V` <div id="settings-modal" class="modal">
    <h2>Settings</h2>

    <div class="modal-content">
      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${c.reverseScroll}
          @change=${i=>m({reverseScroll:i.target.checked})} />
        Invert Scroll
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="grid"
          ?checked=${c.grid}
          @change=${i=>m({grid:i.target.checked})} />
        Grid
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${c.debug}
          @change=${i=>m({debug:i.target.checked})} />
        Debug
      </label>

      <label class="form-control range">
        Symbol Line Width
        <input
          type="range"
          name="line-width"
          min="1"
          max="10"
          .value=${String(c.symbolLineWidth)}
          ?checked=${c.debug}
          @input=${i=>m({symbolLineWidth:Number(i.target.value)})} />
      </label>
    </div>
  </div>`}function Gi(){return V` <div class="panzoom-controls">
    <button class="btn icon" @click=${()=>ct(c.scale-1)}>
      <i class="fa-solid fa-magnifying-glass-minus"></i>
    </button>
    <input
      type="range"
      min=${gn}
      max=${fn}
      .value=${String(c.scale)}
      @input=${i=>ct(Number(i.target.value))} />
    <button class="btn icon" @click=${()=>ct(c.scale+1)}>
      <i class="fa-solid fa-magnifying-glass-plus"></i>
    </button>
    <button class="btn icon" @click=${ke}>
      <i class="fa-solid fa-expand"></i>
    </button>
  </div>`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Wt(i,t){if(i!==void 0){let r=0;for(const e of i)yield t(e,r++)}}const Yi=V`<style>
  #debug-pane {
    display: flex;
    flex-direction: column;
  }
  #debug-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #1a1919;
    padding: 4px;
  }

  #debug-header > h3 {
    margin: 0;
  }

  #debug-header > button {
    display: flex;
    padding: 0;
    border: 0;
    outline: 0;
    background-color: transparent;
    color: #939292;
    font-size: large;
    cursor: pointer;
  }

  #debug-header > button:hover {
    color: red;
  }

  #debug-content {
    display: grid;
    grid-template-columns: auto auto;
    gap: 1px;
    background-color: #1a1919;
    color: #dadada;
    flex-basis: 350px;
    overflow-y: auto;
  }

  #debug-content > * {
    background-color: #2c2c2c;
    padding: 5px;
  }

  #debug-content > h4 {
    margin: 0;
    text-align: right;
    white-space: nowrap;
  }

  .chip-container {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  .chip {
    font-weight: bold;
    padding: 4px;
    border-radius: 5px;
    background: #5e5e5e;
    paint-order: stroke fill;
    text-shadow: 1px 0 0 black, 0 1px 0 black, -1px 0 0 black, 0 -1px 0 black;
    box-shadow: 0 0 2px black;
  }

  .number-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
  }

  .bool-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
    background-color: rgba(177, 211, 111, 1);
  }
</style>`;function Ui(){return V`${Yi}
    <div id="debug-pane">
      <div id="debug-header">
        <h3>Debug</h3>
        <button @click=${()=>m({debug:!1})}>
          <i class="fa-solid fa-circle-xmark"></i>
        </button>
      </div>
      <div id="debug-content">
        <h4>Scale</h4>
        <span>
          <span class="number-field">${c.scale}</span> pixels per
          pixel
        </span>
        <h4>x pos</h4>
        <span class="number-field">${c.pos.x}</span>
        <h4>y pos</h4>
        <span class="number-field">${c.pos.y}</span>
        <h4>Active Tool</h4>
        <span class="text-field">${c.activeTool}</span>
        <h4>Active Color</h4>
        <span class="number-field">${c.activeColor}</span>
        <h4>Device Pixel Ratio</h4>
        <span>
          <span class="number-field">${devicePixelRatio}</span> device pixel(s)
          per CSS pixel
        </span>
        <h4>Color Palette</h4>
        <div class="chip-container">
          ${Wt(c.yarnPalette,i=>V`<code class="chip" style="background:${i};"
                >${i}</code
              >`)}
        </div>
        <h4>Snapshot Length</h4>
        <span class="number-field">${c.snapshots.length}</span>
        <h4>Held Keys</h4>
        <div class="chip-container">
          ${c.heldKeys.size>0?Wt(c.heldKeys,i=>V`<span class="chip">${i}</span>`):V`<span class="chip">none</span>`}
        </div>
        <h4>Grid</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${c.grid?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${c.grid}</span
          >
        </div>
        <h4>Editing Palette</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${c.editingPalette?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${c.editingPalette}</span
          >
        </div>
        <h4>Show Settings</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${c.showSettings?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${c.showSettings}</span
          >
        </div>
        <h4>Show download</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${c.showDownload?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${c.showDownload}</span
          >
        </div>
        <h4>Show debug</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${c.debug?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${c.debug}</span
          >
        </div>
      </div>
    </div>`}function Xi(){return V` <div id="symbol-picker">
    <h3>Symbols</h3>
    ${c.symbolMap.map((i,t)=>V`<button
        class="btn solid img ${c.activeSymbol==t?"current":""}"
        @click=${()=>m({activeSymbol:t})}>
        <div>${i}</div>
        <canvas class="symbol-preview" data-symbol=${i}></canvas>
      </button>`)}
  </div>`}function Ki(i){if(c.yarnPalette.length==1){alert("you need some color in your life");return}const t=c.yarnPalette.filter((e,n)=>n!=i),r=c.yarnSequence.pixels.map(e=>e==i?0:e>i?e-1:e);m({yarnPalette:t,yarnSequence:new F(c.yarnSequence.width,c.yarnSequence.height,r)})}function qt(i){const t=document.getElementById(`color-${i}`);if(!t.jscolor){const r=new Wi(t,{preset:"dark large",format:"hexa",value:c.yarnPalette[i],onInput:()=>{const e=[...c.yarnPalette];e[i]=r.toRGBAString(),m({yarnPalette:e,yarnSequence:c.yarnSequence})},previewElement:null})}t.jscolor.show()}function ji(){return V`<div id="yarn-picker">
    <h3>Yarns</h3>
    <div>
      <button
        class="btn icon ${c.editingPalette?"selected":""}"
        @click=${()=>m({editingPalette:!c.editingPalette})}>
        <i class="fa-solid fa-pen"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{let i=[...c.yarnPalette];i.push(Ze()),m({yarnPalette:i})}}>
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
    ${c.yarnPalette.map((i,t)=>V`<button
          class="btn solid color-select ${t==c.activeYarn?"selected":""}"
          @click=${()=>m({activeYarn:t})}>
          <div class="color-label">${t+1}</div>
          <div class="color-preview" style="--current: ${i};">
            ${c.editingPalette?V`
                  <button
                    class="delete-color-button"
                    @click=${()=>Ki(t)}>
                    <i class="fa-solid fa-circle-xmark"></i>
                  </button>
                  <button
                    id="color-${t}"
                    class="edit-color-btn"
                    @click=${r=>qt(t)}></button>
                  <div
                    class="edit-color-icon"
                    @click=${r=>qt(t)}>
                    <i class="fa-solid fa-pen"></i>
                  </div>
                `:""}
          </div>
        </button>`)}

    <div>
      <button
        class="btn icon"
        @click=${()=>{m({yarnPalette:[...bi(c.yarnPalette)]})}}>
        <i class="fa-solid fa-arrows-rotate"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{m({yarnPalette:Array.from(Array(c.yarnPalette.length),()=>Ze())})}}>
        <i class="fa-solid fa-dice"></i>
      </button>
    </div>
  </div>`}function Ji(){return V`<div id="left-bar" class="scroller">
    ${Xi()} ${ji()}
  </div>`}function Zi(i){return Math.floor(i.pos[0]*c.scale/devicePixelRatio)}function Qi(i){return Math.floor((c.chart.height-i.bitmap.height-i.pos[1])*c.scale/devicePixelRatio)}function er(){return V` <div id="repeat-container">
    ${c.repeats.map((i,t)=>V`<div
          data-repeatindex=${t}
          class="repeat-canvas-container"
          style="transform: translate(${Zi(i)}px, ${Qi(i)}px); ${c.editingRepeat==t?"z-index: 3":"z-index: 1"}"
          id="repeat-${t}-container">
          ${_e(c.editingRepeat==t,()=>V`<button class="btn solid resize-repeat grab">
                <i class="fa-solid fa-up-right-and-down-left-from-center"></i>
              </button> `)}
          <!-- <div
            class="repeat-bounds"
            style="width: ${i.area[0]*c.scale/devicePixelRatio}px; height: ${i.area[1]*c.scale/devicePixelRatio}px;">
            ${_e(c.editingRepeat==t,()=>V`<button class="repeat-area-dragger y-axis">
                  <i class="fa-solid fa-angles-up"></i></button
                ><button class="repeat-area-dragger x-axis">
                  <i class="fa-solid fa-angles-right"></i>
                </button>`)}
          </div> -->
          <canvas id="repeat-${t}" class="repeat-canvas"></canvas>
          <canvas id="repeat-${t}-grid" class="grid-canvas"></canvas>
          <canvas id="repeat-${t}-outline" class="outline-canvas"></canvas>
        </div>`)}
  </div>`}function qe(i,t){m({repeats:[...c.repeats.slice(0,i),{...c.repeats[i],bitmap:t},...c.repeats.slice(i+1)]})}function tr(i,t){function r(e){const n=c.repeats[i].bitmap.line({x:t.x,y:t.y},{x:e.x,y:e.y},c.activeSymbol);t=e,qe(i,n)}return r(t),r}function nr(i,t){function r(e){qe(i,c.repeats[i].bitmap.flood(e,c.activeSymbol))}return r(t),r}function ir(i,t){const r=c.repeats[i].bitmap;function e(n){const s=r.rect({x:t.x,y:t.y},{x:n.x,y:n.y},c.activeSymbol);qe(i,s)}return e(t),e}function rr(i,t){const r=c.repeats[i].bitmap;function e(n){const s=r.line({x:t.x,y:t.y},{x:n.x,y:n.y},c.activeSymbol);qe(i,s)}return e(t),e}function ar(i,t){const r=c.repeats[i].bitmap;function e(n){qe(i,r.shift(t.x-n.x,t.y-n.y))}return e(t),e}const Oe={brush:tr,flood:nr,line:rr,rect:ir,shift:ar};function sr(){return V` <div class="tool-picker">
    <!-- <button
      class="btn"
      @click=${()=>m({editingRepeat:-1,repeats:[...c.repeats.slice(0,c.editingRepeat),...c.repeats.slice(c.editingRepeat+1)]})}>
      <i class="fa-solid fa-trash"></i>
    </button> -->
    <span
      >${c.repeats[c.editingRepeat].bitmap.width} x
      ${c.repeats[c.editingRepeat].bitmap.height}
    </span>
    ${Object.keys(Oe).map(i=>V`<button
        class="btn solid ${c.activeTool==i?"current":""}"
        @click=${()=>m({activeTool:i})}>
        <i class=${wn[i].icon}></i>
      </button>`)}
    <!-- <button
      class="btn solid move-repeat ${c.activeTool=="move"?"current":""}"
      @click=${()=>m({activeTool:"move"})}>
      <i class="fa-solid fa-hand"></i>
    </button> -->
    <!-- <button
      class="btn"
      @click=${()=>m({editingRepeat:-1})}>
      <i class="fa-solid fa-circle-xmark"></i>
    </button> -->
  </div>`}const yt="ECN",Me="PCN",pe="ACN",Ae="UACN",or="K",lr="P",Gt="T",Yt="M";class cr{constructor(t,r,e=!0){if(this.width=2*t,this.height=r+1,this.contacts=Array.from({length:this.width*this.height},()=>[null,yt,[null,null]]),e)for(let n=0;n<this.width;n++)this.setAV(n,0,Me),this.setMV(n,0,[0,0])}getST(t,r){return this.neighborhood(t,r)[0]}setSt(t,r,e){this.neighborhood(t,r)[0]=e}getAV(t,r){return this.neighborhood(t,r)[1]}setAV(t,r,e){this.neighborhood(t,r)[1]=e}getMV(t,r){return this.neighborhood(t,r)[2]}getDeltaI(t,r){return this.neighborhood(t,r)[2][0]}getDeltaJ(t,r){return this.neighborhood(t,r)[2][1]}setMV(t,r,e){this.neighborhood(t,r)[2]=e}setDeltaJ(t,r,e){this.neighborhood(t,r)[2][1]=e}setDeltaI(t,r,e){this.neighborhood(t,r)[2][0]=e}neighborhood(t,r){return this.contacts[r*this.width+t]}}class hr{constructor(t){this.instructions=t,this.width=t.width,this.height=t.height,this.cn=new cr(this.width,this.height),this.populateContacts()}handleKPLower(t,r,e){this.cn.setSt(t,r,e);const n=this.cn.getAV(t,r),s=this.cn.getMV(t,r);n==Me&&s[0]===0&&this.cn.setAV(t,r,pe),n==Ae&&((this.cn.getAV(t+1,r-1)==pe&&this.cn.getMV(t+1,r-1)[1]==0||this.cn.getAV(t-1,r-1)==pe&&this.cn.getMV(t-1,r-1)[1]==0)&&this.cn.setAV(t,r,pe),this.cn.getAV(t,r-1)==Me&&this.cn.setAV(t,r-1,pe))}handleKPUpper(t,r){if(this.cn.setMV(t,r+1,[0,0]),this.cn.getAV(t,r)==pe?this.cn.setAV(t,r+1,Me):this.cn.setAV(t,r+1,Ae),this.cn.getAV(t,r)==Ae){let e=!1,n=0,s=0;for(;!e&&!(r-n<0);)if(this.cn.getAV(t,r-n)==="PCN"&&(e=!0,this.cn.setAV(t,r-n,pe)),n++,s++,s>1e3){console.error("COULDN'T FIND STITCH");break}}}handleTuckMissUpper(t,r,e){e==Gt?(this.cn.setAV(t,r+1,Ae),this.cn.setMV(t,r+1,[0,0])):e==Yt&&(this.cn.setAV(t,r+1,yt),this.cn.setMV(t,r+1,[0,-1]))}handleTuckMissLower(t,r,e){const n=this.cn.getAV(t,r);if(n==Me||n==Ae)this.cn.setDeltaJ(t,r,1);else if(n==yt){let s=!1,a=0,o=0;for(;!s;){const l=this.cn.getMV(t,r-a)[1];if(l>0&&(this.cn.setDeltaJ(t,r-a,l+1),s=!0),a++,o++,o>1e3){console.error("COULDN'T FIND STITCH");break}}}}handleOp(t,r,e,n){(e==or||e==lr)&&(this.handleKPLower(t,r,e),this.handleKPLower(t+n,r,e),this.handleKPUpper(t,r,e),this.handleKPUpper(t+n,r,e)),(e==Gt||e==Yt)&&(this.handleTuckMissLower(t,r,e),this.handleTuckMissLower(t+n,r,e),this.handleTuckMissUpper(t,r,e),this.handleTuckMissUpper(t+n,r,e))}processRow(t,r){if(r)for(let e=0;e<this.width;e++){const n=this.instructions.op(e,t);this.handleOp(2*e,t,n,1)}else for(let e=this.width-1;e>=0;e--){const n=this.instructions.op(e,t);this.handleOp(2*e+1,t,n,-1)}}populateContacts(){let t=!0;for(let r=0;r<this.height;r++)this.processRow(r,t),t=!t}}const ur={T:0,K:1,S:2,p:3},dr=["K","P","M","T"];class pr{constructor(t){this.ops=Array.from(t.pixels).map(r=>dr[r]),this.width=t.width,this.height=t.height}op(t,r){return t>this.width-1||t<0||r>this.height-1||r<0?-1:this.ops.at(t+r*this.width)}makeOpData(){const t=this.width,r=this.height,e=[];for(let n=0;n<r;n++)for(let s=0;s<t;s++){const a=n*t+s,o=this.op(s,n),l=[[2*s,n],[2*s+1,n],[2*s+1,n+1],[2*s,n+1]];e.push({index:a,stitch:o,op:ur[o],cnIndices:l.map(([u,d])=>d*2*t+u)})}return e}}const Pn="K",Cn="P",fr="ECN",gr="ACN",vr="UACN";function mr(i){let t=0,r=0,e=!0,n=0;const s=[];for(;r<i.height;){const a=n%2==0,o=t%2==0,l=a===o?"F":"L";if(yr(t,r,e,s,i)){let u;if(e)u=[t,r,n,l+"L"];else{const d=$n(t,r,i);u=[d.i,d.j,n,l+"H"]}s.push(u)}({i:t,j:r,legNode:e,currentStitchRow:n}=An(t,r,e,n,i))}return s}function yr(i,t,r,e,n){if(r)return n.getST(i,t)==Pn||n.getST(i,t)==Cn;{let s=n.getAV(i,t);if(s==fr)return!1;if(s==vr){let a,o,l,u;if(i%2!=t%2)[a,o,l,u]=e.at(-1);else{const p=An(i,t,r,t-1,n);a=p.i,o=p.j}const d=$n(i,t,n);return o<d.j?(n.setAV(i,t,gr),!0):!1}else return!0}}function $n(i,t,r){const[e,n]=r.getMV(i,t);return t==r.height-1?{i,j:t}:e!=0?bt(i+e,t,r):bt(i,t+n,r)}function bt(i,t,r){return r.getST(i,t)==Pn||r.getST(i,t)==Cn?{i,j:t}:t==r.height-1?{i,j:t}:bt(i,t+r.getDeltaJ(i,t),r)}function An(i,t,r,e,n){const s=e%2==0,a=i%2==0;let o=i,l=t,u=r;return r?s?a?(l=t+1,u=!1):o=i+1:a?o=i-1:(l=t+1,u=!1):s?a?o=i+1:(l=t-1,u=!0):a?(l=t-1,u=!0):o=i-1,o<0||o>=n.width?{i,j:t+1,legNode:!0,currentStitchRow:e+1}:{i:o,j:l,legNode:u,currentStitchRow:e}}function br(i,t,r,e){return i[t].st=="K"&&i[r].st=="K"?e=="LHLL"||e=="FLFH"?"front":"back":i[t].st=="P"&&i[r].st=="P"?e=="LHLL"||e=="FLFH"?"back":"front":"mid"}class wr{constructor(t){this.width=t.width,this.height=t.height,this.cns=t,this.contactNodes=t.contacts.map((r,e)=>({index:e,st:r[0],cn:r[1],mv:r[2]})),this.yarnPath=mr(t)}yarnPathToLinks(){let t=0,r=this.yarnPath[0][3];const e=[];return this.yarnPath.forEach(([n,s,a,o],l)=>{if(l==0)return;let u=s*this.width+n,d=r+o;e.push({source:t,target:u,linkType:d,row:a,index:l-1,layer:br(this.contactNodes,t,u,d)}),t=u,r=o}),e}makeNice(){return this.yarnPath.map(([t,r,e,n])=>({cnIndex:r*this.width+t,i:t,j:r,row:e,cnType:n,angle:null,normal:[0,0]}))}}function pt(i){return function(){return i}}function Ut(i){return(i()-.5)*1e-6}function xr(i){return i.index}function Xt(i,t){var r=i.get(t);if(!r)throw new Error("node not found: "+t);return r}function _r(i){var t=xr,r=p,e,n=pt(30),s,a,o,l,u,d=1;i==null&&(i=[]);function p(w){return 1/Math.min(o[w.source.index],o[w.target.index])}function f(w){for(var $=0,M=i.length;$<d;++$)for(var z=0,R,T,O,W,D,H,U;z<M;++z)R=i[z],T=R.source,O=R.target,W=O.x+O.vx-T.x-T.vx||Ut(u),D=O.y+O.vy-T.y-T.vy||Ut(u),H=Math.sqrt(W*W+D*D),R.linkType=="FLFH"||R.linkType=="LHLL"?Math.sign(H-s[z])<=0?H=(H-s[z])/H*w*.001:H=(H-s[z])/H*w*.2:H=(H-s[z])/H*w*.5,W*=H,D*=H,O.vx-=W*(U=l[z]),O.vy-=D*U,T.vx+=W*(U=1-U),T.vy+=D*U}function S(){if(a){var w,$=a.length,M=i.length,z=new Map(a.map((T,O)=>[t(T,O,a),T])),R;for(w=0,o=new Array($);w<M;++w)R=i[w],R.index=w,typeof R.source!="object"&&(R.source=Xt(z,R.source)),typeof R.target!="object"&&(R.target=Xt(z,R.target)),o[R.source.index]=(o[R.source.index]||0)+1,o[R.target.index]=(o[R.target.index]||0)+1;for(w=0,l=new Array(M);w<M;++w)R=i[w],l[w]=o[R.source.index]/(o[R.source.index]+o[R.target.index]);e=new Array(M),x(),s=new Array(M),v()}}function x(){if(a)for(var w=0,$=i.length;w<$;++w)e[w]=+r(i[w],w,i)}function v(){if(a)for(var w=0,$=i.length;w<$;++w)s[w]=+n(i[w],w,i)}return f.initialize=function(w,$){a=w,u=$,S()},f.links=function(w){return arguments.length?(i=w,S(),f):i},f.id=function(w){return arguments.length?(t=w,f):t},f.iterations=function(w){return arguments.length?(d=+w,f):d},f.strength=function(w){return arguments.length?(r=typeof w=="function"?w:pt(+w),x(),f):r},f.distance=function(w){return arguments.length?(n=typeof w=="function"?w:pt(+w),v(),f):n},f}var Er={value:()=>{}};function Ln(){for(var i=0,t=arguments.length,r={},e;i<t;++i){if(!(e=arguments[i]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Ke(r)}function Ke(i){this._=i}function Sr(i,t){return i.trim().split(/^|\s+/).map(function(r){var e="",n=r.indexOf(".");if(n>=0&&(e=r.slice(n+1),r=r.slice(0,n)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:e}})}Ke.prototype=Ln.prototype={constructor:Ke,on:function(i,t){var r=this._,e=Sr(i+"",r),n,s=-1,a=e.length;if(arguments.length<2){for(;++s<a;)if((n=(i=e[s]).type)&&(n=kr(r[n],i.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(i=e[s]).type)r[n]=Kt(r[n],i.name,t);else if(t==null)for(n in r)r[n]=Kt(r[n],i.name,null);return this},copy:function(){var i={},t=this._;for(var r in t)i[r]=t[r].slice();return new Ke(i)},call:function(i,t){if((n=arguments.length-2)>0)for(var r=new Array(n),e=0,n,s;e<n;++e)r[e]=arguments[e+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],e=0,n=s.length;e<n;++e)s[e].value.apply(t,r)},apply:function(i,t,r){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var e=this._[i],n=0,s=e.length;n<s;++n)e[n].value.apply(t,r)}};function kr(i,t){for(var r=0,e=i.length,n;r<e;++r)if((n=i[r]).name===t)return n.value}function Kt(i,t,r){for(var e=0,n=i.length;e<n;++e)if(i[e].name===t){i[e]=Er,i=i.slice(0,e).concat(i.slice(e+1));break}return r!=null&&i.push({name:t,value:r}),i}var Se=0,Be=0,Le=0,Mn=1e3,et,Re,tt=0,me=0,at=0,Fe=typeof performance=="object"&&performance.now?performance:Date,Bn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Rn(){return me||(Bn(Pr),me=Fe.now()+at)}function Pr(){me=0}function wt(){this._call=this._time=this._next=null}wt.prototype=Tn.prototype={constructor:wt,restart:function(i,t,r){if(typeof i!="function")throw new TypeError("callback is not a function");r=(r==null?Rn():+r)+(t==null?0:+t),!this._next&&Re!==this&&(Re?Re._next=this:et=this,Re=this),this._call=i,this._time=r,xt()},stop:function(){this._call&&(this._call=null,this._time=1/0,xt())}};function Tn(i,t,r){var e=new wt;return e.restart(i,t,r),e}function Cr(){Rn(),++Se;for(var i=et,t;i;)(t=me-i._time)>=0&&i._call.call(void 0,t),i=i._next;--Se}function jt(){me=(tt=Fe.now())+at,Se=Be=0;try{Cr()}finally{Se=0,Ar(),me=0}}function $r(){var i=Fe.now(),t=i-tt;t>Mn&&(at-=t,tt=i)}function Ar(){for(var i,t=et,r,e=1/0;t;)t._call?(e>t._time&&(e=t._time),i=t,t=t._next):(r=t._next,t._next=null,t=i?i._next=r:et=r);Re=i,xt(e)}function xt(i){if(!Se){Be&&(Be=clearTimeout(Be));var t=i-me;t>24?(i<1/0&&(Be=setTimeout(jt,i-Fe.now()-at)),Le&&(Le=clearInterval(Le))):(Le||(tt=Fe.now(),Le=setInterval($r,Mn)),Se=1,Bn(jt))}}const _t=Math.PI,Et=2*_t,fe=1e-6,Lr=Et-fe;function zn(i){this._+=i[0];for(let t=1,r=i.length;t<r;++t)this._+=arguments[t]+i[t]}function Mr(i){let t=Math.floor(i);if(!(t>=0))throw new Error(`invalid digits: ${i}`);if(t>15)return zn;const r=10**t;return function(e){this._+=e[0];for(let n=1,s=e.length;n<s;++n)this._+=Math.round(arguments[n]*r)/r+e[n]}}class Br{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?zn:Mr(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,e,n){this._append`Q${+t},${+r},${this._x1=+e},${this._y1=+n}`}bezierCurveTo(t,r,e,n,s,a){this._append`C${+t},${+r},${+e},${+n},${this._x1=+s},${this._y1=+a}`}arcTo(t,r,e,n,s){if(t=+t,r=+r,e=+e,n=+n,s=+s,s<0)throw new Error(`negative radius: ${s}`);let a=this._x1,o=this._y1,l=e-t,u=n-r,d=a-t,p=o-r,f=d*d+p*p;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(f>fe)if(!(Math.abs(p*l-u*d)>fe)||!s)this._append`L${this._x1=t},${this._y1=r}`;else{let S=e-a,x=n-o,v=l*l+u*u,w=S*S+x*x,$=Math.sqrt(v),M=Math.sqrt(f),z=s*Math.tan((_t-Math.acos((v+f-w)/(2*$*M)))/2),R=z/M,T=z/$;Math.abs(R-1)>fe&&this._append`L${t+R*d},${r+R*p}`,this._append`A${s},${s},0,0,${+(p*S>d*x)},${this._x1=t+T*l},${this._y1=r+T*u}`}}arc(t,r,e,n,s,a){if(t=+t,r=+r,e=+e,a=!!a,e<0)throw new Error(`negative radius: ${e}`);let o=e*Math.cos(n),l=e*Math.sin(n),u=t+o,d=r+l,p=1^a,f=a?n-s:s-n;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>fe||Math.abs(this._y1-d)>fe)&&this._append`L${u},${d}`,e&&(f<0&&(f=f%Et+Et),f>Lr?this._append`A${e},${e},0,1,${p},${t-o},${r-l}A${e},${e},0,1,${p},${this._x1=u},${this._y1=d}`:f>fe&&this._append`A${e},${e},0,${+(f>=_t)},${p},${this._x1=t+e*Math.cos(s)},${this._y1=r+e*Math.sin(s)}`)}rect(t,r,e,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${e=+e}v${+n}h${-e}Z`}toString(){return this._}}const Rr=1664525,Tr=1013904223,Jt=4294967296;function zr(){let i=1;return()=>(i=(Rr*i+Tr)%Jt)/Jt}var Nr=10,Ir=Math.PI*(3-Math.sqrt(5));function Dr(i){var t,r=1,e=.001,n=1-Math.pow(e,1/300),s=0,a=.6,o=new Map,l=Tn(p),u=Ln("tick","end"),d=zr();i==null&&(i=[]);function p(){f(),u.call("tick",t),r<e&&(l.stop(),u.call("end",t))}function f(v){var w,$=i.length,M;v===void 0&&(v=1);for(var z=0;z<v;++z)for(r+=(s-r)*n,o.forEach(function(R){R(r)}),w=0;w<$;++w)M=i[w],M.fx==null?M.x+=M.vx*=a:(M.x=M.fx,M.vx=0),M.fy==null?M.y+=M.vy*=a:(M.y=M.fy,M.vy=0);return t}function S(){for(var v=0,w=i.length,$;v<w;++v){if($=i[v],$.index=v,$.fx!=null&&($.x=$.fx),$.fy!=null&&($.y=$.fy),isNaN($.x)||isNaN($.y)){var M=Nr*Math.sqrt(.5+v),z=v*Ir;$.x=M*Math.cos(z),$.y=M*Math.sin(z)}(isNaN($.vx)||isNaN($.vy))&&($.vx=$.vy=0)}}function x(v){return v.initialize&&v.initialize(i,d),v}return S(),t={tick:f,restart:function(){return l.restart(p),t},stop:function(){return l.stop(),t},nodes:function(v){return arguments.length?(i=v,S(),o.forEach(x),t):i},alpha:function(v){return arguments.length?(r=+v,t):r},alphaMin:function(v){return arguments.length?(e=+v,t):e},alphaDecay:function(v){return arguments.length?(n=+v,t):+n},alphaTarget:function(v){return arguments.length?(s=+v,t):s},velocityDecay:function(v){return arguments.length?(a=1-v,t):1-a},randomSource:function(v){return arguments.length?(d=v,o.forEach(x),t):d},force:function(v,w){return arguments.length>1?(w==null?o.delete(v):o.set(v,x(w)),t):o.get(v)},find:function(v,w,$){var M=0,z=i.length,R,T,O,W,D;for($==null?$=1/0:$*=$,M=0;M<z;++M)W=i[M],R=v-W.x,T=w-W.y,O=R*R+T*T,O<$&&(D=W,$=O);return D},on:function(v,w){return arguments.length>1?(u.on(v,w),t):u.on(v)}}}function xe(i){return function(){return i}}const Zt=1e-12;function Hr(i){let t=3;return i.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const e=Math.floor(r);if(!(e>=0))throw new RangeError(`invalid digits: ${r}`);t=e}return i},()=>new Br(t)}function Vr(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Nn(i){this._context=i}Nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,t){switch(i=+i,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,t):this._context.moveTo(i,t);break;case 1:this._point=2;default:this._context.lineTo(i,t);break}}};function Or(i){return new Nn(i)}function Fr(i){return i[0]}function Wr(i){return i[1]}function qr(i,t){var r=xe(!0),e=null,n=Or,s=null,a=Hr(o);i=typeof i=="function"?i:i===void 0?Fr:xe(i),t=typeof t=="function"?t:t===void 0?Wr:xe(t);function o(l){var u,d=(l=Vr(l)).length,p,f=!1,S;for(e==null&&(s=n(S=a())),u=0;u<=d;++u)!(u<d&&r(p=l[u],u,l))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+i(p,u,l),+t(p,u,l));if(S)return s=null,S+""||null}return o.x=function(l){return arguments.length?(i=typeof l=="function"?l:xe(+l),o):i},o.y=function(l){return arguments.length?(t=typeof l=="function"?l:xe(+l),o):t},o.defined=function(l){return arguments.length?(r=typeof l=="function"?l:xe(!!l),o):r},o.curve=function(l){return arguments.length?(n=l,e!=null&&(s=n(e)),o):n},o.context=function(l){return arguments.length?(l==null?e=s=null:s=n(e=l),o):e},o}function St(i,t,r){i._context.bezierCurveTo(i._x1+i._k*(i._x2-i._x0),i._y1+i._k*(i._y2-i._y0),i._x2+i._k*(i._x1-t),i._y2+i._k*(i._y1-r),i._x2,i._y2)}function At(i,t){this._context=i,this._k=(1-t)/6}At.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:St(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,t){switch(i=+i,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,t):this._context.moveTo(i,t);break;case 1:this._point=2,this._x1=i,this._y1=t;break;case 2:this._point=3;default:St(this,i,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function i(t){function r(e){return new At(e,t)}return r.tension=function(e){return i(+e)},r})(0);function Lt(i,t){this._context=i,this._k=(1-t)/6}Lt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(i,t){switch(i=+i,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:St(this,i,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function i(t){function r(e){return new Lt(e,t)}return r.tension=function(e){return i(+e)},r})(0);function In(i,t,r){var e=i._x1,n=i._y1,s=i._x2,a=i._y2;if(i._l01_a>Zt){var o=2*i._l01_2a+3*i._l01_a*i._l12_a+i._l12_2a,l=3*i._l01_a*(i._l01_a+i._l12_a);e=(e*o-i._x0*i._l12_2a+i._x2*i._l01_2a)/l,n=(n*o-i._y0*i._l12_2a+i._y2*i._l01_2a)/l}if(i._l23_a>Zt){var u=2*i._l23_2a+3*i._l23_a*i._l12_a+i._l12_2a,d=3*i._l23_a*(i._l23_a+i._l12_a);s=(s*u+i._x1*i._l23_2a-t*i._l12_2a)/d,a=(a*u+i._y1*i._l23_2a-r*i._l12_2a)/d}i._context.bezierCurveTo(e,n,s,a,i._x2,i._y2)}function Dn(i,t){this._context=i,this._alpha=t}Dn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,t){if(i=+i,t=+t,this._point){var r=this._x2-i,e=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+e*e,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(i,t):this._context.moveTo(i,t);break;case 1:this._point=2;break;case 2:this._point=3;default:In(this,i,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function i(t){function r(e){return t?new Dn(e,t):new At(e,0)}return r.alpha=function(e){return i(+e)},r})(.5);function Hn(i,t){this._context=i,this._alpha=t}Hn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(i,t){if(i=+i,t=+t,this._point){var r=this._x2-i,e=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+e*e,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:In(this,i,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Gr=function i(t){function r(e){return t?new Hn(e,t):new Lt(e,0)}return r.alpha=function(e){return i(+e)},r}(.5);function Te(i,t,r){this.k=i,this.x=t,this.y=r}Te.prototype={constructor:Te,scale:function(i){return i===1?this:new Te(this.k*i,this.x,this.y)},translate:function(i,t){return i===0&t===0?this:new Te(this.k,this.x+this.k*i,this.y+this.k*t)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Te.prototype;const Yr=1,Xe=0,Qt=5/3,Ur=.24,Xr=.88,Kr=.05,jr=.2,Jr=1,Zr=.2,Qr=.7,en=devicePixelRatio;function ea(i,t,r,e){let n=!1,s,a,o,l=new Set(t),u={...r,border:"#00000033"};performance.clearMeasures(),performance.mark("start");function d(b){const A=Math.min(H*.9/T.width,U*.9/T.height*Qt),I=A/2;a=A/Qt,s=A*Ur;const G=s+(H-T.width*A)/2,ee=-s+(U-T.height*a)/2;return b.contactNodes.forEach((k,g)=>{const _=g%b.width,C=(g-_)/b.width;k.i=_,k.j=C,k.x=G+_*I,k.y=ee+(b.height-C)*a}),b.contactNodes}function p(b,A,I){if(b.index===A.index)return[0,0];const G=b.x-A.x,ee=b.y-A.y,k=Xr*Math.sqrt(G**2+ee**2);return I?[-ee/k,G/k]:[ee/k,-G/k]}function f(){L[0].normal=p(E[L[0].cnIndex],E[L[1].cnIndex],!0);for(let b=1;b<L.length-1;b++){let A;L[b].cnType=="FH"||L[b].cnType=="LH"?L[b].row%2==0?A=!0:A=!1:L[b].row%2==0?A=!1:A=!0,L[b].normal=p(E[L[b-1].cnIndex],E[L[b+1].cnIndex],A)}L.at(-1).normal=p(E[L.at(-2).cnIndex],E[L.at(-1).cnIndex],!0)}const S=qr().x(b=>E[b.cnIndex].x+s/2*b.normal[0]).y(b=>E[b.cnIndex].y+s/2*b.normal[1]).curve(Gr);function x(b){const A=b.index;if(A==0||A>B.length-3)return`M ${b.source.x} ${b.source.y} ${b.target.x} ${b.target.y}`;const I=[L[A-1],L[A],L[A+1],L[A+2]];return S(I)}function v(){const b={front:{border:[]},back:{border:[]},mid:{border:[]}};for(const A of l)b.front[A]=[],b.back[A]=[],b.mid[A]=[];return b}function w(b){return b<Xe||b>=T.height-Xe?"border":t[(b-Xe)%t.length]}function $(b,A){b.lineWidth=s,Object.entries(A).forEach(([I,G])=>{b.strokeStyle=u[I],b.stroke(new Path2D(G.join(" ")))})}function M(){h.clearRect(0,0,H,U),ce.clearRect(0,0,H,U),Z.clearRect(0,0,H,U),f();const b=v();B.forEach((A,I)=>{if(I==0||I>B.length-3)return;const G=w(A.row);b[A.layer][G].push(x(A))}),$(Z,b.back),$(h,b.front),$(ce,b.mid)}function z(){n||(o=Dr(E).alphaMin(jr).alphaDecay(Kr).force("link",_r(B).strength(Zr).iterations(Jr).distance(b=>b.linkType=="FLFH"||b.linkType=="LHLL"?a*Qr:Math.abs(b.source.x-b.target.x))).on("tick",M),n=!0)}function R(){o&&o.stop()}const T=new pr(i.pad(Yr,Xe,0)),O=document.getElementById("sim-container").getBoundingClientRect(),W=O.width*e,D=O.height*e,H=en*W,U=en*D;function be(b){return b.map(A=>{let I=document.getElementById(A);return I.width=H,I.height=U,I.style.cssText=`width: ${W}px; height: ${D}px;`,I})}let[Pe,ae,le]=be(["back","mid","front"]);const Z=Pe.getContext("2d"),ce=ae.getContext("2d"),h=le.getContext("2d"),y=new hr(T),P=new wr(y.cn),E=d(P),L=P.makeNice(),B=P.yarnPathToLinks();return M(),{relax:z,stopSim:R}}let ft,Vn;function ta(){return V`<div id="sim-pane">
    <div id="sim-container">
      <div
        style="transform: translate(${c.simPan.x}px, ${c.simPan.y}px)"
        class=${c.flipped?"mirrored":""}>
        <canvas
          id="back"
          class=${c.flipped?"top":"bottom"}></canvas>
        <canvas id="mid" class="mid"></canvas>
        <canvas
          id="front"
          class=${c.flipped?"bottom":"top"}></canvas>
      </div>
    </div>
    <div id="sim-controls" class="panzoom-controls">
      <button @click=${Vn} class="btn solid">relax</button>
      <button
        @click=${()=>m({flipped:!c.flipped})}
        class="btn solid">
        flip
      </button>
      <button
        class="btn icon"
        @click=${()=>ht(c.simScale*.9)}>
        <i class="fa-solid fa-magnifying-glass-minus"></i>
      </button>
      <input
        type="range"
        min=${mn}
        max=${vn}
        step="0.1"
        .value=${String(c.simScale)}
        @input=${i=>ht(Number(i.target.value))} />
      <button
        class="btn icon"
        @click=${()=>ht(c.simScale*1.1)}>
        <i class="fa-solid fa-magnifying-glass-plus"></i>
      </button>
      <button
        @click=${()=>m({simPan:{x:0,y:0},simScale:1})}
        class="btn icon">
        <i class="fa-solid fa-expand"></i>
      </button>
    </div>
  </div>`}const na=(i,t)=>{let r=null;return(...e)=>{window.clearTimeout(r),r=window.setTimeout(()=>{i.apply(null,e)},t)}};function ia(){return({state:i})=>{function t(){ft&&ft(),{stopSim:ft,relax:Vn}=ea(c.chart,c.yarnSequence.pixels,c.yarnPalette,c.simScale)}const r=na(t,30);return t(),{syncState(e,n){["repeats","yarnPalette","yarnSequence","chart"].some(a=>n.includes(a))&&r(),n.includes("simScale")&&t()}}}}function ra(){return V`
    ${_e(c.showDownload,Di)}
    ${_e(c.showLibrary,Hi)}
    ${_e(c.showSettings,qi)} ${Pi()}

    <div id="site">
      <div id="chart-pane">
        <div id="chart-layout">
          ${Ji()}

          <div id="desktop">
            ${sr()}
            <div
              id="canvas-transform-group"
              style="transform: translate(${Math.floor(c.chartPan.x)}px, ${Math.floor(c.chartPan.y)}px);">
              <div id="yarn-sequence">
                <button id="color-dragger" class="btn solid grab">
                  <i class="fa-solid fa-grip"></i>
                </button>
                <canvas id="yarn-sequence-canvas"></canvas>
              </div>
              <canvas id="yarn-color-canvas"></canvas>
              <canvas id="symbol-canvas"></canvas>
              <canvas id="grid" class="grid-canvas"></canvas>
              ${er()}
            </div>
          </div>
          ${Gi()}
        </div>
      </div>
      ${ta()}
    </div>
    ${_e(c.debug,Ui)}
  `}function aa({canvas:i}){return({state:t})=>{let{scale:r,yarnSequence:e,yarnPalette:n}=t,s=e.width,a=e.height,o=null;function l(){const u=i.getContext("2d");for(let d=0;d<a;d++)for(let p=0;p<s;p++){let f=e.pixel(p,a-d-1);(o==null||o.pixel(p,a-d-1)!=f)&&(u.translate(p*r,d*r),u.fillStyle=n[f],u.clearRect(0,0,r,r),u.fillRect(0,0,r,r),u.setTransform(1,0,0,1,0,0))}o=e}return Qe(i,s,a),l(),{syncState(u){n!=u.yarnPalette&&(n=u.yarnPalette,o=null),(r!=u.scale||s!=u.yarnSequence.width||a!=u.yarnSequence.height)&&(s=u.yarnSequence.width,a=u.yarnSequence.height,r=u.scale,Qe(i,s,a),o=null),o!=u.yarnSequence&&(e=u.yarnSequence,l())}}}}function sa(i){return({state:t})=>{let{scale:r,yarnPalette:e,yarnSequence:n,chart:s}=t,a=null,o=s.width,l=s.height,u=n.height;function d(){const p=i.getContext("2d");for(let f=0;f<l;f++){let S=n.pixel(0,(l-f-1)%u);(a==null||a.pixel(0,(l-f-1)%u)!=S)&&(p.fillStyle=e[S],p.fillRect(0,f*r,o*r,r))}a=n}return a=null,d(),{syncState(p){n=p.yarnSequence,(o!=p.chart.width||l!=p.chart.height||u!=p.yarnSequence.height||r!=p.scale)&&(o=p.chart.width,l=p.chart.height,u=p.yarnSequence.height,r=p.scale,a=null),e!=p.yarnPalette&&(e=p.yarnPalette,a=null),a!=p.yarnSequence&&(n=p.yarnSequence,d())}}}}function oa(i){return({state:t})=>{let{scale:r,symbolMap:e,chart:n,symbolLineWidth:s}=t,a=null,o=n.width,l=n.height;function u(){const d=i.getContext("2d");d.lineWidth=.01*s,d.resetTransform(),d.translate(-.5,-.5);for(let p=0;p<l;p++)for(let f=0;f<o;f++){let S=n.pixel(f,p);if(a==null||a.pixel(f,p)!=S){const x=e[S];d.save(),d.translate(f*r,(l-p-1)*r),d.scale(r,r),d.clearRect(0,0,1,1),bn[x]&&(d.fillStyle="#fff",d.fillRect(0,0,1,1)),d.stroke(Ct[x]),d.restore()}}a=n}return a=null,u(),{syncState(d){(o!=d.chart.width||l!=d.chart.height||r!=d.scale||s!=d.symbolLineWidth)&&(o=d.chart.width,l=d.chart.height,r=d.scale,s=d.symbolLineWidth,a=null),a!=d.chart&&(n=d.chart,u())}}}}function la(i){return({state:t})=>{let{scale:r,chart:e,grid:n}=t,s=e.width,a=e.height;function o(){if(!n)return;const l=i.getContext("2d");if(r<15){l.clearRect(0,0,i.width,i.height);return}l.save(),l.translate(-.5,-.5),l.clearRect(0,0,i.width,i.height),l.beginPath();for(let u=0;u<s;u++)l.moveTo(u*r,0),l.lineTo(u*r,a*r+1);for(let u=0;u<a;u++)l.moveTo(0,u*r),l.lineTo(s*r+1,u*r);l.stroke(),l.restore()}return Qe(i,s,a),o(),{syncState(l){(r!=l.scale||s!=l.chart.width||a!=l.chart.height||n!=l.grid)&&(s=l.chart.width,a=l.chart.height,r=l.scale,n=l.grid,Qe(i,s,a),o())}}}}function tn(i){for(const t of i)t.bitmap=null}function ca(){return({state:i})=>{let{scale:t,symbolMap:r,repeats:e,symbolLineWidth:n}=i,s=e.map(d=>({bitmap:null,pos:[...d.pos]}));function a(d,p,f){[document.getElementById(`repeat-${d}`),document.getElementById(`repeat-${d}-grid`),document.getElementById(`repeat-${d}-outline`)].forEach(x=>{if(x==null){s[d].bitmap=null;return}x.width=c.scale*p,x.height=c.scale*f,x.style.width=`${c.scale*p/devicePixelRatio}px`,x.style.height=`${c.scale*f/devicePixelRatio}px`})}function o(d){if(!c.grid)return;const p=document.getElementById(`repeat-${d}-grid`),f=p.getContext("2d"),S=e[d].bitmap.width,x=e[d].bitmap.height;if(t<15){f.clearRect(0,0,p.width,p.height);return}f.save(),f.translate(-.5,-.5),f.clearRect(0,0,p.width,p.height),f.beginPath();for(let v=0;v<S;v++)f.moveTo(v*t,0),f.lineTo(v*t,x*t+1);for(let v=0;v<x;v++)f.moveTo(0,v*t),f.lineTo(S*t+1,v*t);f.stroke(),f.restore()}function l(d){const p=document.getElementById(`repeat-${d}`).getContext("2d");p.imageSmoothingEnabled=!1,p.lineWidth=.01*n,p.resetTransform(),p.translate(-.5,-.5);const f=e[d].bitmap;for(let S=0;S<f.height;S++)for(let x=0;x<f.width;x++){let v=f.pixel(x,S);if(s[d].bitmap==null||s[d].bitmap.pixel(x,S)!=v){const w=r[v];p.save(),p.translate(x*t,S*t),p.scale(t,t),p.clearRect(0,0,1,1),bn[w]?(p.fillStyle="#fff",p.strokeStyle="#000"):(p.fillStyle="#000",p.strokeStyle="#fff"),p.fillRect(0,0,1,1),p.stroke(Ct[w]),p.restore()}}s[d].bitmap=f}function u(){s=e.map(d=>({bitmap:null,pos:[...d.pos]}));for(let d=0;d<e.length;d++)a(d,e[d].bitmap.width,e[d].bitmap.height),l(d),o(d)}return{syncState(d){if(e=d.repeats,s.length!=e.length&&u(),n!=d.symbolLineWidth&&(n=d.symbolLineWidth,tn(s)),t!=d.scale){t=d.scale,tn(s);for(let p=0;p<e.length;p++)a(p,e[p].bitmap.width,e[p].bitmap.height),o(p)}for(let p=0;p<e.length;p++){let f=e[p];(s[p].bitmap==null||f.bitmap.width!=s[p].bitmap.width||f.bitmap.height!=s[p].bitmap.height)&&(a(p,e[p].bitmap.width,e[p].bitmap.height),o(p),s[p].bitmap=null),s[p].bitmap!=f.bitmap&&l(p)}}}}}const nn={a:()=>console.log("select all?"),z:()=>xn(),s:()=>m({showDownload:!0})},rn={...Object.fromEntries(Object.entries(wn).map(([i,t])=>[t.hotkey,()=>m({activeTool:i})])),g:()=>m({grid:!c.grid}),Escape:()=>m({showLibrary:!1,showSettings:!1,showDownload:!1,showRepeatLibrary:!1}),d:()=>m({debug:!c.debug})};function ha(i){i<=c.symbolMap.length&&m({activeSymbol:i})}function ua(){window.addEventListener("keydown",i=>{i.ctrlKey&&i.key.toLowerCase()in nn?(i.preventDefault(),nn[i.key.toLowerCase()]()):i.key in rn?rn[i.key]():/^[0-9]$/i.test(i.key)&&ha(Number(i.key)-1);const t=new Set(c.heldKeys);t.add(i.key),m({heldKeys:t})}),window.addEventListener("keyup",i=>{const t=new Set(c.heldKeys);t.delete(i.key),m({heldKeys:t})})}function da(i,t){const r={x:i.clientX,y:i.clientY},e=c.chartPan;function n(a){if(a.buttons==0)s();else{const o=r.x-a.clientX,l=r.y-a.clientY;m({chartPan:{x:e.x-o,y:e.y-l}})}}function s(){t.removeEventListener("pointermove",n),t.removeEventListener("pointerup",s),t.removeEventListener("pointerleave",s)}t.addEventListener("pointermove",n),t.addEventListener("pointerup",s),t.addEventListener("pointerleave",s)}function pa(i){i.addEventListener("pointerdown",t=>{(t.target==i||t.target.id=="symbol-canvas")&&da(t,i)}),i.addEventListener("pointermove",t=>{const{x:r,y:e}=ue(t,i);(c.pos.x!=r||c.pos.y!=e)&&m({pos:{x:r,y:e}})}),i.addEventListener("pointerleave",t=>{m({pos:{x:-1,y:-1}})}),i.addEventListener("wheel",t=>{const r=i.getBoundingClientRect();let e;Math.sign(t.deltaY)<0?e=c.reverseScroll?c.scale-1:c.scale+1:e=c.reverseScroll?c.scale+1:c.scale-1,En({x:t.clientX-r.left,y:t.clientY-r.top},e)})}function fa(i,t){let r=Je(i,t);m({yarnSequence:c.yarnSequence.brush({x:r.x,y:r.y},c.activeYarn)});function e(s){let a=Je(s,t);if(a.x==r.x&&a.y==r.y)return;const o=c.yarnSequence.line({x:r.x,y:r.y},{x:a.x,y:a.y},c.activeYarn);m({yarnSequence:o}),r=a}function n(){m({transforming:!1}),t.removeEventListener("pointermove",e),t.removeEventListener("pointerup",n),t.removeEventListener("pointerleave",n)}t.addEventListener("pointermove",e),t.addEventListener("pointerup",n),t.addEventListener("pointerleave",n)}function ga(i){const t=c.yarnSequence,r=i.clientY;document.body.classList.add("grabbing"),i.target.classList.remove("grab");function e(){document.body.classList.remove("grabbing"),m({transforming:!1}),window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",e),i.target.classList.add("grab")}function n(s){let a=t.height+Math.floor((r-s.clientY)/c.scale*devicePixelRatio);a<1||a==c.yarnSequence.height||m({yarnSequence:t.resize(1,a,c.activeYarn)})}window.addEventListener("pointermove",n),window.addEventListener("pointerup",e)}function va(i,t){i.addEventListener("pointerdown",r=>{m({transforming:!0}),fa(r,i)}),t.addEventListener("pointerdown",r=>{m({transforming:!0}),ga(r)})}function ma(i){for(i=i.parentNode;i;){if(i.hasAttribute("data-repeatindex"))return Number(i.dataset.repeatindex);i=i.parentNode}return null}function ya(i,t,r){let e=c.repeatPos;m({transforming:!0});let n=r(i,e);if(!n)return;function s(o){if(o.buttons==0)a();else{let l=c.repeatPos;if(l.x==e.x&&l.y==e.y)return;n(l),e=l}}function a(){m({transforming:!1}),t.removeEventListener("pointermove",s),t.removeEventListener("pointerup",a),t.removeEventListener("pointerleave",a)}t.addEventListener("pointermove",s),t.addEventListener("pointerup",a),t.addEventListener("pointerleave",a)}function ba(i,t){const r=c.repeats[t],e=[i.clientX,i.clientY],n=i.target;m({transforming:!0}),document.body.classList.add("grabbing"),n.classList.remove("grab");const s=()=>{m({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",s),n.classList.add("grab")},a=o=>{let l=r.bitmap.width-Math.floor((e[0]-o.clientX)/(c.scale/devicePixelRatio)),u=r.bitmap.height+Math.floor((e[1]-o.clientY)/(c.scale/devicePixelRatio));if(u<1||l<1)return;let d=[...r.pos];l+r.pos[0]<1&&(d[0]=-l+1),u+r.pos[1]<1&&(d[1]=-u+1);let p=[l>r.area[0]?l:r.area[0],u>r.area[1]?u:r.area[1]];m({repeats:[...c.repeats.slice(0,t),{...c.repeats[t],bitmap:r.bitmap.vFlip().resize(l,u).vFlip(),pos:d,area:p},...c.repeats.slice(t+1)]})};window.addEventListener("pointermove",a),window.addEventListener("pointerup",s)}function an(i,t,r){let e=c.repeats[t];const n=r=="x"?e.area[0]:e.area[1],s=[i.clientX,i.clientY],a=i.target;m({transforming:!0}),document.body.classList.add("grabbing"),a.classList.remove("grab");const o=()=>{m({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",o),a.classList.add("grab")},l=u=>{let d,p;r=="x"?(d=n-Math.floor((s[0]-u.clientX)/(c.scale/devicePixelRatio)),d=d<e.bitmap.width?e.bitmap.width:d,p={...e,area:[d,c.repeats[t].area[1]]}):(d=n+Math.floor((s[1]-u.clientY)/(c.scale/devicePixelRatio)),d=d<e.bitmap.height?e.bitmap.height:d,p={...c.repeats[t],area:[c.repeats[t].area[0],d]}),m({repeats:[...c.repeats.slice(0,t),p,...c.repeats.slice(t+1)]})};window.addEventListener("pointermove",l),window.addEventListener("pointerup",o)}function wa(i){i.addEventListener("pointerdown",t=>{const r=ma(t.target);let e=t.target.classList;if(e.contains("resize-repeat"))ba(t,r);else if(e.contains("repeat-area-dragger"))e.contains("x-axis")?an(t,r,"x"):an(t,r,"y");else if(e.contains("repeat-canvas")){const n=c.activeTool;n in Oe?ya(r,t.target,Oe[n]):console.warn(`Uh oh, ${n} is not a tool`)}}),i.addEventListener("pointermove",t=>{if(c.editingRepeat<0){const{x:r,y:e}=ue(t,i);(c.pos.x!=r||c.pos.y!=e)&&m({pos:{x:r,y:e}})}else{const{x:r,y:e}=ue(t,t.target);(c.pos.x!=r||c.pos.y!=e)&&m({repeatPos:{x:r,y:e}})}})}function xa(i,t){const r={x:i.clientX,y:i.clientY},e=c.simPan;function n(a){if(a.buttons==0)s();else{const o=r.x-a.clientX,l=r.y-a.clientY;m({simPan:{x:e.x-o,y:e.y-l}})}}function s(){t.removeEventListener("pointermove",n),t.removeEventListener("pointerup",s),t.removeEventListener("pointerleave",s)}t.addEventListener("pointermove",n),t.addEventListener("pointerup",s),t.addEventListener("pointerleave",s)}function _a(i){i.addEventListener("wheel",t=>{let r;const e=i.getBoundingClientRect();Math.sign(t.deltaY)<0?r=c.reverseScroll?c.simScale*.9:c.simScale*1.1:r=c.reverseScroll?c.simScale*1.1:c.simScale*.9,_n({x:(t.clientX-e.left)/2,y:(t.clientY-e.top)/2},r)}),i.addEventListener("pointerdown",t=>{xa(t,i)})}function Ea(i){function t(r,e){const n={x:r.touches[0].clientX,y:r.touches[0].clientY},s=c.chartPan;function a(l){const u=n.x-l.touches[0].clientX,d=n.y-l.touches[0].clientY;m({chartPan:{x:s.x-u,y:s.y-d}})}function o(){e.removeEventListener("touchmove",a),e.removeEventListener("touchcancel",o),e.removeEventListener("touchend",o)}e.addEventListener("touchmove",a),e.addEventListener("touchcancel",o),e.addEventListener("touchend",o)}i.addEventListener("touchstart",r=>{const{x:e,y:n}=ue(r.touches[0],i);(c.pos.x!=e||c.pos.y!=n)&&m({pos:{x:e,y:n}}),(r.target.id=="symbol-canvas"||r.target.id=="desktop")&&t(r,i)}),i.addEventListener("touchmove",r=>{const{x:e,y:n}=ue(r,i);(c.pos.x!=e||c.pos.y!=n)&&m({pos:{x:e,y:n}})}),i.addEventListener("touchmove",r=>{const{x:e,y:n}=ue(r.touches[0],i);(c.pos.x!=e||c.pos.y!=n)&&m({pos:{x:e,y:n}})}),i.addEventListener("touchend",r=>{m({pos:{x:-1,y:-1}})}),i.addEventListener("touchcancel",r=>{m({pos:{x:-1,y:-1}})})}function Sa(i,t){let r=Je(i.touches[0],t);m({yarnSequence:c.yarnSequence.brush({x:r.x,y:r.y},c.activeYarn)});function e(s){let a=Je(s.touches[0],t);if(a.x==r.x&&a.y==r.y)return;const o=c.yarnSequence.line({x:r.x,y:r.y},{x:a.x,y:a.y},c.activeYarn);m({yarnSequence:o}),r=a}function n(){m({transforming:!1}),t.removeEventListener("touchmove",e),t.removeEventListener("touchcancel",n),t.removeEventListener("touchend",n)}t.addEventListener("touchmove",e),t.addEventListener("touchcancel",n),t.addEventListener("touchend",n)}function ka(i){const t=c.yarnSequence,r=i.touches[0].clientY,e=()=>{m({transforming:!1}),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e)},n=s=>{let a=t.height+Math.floor((r-s.touches[0].clientY)/c.scale*devicePixelRatio);a<1||a==t.height||m({yarnSequence:t.resize(1,a,c.activeYarn)})};window.addEventListener("touchmove",n),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e)}function Pa(i,t){i.addEventListener("touchstart",r=>{m({transforming:!0}),Sa(r,i)}),t.addEventListener("touchstart",r=>{m({transforming:!0}),ka(r)})}function Ca(i){for(i=i.parentNode;i;){if(i.hasAttribute("data-repeatindex"))return Number(i.dataset.repeatindex);i=i.parentNode}return null}function $a(i,t,r){let e=c.repeatPos;m({transforming:!0});let n=r(i,e);if(!n)return;function s(){let o=c.repeatPos;o.x==e.x&&o.y==e.y||(n(o),e=o)}function a(){m({transforming:!1}),t.removeEventListener("touchmove",s),t.removeEventListener("touchend",a),t.removeEventListener("touchcancel",a)}t.addEventListener("touchmove",s),t.addEventListener("touchend",a),t.addEventListener("touchcancel",a)}function Aa(i,t){const r=c.repeats[t],e=[i.clientX,i.clientY],n=i.target;m({transforming:!0}),document.body.classList.add("grabbing"),n.classList.remove("grab");const s=()=>{m({transforming:!1}),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o=>{let l=r.bitmap.width-Math.floor((e[0]-o.touches[0].clientX)/(c.scale/devicePixelRatio)),u=r.bitmap.height+Math.floor((e[1]-o.touches[0].clientY)/(c.scale/devicePixelRatio));if(u==r.height&&l==r.width||u<1||l<1)return;let d=[...r.pos];l+r.pos[0]<1&&(d[0]=-l+1),u+r.pos[1]<1&&(d[1]=-u+1);let p=[l>r.area[0]?l:r.area[0],u>r.area[1]?u:r.area[1]];m({repeats:[...c.repeats.slice(0,t),{...c.repeats[t],bitmap:r.bitmap.vFlip().resize(l,u).vFlip(),pos:d,area:p},...c.repeats.slice(t+1)]})};window.addEventListener("touchmove",a),window.addEventListener("touchcancel",s),window.addEventListener("touchend",s)}function La(i,t){let r=c.repeats[t];const e=[...c.repeats[t].pos],n=[i.clientX,i.clientY];console.log(n),m({transforming:!0});const s=()=>{m({transforming:!1}),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o=>{let l=e[0]-Math.floor((n[0]-o.touches[0].clientX)/(c.scale/devicePixelRatio)),u=e[1]+Math.floor((n[1]-o.touches[0].clientY)/(c.scale/devicePixelRatio));l=l<-(r.bitmap.width-1)?-(r.bitmap.width-1):l,u=u<-(r.bitmap.height-1)?-(r.bitmap.height-1):u,l=l>c.chart.width-1?c.chart.width-1:l,u=u>c.chart.height-1?c.chart.height-1:u,m({repeats:[...c.repeats.slice(0,t),{...r,pos:[l,u]},...c.repeats.slice(t+1)]})};window.addEventListener("touchmove",a),window.addEventListener("touchcancel",s),window.addEventListener("touchend",s)}function sn(i,t){if(c.editingRepeat<0){const{x:r,y:e}=ue(i,t);(c.pos.x!=r||c.pos.y!=e)&&m({pos:{x:r,y:e}})}else{const{x:r,y:e}=ue(i,i.target);(c.pos.x!=r||c.pos.y!=e)&&m({repeatPos:{x:r,y:e}})}}function on(i,t,r){let e=c.repeats[t];const n=r=="x"?e.area[0]:e.area[1],s=[i.clientX,i.clientY];m({transforming:!0});const a=()=>{m({transforming:!1}),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},o=l=>{let u,d;r=="x"?(u=n-Math.floor((s[0]-l.touches[0].clientX)/(c.scale/devicePixelRatio)),u=u<e.bitmap.width?e.bitmap.width:u,d={...c.repeats[t],area:[u,c.repeats[t].area[1]]}):(u=n+Math.floor((s[1]-l.touches[0].clientY)/(c.scale/devicePixelRatio)),u=u<e.bitmap.height?e.bitmap.height:u,d={...c.repeats[t],area:[c.repeats[t].area[0],u]}),m({repeats:[...c.repeats.slice(0,t),d,...c.repeats.slice(t+1)]})};window.addEventListener("touchmove",o),window.addEventListener("touchcancel",a),window.addEventListener("touchend",a)}function Ma(i){i.addEventListener("touchstart",t=>{sn(t.touches[0],i);const r=Ca(t.target);let e=t.target.classList;if(c.editingRepeat!=r&&e.contains("repeat-canvas")){m({editingRepeat:r});return}if(e.contains("resize-repeat"))Aa(t.touches[0],r);else if(e.contains("repeat-area-dragger"))e.contains("x-axis")?on(t.touches[0],r,"x"):on(t.touches[0],r,"y");else if(e.contains("repeat-canvas")){const n=c.activeTool;n in Oe?$a(r,t.target,Oe[n]):n=="move"?La(t.touches[0],r):console.console.warn(`Uh oh, ${n} is not a tool`)}}),i.addEventListener("touchmove",t=>{sn(t.touches[0],i)})}function Ba(i,t){const r={x:i.clientX,y:i.clientY},e=c.simPan;function n(a){const o=r.x-a.touches[0].clientX,l=r.y-a.touches[0].clientY;m({simPan:{x:e.x-o,y:e.y-l}})}function s(){t.removeEventListener("touchmove",n),t.removeEventListener("touchcancel",s),t.removeEventListener("touchend",s)}t.addEventListener("touchmove",n),t.addEventListener("touchcancel",s),t.addEventListener("touchend",s)}function Ra(i){i.addEventListener("touchstart",t=>{Ba(t.touches[0],i)})}function Ta(i){return({state:t})=>{let{symbolMap:r,symbolLineWidth:e}=t;function n(){r.forEach(s=>{const a=document.querySelector(`[data-symbol=${s}]`);if(!a)return;a.width=50,a.height=50;const o=a.getContext("2d");o.scale(50,50),o.imageSmoothingEnabled=!1,o.lineWidth=.01*e,o.stroke(Ct[s])})}return n(),{syncState(s){e!=s.symbolLineWidth&&(e=s.symbolLineWidth,n())}}}}function za(i,t,r,e){i.width=e*t,i.height=e*r,i.style.width=`${e*t/devicePixelRatio}px`,i.style.height=`${e*r/devicePixelRatio}px`}function Na(i){return({state:t})=>{let{scale:r,chart:e}=t,n=e.width,s=e.height;function a(){i.forEach(o=>{za(o,n,s,r)})}return{syncState(o){(n!=o.chart.width||s!=o.chart.height||r!=o.scale)&&(n=o.chart.width,s=o.chart.height,r=o.scale,a())}}}}function On(){document.getElementById("site").addEventListener("pointerdown",i=>{m({showLibrary:!1,showSettings:!1,showDownload:!1})})}function Ia(){return({state:i})=>{let{repeats:t}=i,r=i.chart.width,e=i.chart.height;function n(){let s=F.empty(c.chart.width,c.chart.height,0);for(const a of t){let o=F.fromTile(c.chart.width,c.chart.height,a.bitmap.vFlip()).vFlip();s=s.overlay(o,a.pos)}m({chart:s})}return n(),{syncState(s){(t!=s.repeats||r!=s.chart.width||e!=s.chart.height)&&(t=s.repeats,r=s.chart.width,e=s.chart.height,n())}}}}let gt,vt,mt,Mt,Bt,nt,Rt,Tt;function Fn(){Qn(ra(),document.body),window.requestAnimationFrame(Fn)}function Da(){ua(),pa(Mt),wa(Bt),va(nt,Rt),_a(Tt),On()}function Ha(){document.body.style.setProperty("--font-size","1.1rem"),Ea(Mt),Ma(Bt),Pa(nt,Rt),Ra(Tt),On()}function Wn(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`),document.documentElement.style.setProperty("--vw",`${window.innerWidth*.01}px`)}function Va(){Fn(),gt=document.getElementById("symbol-canvas"),vt=document.getElementById("grid"),mt=document.getElementById("yarn-color-canvas"),nt=document.getElementById("yarn-sequence-canvas"),Mt=document.getElementById("desktop"),Bt=document.getElementById("repeat-container"),Tt=document.getElementById("sim-container"),document.getElementById("repeat-library"),Rt=document.getElementById("color-dragger"),ri(["#chart-pane","#sim-pane"],{sizes:[60,40],minSize:100,gutterSize:11}),vi()?Ha():Da(),$t.register([Na([gt,vt,mt]),aa({canvas:nt}),oa(gt),sa(mt),la(vt),ca(),Ta(),ia(),Ia()]),Wn(),ke()}window.onload=Va;window.onresize=Wn;
